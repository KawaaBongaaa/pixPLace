name: Inject API Keys

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  inject-keys:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Inject all secrets into app_modern.js
        run: |
          echo "üîß Injecting all API keys and URLs..."

          if [ -n "${{ secrets.RUNWARE_API_KEY }}" ]; then
            sed -i "s/PLACEHOLDER_RUNWARE_API_KEY/${{ secrets.RUNWARE_API_KEY }}/g" app_modern.js
            echo "‚úÖ RUNWARE_API_KEY inserted"
          else
            echo "‚ùå RUNWARE_API_KEY secret not found!"
          fi

          if [ -n "${{ secrets.WEBHOOK_URL }}" ]; then
            sed -i "s|PLACEHOLDER_WEBHOOK_URL|${{ secrets.WEBHOOK_URL }}|g" app_modern.js
            echo "‚úÖ WEBHOOK_URL inserted"
          else
            echo "‚ùå WEBHOOK_URL secret not found!"
          fi

          if [ -n "${{ secrets.CHAT_WEBHOOK_URL }}" ]; then
            sed -i "s|PLACEHOLDER_CHAT_WEBHOOK_URL|${{ secrets.CHAT_WEBHOOK_URL }}|g" app_modern.js
            echo "‚úÖ CHAT_WEBHOOK_URL inserted"
          else
            echo "‚ùå CHAT_WEBHOOK_URL secret not found!"
          fi

          if [ -n "${{ secrets.TELEGRAM_BOT_URL }}" ]; then
            sed -i "s|PLACEHOLDER_TELEGRAM_BOT_URL|${{ secrets.TELEGRAM_BOT_URL }}|g" app_modern.js
            echo "‚úÖ TELEGRAM_BOT_URL inserted"
          else
            echo "‚ùå TELEGRAM_BOT_URL secret not found!"
          fi

      - name: Verify all replacements
        run: |
          if grep -q "PLACEHOLDER_" app_modern.js; then
            echo "‚ùå Some placeholders were NOT replaced!"
            exit 1
          else
            echo "‚úÖ All placeholders replaced successfully"
          fi
