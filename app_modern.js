// üöÄ Modern AI Image Generator WebApp

// Configuration
const CONFIG = {
    WEBHOOK_URL: 'https://hook.us2.make.com/x2hgl6ocask8hearbpwo3ch7pdwpdlrk', // ‚ö†Ô∏è –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –í–ê–® WEBHOOK!
    CHAT_WEBHOOK_URL: 'https://hook.us2.make.com/xsj1a14x1qaterd8fcxrs8e91xwhvjh6', // ‚ö†Ô∏è –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê WEBHOOK –î–õ–Ø –ß–ê–¢–ê!
    TIMEOUT: 120000, // 120 —Å–µ–∫—É–Ω–¥
    LANGUAGES: ['en', 'ru', 'es', 'fr', 'de', 'zh', 'pt', 'ar', 'hi', 'ja', 'it', 'ko', 'tr', 'pl'],
    DEFAULT_LANGUAGE: 'en',
    DEFAULT_THEME: 'dark', // 'light', 'dark', 'auto'
    IMGBB_API_KEY: '34627904ae4633713e1fee94a243794e', // —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤/–ø—Ä–æ—Ç–æ—Ç–∏–ø–∞
    MAX_IMAGE_MB: 10,
    ALLOWED_TYPES: ['image/jpeg', 'image/png', 'image/webp', 'image/gif'],
    PREVIEW_MAX_W: 1024,
    PREVIEW_MAX_H: 1024,
    PREVIEW_JPEG_QUALITY: 0.9,
    TELEGRAM_BOT_URL: 'https://t.me/pixPLaceBot?start=user_shared', // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å—Å—ã–ª–∫—É –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
    SHARE_DEFAULT_HASHTAGS: '#pixPLaceBot #Telegram #miniApp'
};
// üåç Translations
const TRANSLATIONS = {



    en: {
        loading: "The pixPLace",
        app_title: "pixPLace",
        connecting: "Connecting...",
        connected: "Connected to Telegram",
        welcome_title: "Create Amazing Images",
        welcome_subtitle: "Describe your vision and watch AI bring it to life",
        prompt_label: "Prompt",
        prompt_placeholder: "Describe your vision and watch AI bring it to life...",
        style_label: "Style",
        style_realistic: "Realistic",
        style_artistic: "Artistic",
        style_cartoon: "Cartoon",
        style_fantasy: "Fantasy",
        style_anime: "Anime",
        style_cyberpunk: "Cyberpunk",
        style_popart: "Pop Art",
        style_abstract: "Abstract",
        style_sketch: "Sketch",
        style_3d: "3d",
        style_sticker: "Sticker",
        style_vector: "Vector",
        style_interior: "Interior",
        style_architecture: "Architecture",
        style_fashion: "Fashion",
        style_tattoo: "Tattoo",
        style_print: "Print",
        style_logo: "Logo",
        style_icon: "Icon",
        style_banner: "Banner",
        mode_label: "Mode",
        mode_background_removal: "Remove Background",
        mode_upscale_image: "Upscale Image | ~5cr",
        mode_print_maker: "SDXL T-Shirt Print | PoD Helper | ~2cr",
        mode_photo_session: "Nano Banana | Photo Editing by Kontext Explaining",
        mode_fast_generation: "Fastest pixPlace | Simple Pictures",
        mode_pixplace_pro: "Flux Krea | Logo | Text(eng)",
        size_label: "Size",
        size_square: "1:1",
        size_portrait: "9:16",
        size_landscape: "16:9",
        generate_btn: "Generate Image",
        create_new: "Create New",
        empty_history_title: "No generations yet",
        empty_history_subtitle: "Create your first AI image to see it here",
        generation_cost: "Generation cost",
        error_prompt_required: "Please describe your image",
        error_prompt_too_short: "Prompt too short (minimum 5 characters)",
        error_webhook_not_configured: "Webhook URL not configured",
        error_generation_failed: "Generation failed",
        error_timeout: "Generation timeout. Please try again.",
        success_generated: "Image generated successfully!",
        copied_to_clipboard: "Copied to clipboard",
        download_started: "Download started",
        limit_title: "Generation Limit Reached",
        limit_message: "Your credits for generation have run out.\nYou can get more credits by paying for one of the subscription plans for our private channel.\n\nPayment by any card or crypto, through the Tribute Telegram payment service.",
        closeLimitModal: "Maybe Later",
        upgradeBtn: "Pay",
        remove_user_image: "Remove",
        reference_image: "Reference",
        upload_image: "Upload Image",
        please_upload_photo_session: "Please upload Your image for Photo Session mode. \nOr just choice another Mode",
        upload_failed: "Failed to upload the image. \nPlease try again.",
        please_upload_for_upscale: "Please upload an image to Upscale.",
        please_upload_for_background_removal: "Please upload an image for Background removal.",

        // ========== AI CHAT TRANSLATIONS ==========
        ai_coach_ready: "‚ú® AI Prompt Helper is ready to help with AI generation!",
        ai_welcome_intro: "AI Prompt Helper: Welcome! I am your AI assistant for improving the quality of image generation results. Ask any question about creating prompts! Or briefly describe your vision, and I will create a professional prompt for you.",
        ai_welcome_chat: "AI Prompt Helper: Welcome to the chat! I am your AI assistant for help with creating images. Tell me what you want to generate and I will help you create a quality prompt. Or just ask me any question, I'll help with generation!",
        ai_placeholder_modal: "Write to your AI assistant...",
        ai_placeholder_chat: "Write your message...",
        ai_send_button: "Send",
        ai_close_button: "Close",
        ai_thinking_indicator: "ü§ñ pixPLace Assistant is thinking...",
        ai_error_message: "Sorry, there was an error. Please try again.",

        // ==============TARIFFS MODAL ENGLISH TRANSLATIONS ==============
        plan_lite_title: "LITE",
        plan_lite_price: "‚Ç¨12",
        plan_lite_desc: "Perfect for casual users",
        plan_lite_credits: "500 credits",
        plan_lite_feature1: "‚Ä¢ Fast generation",
        plan_lite_feature2: "‚Ä¢ Standard models",
        plan_lite_feature3: "‚Ä¢ Best Quality ",
        plan_lite_select: "Subscribe",

        plan_pro_title: "PRO",
        plan_pro_price: "‚Ç¨17",
        plan_pro_desc: "Best for enthusiasts",
        plan_pro_credits: "1000 credits",
        plan_pro_feature1: "‚Ä¢ FLUX models",
        plan_pro_feature2: "‚Ä¢ AI Assistant included",
        plan_pro_feature3: "‚Ä¢ HD quality",
        plan_pro_select: "Subscribe",

        plan_studio_title: "STUDIO",
        plan_studio_price: "‚Ç¨31",
        plan_studio_desc: "Full creative power",
        plan_studio_credits: "2000 credits",
        plan_studio_feature1: "‚Ä¢ Max performance",
        plan_studio_feature2: "‚Ä¢ All premium models",
        plan_studio_feature3: "‚Ä¢ Priority support",
        plan_studio_select: "Subscribe",

        // Additional AI Chat translations for english
        ai_placeholder_modal: "Write to your AI assistant...",
        ai_chat_title: "AI Assistant"
    },

    ru: {
        loading: "The pixPLace",
        app_title: "pixPLace",
        connecting: "–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...",
        connected: "–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Telegram",
        welcome_title: "–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –ü–æ—Ç—Ä—è—Å–∞—é—â–∏–µ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è",
        welcome_subtitle: "–û–ø–∏—à–∏—Ç–µ —Å–≤–æ—ë –≤–∏–¥–µ–Ω–∏–µ –∏ –Ω–∞–±–ª—é–¥–∞–π—Ç–µ, –∫–∞–∫ AI –≤–æ–ø–ª–æ—â–∞–µ—Ç –µ–≥–æ –≤ –∂–∏–∑–Ω—å",
        prompt_label: "Prompt",
        prompt_placeholder: "–û–ø–∏—à–∏—Ç–µ —Å–≤–æ—ë –≤–∏–¥–µ–Ω–∏–µ –∏ –Ω–∞–±–ª—é–¥–∞–π—Ç–µ, –∫–∞–∫ AI –≤–æ–ø–ª–æ—â–∞–µ—Ç –µ–≥–æ –≤ –∂–∏–∑–Ω—å...",
        style_label: "–°—Ç–∏–ª—å",
        style_realistic: "–†–µ–∞–ª–∏–∑–º",
        style_artistic: "–ê—Ä—Ç",
        style_cartoon: "–ú—É–ª—å—Ç",
        style_fantasy: "–§—ç–Ω—Ç–µ–∑–∏",
        style_anime: "–ê–Ω–∏–º–µ",
        style_cyberpunk: "CyberPunk",
        style_popart: "–ü–æ–ø-–∞—Ä—Ç",
        style_abstract: "–ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è",
        style_sketch: "–°–∫–µ—Ç—á",
        style_3d: "3D",
        style_sticker: "–°—Ç–∏–∫–µ—Ä",
        style_vector: "–í–µ–∫—Ç–æ—Ä",
        style_interior: "–ò–Ω—Ç–µ—Ä—å–µ—Ä",
        style_architecture: "–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞",
        style_fashion: "–ú–æ–¥–∞",
        style_tattoo: "–¢–∞—Ç—É",
        style_print: "Print",
        style_logo: "Logo",
        style_icon: "Icon",
        style_banner: "–ë–∞–Ω–Ω–µ—Ä",
        mode_label: "–†–µ–∂–∏–º",
        mode_background_removal: "–£–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ–Ω–∞ | ~1cr",
        mode_upscale_image: "–£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ | ~5cr",
        mode_print_maker: "–ü–µ—á–∞—Ç—å | Sticker | PoD Helper ~2cr",
        mode_photo_session: "–§–æ—Ç–æC–µ—Å—Å–∏—è | –û–ø–∏—à–∏—Ç–µ, —á—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å | ~5cr",
        mode_fast_generation: "–ë—ã—Å—Ç—Ä–∞—è –ì–µ–Ω–µ—Ä–∞—Ü–∏—è | –ü—Ä–æ—Å—Ç—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ | ~1cr",
        mode_pixplace_pro: "Pro | Logo | Text ~3cr",
        size_label: "–†–∞–∑–º–µ—Ä",
        size_square: "1:1",
        size_portrait: "9:16",
        size_landscape: "16:9",
        generate_btn: "–°–æ–∑–¥–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ",
        processing_subtitle: "–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –¥–æ 60 —Å–µ–∫—É–Ω–¥",
        step_analyzing: "–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç",
        step_generating: "–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ",
        step_finalizing: "–ó–∞–≤–µ—Ä—à–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç",
        elapsed_time: "–ü—Ä–æ—à–ª–æ –≤—Ä–µ–º–µ–Ω–∏:",
        cancel_btn: "–û—Ç–º–µ–Ω–∏—Ç—å",
        create_new: "–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ",
        view_history: "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é",
        history_title: "–ò—Å—Ç–æ—Ä–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–π",
        empty_history_title: "–ü–æ–∫–∞ –Ω–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–π",
        empty_history_subtitle: "–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –µ–≥–æ –∑–¥–µ—Å—å",
        generation_cost: "–°—Ç–æ–∏–º–æ—Å—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏",
        error_prompt_required: "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ",
        error_prompt_too_short: "–û–ø–∏—Å–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ (–º–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤)",
        error_webhook_not_configured: "Webhook URL –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω",
        error_generation_failed: "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å",
        error_timeout: "–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.",
        success_generated: "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ!",
        copied_to_clipboard: "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä",
        download_started: "–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—á–∞–ª–∞—Å—å",
        limit_title: "–õ–∏–º–∏—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –∏—Å—á–µ—Ä–ø–∞–Ω",
        limit_message: "–í–∞—à–∏ –∫—Ä–µ–¥–∏—Ç—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å.\n–ë–æ–ª—å—à–µ –∫—Ä–µ–¥–∏—Ç–æ–≤ –í—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å, –æ–ø–ª–∞—Ç–∏–≤ –æ–¥–∏–Ω –∏–∑ —Ç–∞—Ä–∏—Ñ–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –Ω–∞—à –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–∞–Ω–∞–ª.\n\n–û–ø–ª–∞—Ç–∞ –ª—é–±–æ–π –∫–∞—Ä—Ç–æ–π –∏–ª–∏ –∫—Ä–∏–ø—Ç–æ–π, —á–µ—Ä–µ–∑ –ø–ª–∞—Ç–µ–∂–Ω—ã–π —Å–µ—Ä–≤–∏—Å Tribute Telegram.",
        check_subsciption: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É",
        closeLimitModal: "–ú–æ–∂–µ—Ç –ø–æ–∑–∂–µ",
        upgradeBtn: "–í—ã–±—Ä–∞—Ç—å —Ç–∞—Ä–∏—Ñ",
        remove_user_image: "–£–¥–∞–ª–∏—Ç—å",
        reference_image: "–†–µ—Ñ–µ—Ä–µ–Ω—Å",
        upload_image: "–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ",
        please_upload_photo_session: "–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º",
        upload_failed: "–ù–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ. –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑",
        please_upload_for_upscale: "–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º (–£–ª—É—á—à–µ–Ω–∏–µ –ö–∞—á–µ—Å—Ç–≤–∞)",
        please_upload_for_background_removal: "–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º (–£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–Ω–µ–≥–æ —Ñ–æ–Ω–∞)",

        // ========== AI CHAT TRANSLATIONS ==========
        ai_coach_ready: "‚ú® Ai Prompt Helper –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å —Å –ò–ò –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π!",
        ai_welcome_intro: "AI Prompt Helper: –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –Ø –≤–∞—à AI –ø–æ–º–æ—â–Ω–∏–∫ –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π. –ó–∞–¥–∞–π—Ç–µ –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å –æ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ–º–ø—Ç–æ–≤! –ò–ª–∏ –∫–æ—Ä–æ—Ç–∫–æ –æ–ø–∏—à–∏—Ç–µ —Å–≤–æ–µ –≤–∏–¥–µ–Ω–∏–µ, –∏ —è —Å–æ–∑–¥–∞–º –¥–ª—è –í–∞—Å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π Prompt.",
        ai_welcome_chat: "AI Prompt Helper: –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —á–∞—Ç! –Ø –≤–∞—à AI –ø–æ–º–æ—â–Ω–∏–∫ –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è –ø–æ–º–æ—â–∏ —Å —Å–æ–∑–¥–∞–Ω–∏–µ–º –∏–∑–æ–±—â–µ–Ω–∏–π. –°–∫–∞–∂–∏—Ç–µ, —á—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏ —è –ø–æ–º–æ–≥—É –í–∞–º —Å–æ–∑–¥–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç. –ò–ª–∏ –∂–µ –ø—Ä–æ—Å—Ç–æ –∑–∞–¥–∞–π—Ç–µ –º–Ω–µ –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å, –±—É–¥—É –ø–æ–º–æ–≥–∞—Ç—å —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π!",
        ai_placeholder_modal: "–ù–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ–µ–º—É AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—É...",
        ai_placeholder_chat: "–ù–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ—ë —Å–æ–æ–±—â–µ–Ω–∏–µ...",
        ai_send_button: "–û—Ç–ø—Ä–∞–≤–∏—Ç—å",
        ai_close_button: "–ó–∞–∫—Ä—ã—Ç—å",
        ai_thinking_indicator: "ü§ñ pixPLace Assistant –¥—É–º–∞–µ—Ç...",
        ai_error_message: "–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–∂–∞–ª—É–π—Å—Ç–∞.",
        // ==============TARIFFS MODAL RUSSIAN TRANSLATIONS ==============
        plan_lite_title: "LITE",
        plan_lite_price: "1100‚ÇΩ",
        plan_lite_desc: "–ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Ä–µ–¥–∫–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è",
        plan_lite_credits: "500 –∫—Ä–µ–¥–∏—Ç–æ–≤",
        plan_lite_feature1: "‚Ä¢ –ë—ã—Å—Ç—Ä–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è",
        plan_lite_feature2: "‚Ä¢ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏",
        plan_lite_feature3: "‚Ä¢ –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ",
        plan_lite_select: "–û–ø–ª–∞—Ç–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É",

        plan_pro_title: "PRO",
        plan_pro_price: "1700‚ÇΩ",
        plan_pro_desc: "–õ—É—á—à–∏–π –≤—ã–±–æ—Ä –¥–ª—è —É–≤–ª–µ—á—ë–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π",
        plan_pro_credits: "1000 –∫—Ä–µ–¥–∏—Ç–æ–≤",
        plan_pro_feature1: "‚Ä¢ –ú–æ–¥–µ–ª–∏ FLUX",
        plan_pro_feature2: "‚Ä¢ –í–∫–ª—é—á–µ–Ω AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç",
        plan_pro_feature3: "‚Ä¢ –ö–∞—á–µ—Å—Ç–≤–æ HD",
        plan_pro_select: "–û–ø–ª–∞—Ç–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É",

        plan_studio_title: "STUDIO",
        plan_studio_price: "2900‚ÇΩ",
        plan_studio_desc: "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–≤–æ—Ä—á–µ—Å–∫–∞—è —Å–≤–æ–±–æ–¥–∞",
        plan_studio_credits: "2000 –∫—Ä–µ–¥–∏—Ç–æ–≤",
        plan_studio_feature1: "‚Ä¢ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å",
        plan_studio_feature2: "‚Ä¢ –í—Å–µ –ø—Ä–µ–º–∏—É–º —Ñ–∏—Ç—á–∏",
        plan_studio_feature3: "‚Ä¢ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞",
        plan_studio_select: "–û–ø–ª–∞—Ç–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É",

    },

    es: {
        loading: "The pixPLace",
        app_title: "pixPLace",
        connecting: "Conectando...",
        connected: "Conectado a Telegram",
        welcome_title: "Crea Im√°genes Asombrosas",
        welcome_subtitle: "Describe tu visi√≥n y observa c√≥mo la IA la hace realidad",
        prompt_label: "Prompt",
        prompt_placeholder: "Describe tu visi√≥n y observa c√≥mo la IA la hace realidad...",
        style_label: "Estilo",
        style_realistic: "Realista",
        style_artistic: "Art√≠stico",
        style_cartoon: "Dibujo animado",
        style_fantasy: "Fantas√≠a",
        style_anime: "Anime",
        style_cyberpunk: "Ciberpunk",
        style_popart: "Arte pop",
        style_abstract: "Abstracto",
        style_sketch: "Boceto",
        style_3d: "3D",
        style_sticker: "Sticker",
        style_vector: "Vector",
        style_interior: "Interior",
        style_architecture: "Arquitectura",
        style_fashion: "Moda",
        style_tattoo: "Tatuaje",
        style_print: "Impresi√≥n",
        style_logo: "Logo",
        style_icon: "Icono",
        style_banner: "Banner",
        mode_label: "Modo",
        mode_background_removal: "Eliminaci√≥n de fondo | img2img | ~1cr",
        mode_upscale_image: "Mejorar imagen | img2img | ~5cr",
        mode_print_maker: "Impresi√≥n | Sticker | POD Helper | txt2img | ~2cr",
        mode_photo_session: "Sesi√≥n de foto | Modelo Kontext | img2img | ~5cr",
        mode_fast_generation: "M√°s r√°pido | Im√°genes simples | txt2img | ~1cr",
        mode_pixplace_pro: "pixPLace Pro | Logo | Texto | img2img | ~5cr",
        size_label: "Tama√±o",
        size_square: "1:1",
        size_portrait: "9:16",
        size_landscape: "16:9",
        generate_btn: "Generar imagen",
        processing_title: "Creando tu obra maestra",
        processing_subtitle: "Esto puede tardar hasta 60 segundos",
        step_analyzing: "Analizando el prompt",
        step_generating: "Generando imagen",
        step_finalizing: "Finalizando resultado",
        elapsed_time: "Tiempo transcurrido:",
        cancel_btn: "Cancelar",
        create_new: "Crear nuevo",
        view_history: "Ver historial",
        history_title: "Historial de generaciones",
        empty_history_title: "A√∫n no hay generaciones",
        empty_history_subtitle: "Crea tu primera imagen AI para verla aqu√≠",
        generation_cost: "Costo de generaci√≥n",
        error_prompt_required: "Por favor describe tu imagen",
        error_prompt_too_short: "Prompt demasiado corto (m√≠nimo 5 caracteres)",
        error_webhook_not_configured: "URL de webhook no configurada",
        error_generation_failed: "La generaci√≥n fall√≥",
        error_timeout: "Tiempo de generaci√≥n agotado. Int√©ntalo de nuevo.",
        success_generated: "¬°Imagen generada con √©xito!",
        copied_to_clipboard: "Copiado al portapapeles",
        download_started: "Descarga iniciada",
        limit_title: "L√≠mite de generaci√≥n alcanzado",
        limit_message: "Has alcanzado tu l√≠mite gratuito de generaciones. ¬°Actualiza para seguir creando im√°genes asombrosas!",
        check_subsciption: "Comprobar suscripci√≥n",
        closeLimitModal: "Quiz√°s m√°s tarde",
        upgradeBtn: "Actualizar ahora",
        remove_user_image: "Eliminar",
        reference_image: "Referencia",
        upload_image: "Subir imagen",
        please_upload_photo_session: "Por favor sube tu foto de rostro para el modo Foto. O elige otro modo",
        upload_failed: "Error al subir la imagen. Intenta de nuevo.",
        please_upload_for_upscale: "Por favor sube una imagen para mejorar.",
        please_upload_for_background_removal: "Por favor sube una imagen para eliminar el fondo."
    },

    fr: {
        loading: "S'il vous pla√Æt, amusez-vous",
        app_title: "pixPLace",
        connecting: "Connexion...",
        connected: "Connect√© √† Telegram",
        welcome_title: "Cr√©ez des images incroyables",
        welcome_subtitle: "D√©crivez votre vision et regardez l'IA la concr√©tiser",
        prompt_label: "Prompt",
        prompt_placeholder: "D√©crivez votre vision et regardez l'IA la concr√©tiser...",
        style_label: "Style",
        style_realistic: "R√©aliste",
        style_artistic: "Artistique",
        style_cartoon: "Dessin√©",
        style_fantasy: "Fantaisie",
        style_anime: "Anime",
        style_cyberpunk: "Cyberpunk",
        style_popart: "Pop Art",
        style_abstract: "Abstrait",
        style_sketch: "Croquis",
        style_3d: "3D",
        style_sticker: "Autocollant",
        style_vector: "Vecteur",
        style_interior: "Int√©rieur",
        style_architecture: "Architecture",
        style_fashion: "Mode",
        style_tattoo: "Tatouage",
        style_print: "Impression",
        style_logo: "Logo",
        style_icon: "Ic√¥ne",
        style_banner: "Banni√®re",
        mode_label: "Mode",
        mode_background_removal: "Suppression de fond | img2img | ~1cr",
        mode_upscale_image: "Am√©liorer l'image | img2img | ~5cr",
        mode_print_maker: "Impression | Sticker | POD Helper | txt2img | ~2cr",
        mode_photo_session: "Session photo | Mod√®le Kontext | img2img | ~5cr",
        mode_fast_generation: "Le plus rapide | Images simples | txt2img | ~1cr",
        mode_pixplace_pro: "pixPLace Pro | Logo | Texte | img2img | ~5cr",
        size_label: "Taille",
        size_square: "1:1",
        size_portrait: "9:16",
        size_landscape: "16:9",
        generate_btn: "G√©n√©rer l'image",
        processing_title: "Cr√©ation de votre chef-d'≈ìuvre",
        processing_subtitle: "Cela peut prendre jusqu'√† 60 secondes",
        step_analyzing: "Analyse du prompt",
        step_generating: "G√©n√©ration de l'image",
        step_finalizing: "Finalisation du r√©sultat",
        elapsed_time: "Temps √©coul√© :",
        cancel_btn: "Annuler",
        create_new: "Cr√©er nouveau",
        view_history: "Voir l'historique",
        history_title: "Historique de g√©n√©ration",
        empty_history_title: "Pas encore de g√©n√©rations",
        empty_history_subtitle: "Cr√©ez votre premi√®re image IA pour la voir ici",
        generation_time: "Temps de g√©n√©ration",
        error_prompt_required: "Veuillez d√©crire votre image",
        error_prompt_too_short: "Prompt trop court (minimum 5 caract√®res)",
        error_webhook_not_configured: "URL du webhook non configur√©e",
        error_generation_failed: "√âchec de la g√©n√©ration",
        error_timeout: "Temps de g√©n√©ration √©coul√©. Veuillez r√©essayer.",
        success_generated: "Image g√©n√©r√©e avec succ√®s !",
        copied_to_clipboard: "Copi√© dans le presse-papiers",
        download_started: "T√©l√©chargement d√©marr√©",
        limit_title: "Limite de g√©n√©ration atteinte",
        limit_message: "Vous avez atteint votre limite gratuite de g√©n√©rations. Passez √† la version payante pour continuer √† cr√©er des images incroyables !",
        check_subsciption: "V√©rifier l'abonnement",
        closeLimitModal: "Peut-√™tre plus tard",
        upgradeBtn: "Mettre √† niveau",
        remove_user_image: "Supprimer",
        reference_image: "R√©f√©rence",
        upload_image: "T√©l√©verser une image",
        please_upload_photo_session: "Veuillez t√©l√©verser la photo de votre visage pour le mode Session Photo. Ou choisissez un autre mode",
        upload_failed: "√âchec du t√©l√©versement de l'image. Veuillez r√©essayer.",
        please_upload_for_upscale: "Veuillez t√©l√©verser une image pour l'am√©lioration.",
        please_upload_for_background_removal: "Veuillez t√©l√©verser une image pour la suppression de fond."
    },

    de: {
        loading: "Bitte, hab Spa√ü",
        app_title: "pixPLace",
        connecting: "Verbindung wird hergestellt...",
        connected: "Verbunden mit Telegram",
        welcome_title: "Erstelle erstaunliche Bilder",
        welcome_subtitle: "Beschreibe deine Vision und sieh zu, wie die KI sie zum Leben erweckt",
        prompt_label: "Prompt",
        prompt_placeholder: "Beschreibe deine Vision und sieh zu, wie die KI sie zum Leben erweckt...",
        style_label: "Stil",
        style_realistic: "Realistisch",
        style_artistic: "K√ºnstlerisch",
        style_cartoon: "Cartoon",
        style_fantasy: "Fantasy",
        style_anime: "Anime",
        style_cyberpunk: "Cyberpunk",
        style_popart: "Pop Art",
        style_abstract: "Abstrakt",
        style_sketch: "Skizze",
        style_3d: "3D",
        style_sticker: "Sticker",
        style_vector: "Vektor",
        style_interior: "Innenraum",
        style_architecture: "Architektur",
        style_fashion: "Mode",
        style_tattoo: "Tattoo",
        style_print: "Druck",
        style_logo: "Logo",
        style_icon: "Icon",
        style_banner: "Banner",
        mode_label: "Modus",
        mode_background_removal: "Hintergrund entfernen | img2img | ~1cr",
        mode_upscale_image: "Bild hochskalieren | img2img | ~5cr",
        mode_print_maker: "Druck | Sticker | POD Helfer | txt2img | ~2cr",
        mode_photo_session: "Fotosession | Kontext-Modell | img2img | ~5cr",
        mode_fast_generation: "Schnellste | Einfache Bilder | txt2img | ~1cr",
        mode_pixplace_pro: "pixPLace Pro | Logo | Text | img2img | ~5cr",
        size_label: "Gr√∂√üe",
        size_square: "1:1",
        size_portrait: "9:16",
        size_landscape: "16:9",
        generate_btn: "Bild erzeugen",
        processing_title: "Dein Meisterwerk wird erstellt",
        processing_subtitle: "Das kann bis zu 60 Sekunden dauern",
        step_analyzing: "Prompt wird analysiert",
        step_generating: "Bild wird generiert",
        step_finalizing: "Ergebnis wird finalisiert",
        elapsed_time: "Verstrichene Zeit:",
        cancel_btn: "Abbrechen",
        create_new: "Neu erstellen",
        view_history: "Verlauf anzeigen",
        history_title: "Generierungsverlauf",
        empty_history_title: "Noch keine Generierungen",
        empty_history_subtitle: "Erstelle dein erstes KI-Bild, um es hier zu sehen",
        generation_time: "Generierungszeit",
        error_prompt_required: "Bitte beschreibe dein Bild",
        error_prompt_too_short: "Prompt zu kurz (mindestens 5 Zeichen)",
        error_webhook_not_configured: "Webhook-URL nicht konfiguriert",
        error_generation_failed: "Generierung fehlgeschlagen",
        error_timeout: "Generierungszeit √ºberschritten. Bitte erneut versuchen.",
        success_generated: "Bild erfolgreich erstellt!",
        copied_to_clipboard: "In Zwischenablage kopiert",
        download_started: "Download gestartet",
        limit_title: "Generierungslimit erreicht",
        limit_message: "Du hast dein kostenloses Generierungslimit erreicht. Upgrade, um weiter erstaunliche Bilder zu erstellen!",
        check_subsciption: "Abonnement pr√ºfen",
        closeLimitModal: "Vielleicht sp√§ter",
        upgradeBtn: "Jetzt upgraden",
        remove_user_image: "Entfernen",
        reference_image: "Referenz",
        upload_image: "Bild hochladen",
        please_upload_photo_session: "Bitte lade dein Foto mit Gesicht f√ºr den Foto-Session-Modus hoch. Oder w√§hle einen anderen Modus",
        upload_failed: "Hochladen des Bildes fehlgeschlagen. Bitte erneut versuchen.",
        please_upload_for_upscale: "Bitte lade ein Bild zum Hochskalieren hoch.",
        please_upload_for_background_removal: "Bitte lade ein Bild zur Hintergrundentfernung hoch."
    },

    zh: {
        loading: "ËØ∑Â∞ΩÊÉÖ‰∫´Âèó",
        app_title: "pixPLace",
        connecting: "ËøûÊé•‰∏≠...",
        connected: "Â∑≤ËøûÊé•Âà∞ Telegram",
        welcome_title: "ÂàõÂª∫ÊÉäËâ≥ÁöÑÂõæÁâá",
        welcome_subtitle: "ÊèèËø∞‰Ω†ÁöÑËÆæÊÉ≥ÔºåËßÇÁúã AI Â∞ÜÂÖ∂Âèò‰∏∫Áé∞ÂÆû",
        prompt_label: "ÊèêÁ§∫",
        prompt_placeholder: "ÊèèËø∞‰Ω†ÁöÑËÆæÊÉ≥ÔºåËßÇÁúã AI Â∞ÜÂÖ∂Âèò‰∏∫Áé∞ÂÆû...",
        style_label: "È£éÊ†º",
        style_realistic: "ÂÜôÂÆû",
        style_artistic: "Ëâ∫ÊúØ",
        style_cartoon: "Âç°ÈÄö",
        style_fantasy: "Â•áÂπª",
        style_anime: "Âä®Êº´",
        style_cyberpunk: "ËµõÂçöÊúãÂÖã",
        style_popart: "Ê≥¢ÊôÆËâ∫ÊúØ",
        style_abstract: "ÊäΩË±°",
        style_sketch: "ÈÄüÂÜô",
        style_3d: "3D",
        style_sticker: "Ë¥¥Á∫∏",
        style_vector: "Áü¢Èáè",
        style_interior: "ÂÆ§ÂÜÖ",
        style_architecture: "Âª∫Á≠ë",
        style_fashion: "Êó∂Â∞ö",
        style_tattoo: "Á∫πË∫´",
        style_print: "Âç∞Âà∑",
        style_logo: "Ê†áÂøó",
        style_icon: "ÂõæÊ†á",
        style_banner: "Ê®™ÂπÖ",
        mode_label: "Ê®°Âºè",
        mode_background_removal: "ÂéªËÉå | img2img | ~1cr",
        mode_upscale_image: "ÊîæÂ§ßÂõæÁâá | img2img | ~5cr",
        mode_print_maker: "Âç∞Âà∑ | Ë¥¥Á∫∏ | POD Âä©Êâã | txt2img | ~2cr",
        mode_photo_session: "ÊãçÁÖßÊ®°Âºè | Kontext Ê®°Âûã | img2img | ~5cr",
        mode_fast_generation: "ÊúÄÂø´ | ÁÆÄÂçïÂõæÁâá | txt2img | ~1cr",
        mode_pixplace_pro: "pixPLace Pro | Logo | ÊñáÊú¨ | img2img | ~5cr",
        size_label: "Â∞∫ÂØ∏",
        size_square: "1:1",
        size_portrait: "9:16",
        size_landscape: "16:9",
        generate_btn: "ÁîüÊàêÂõæÁâá",
        processing_title: "Ê≠£Âú®Âàõ‰Ωú‰Ω†ÁöÑÊù∞‰Ωú",
        processing_subtitle: "ËøôÂèØËÉΩÈúÄË¶ÅÊúÄÂ§ö 60 Áßí",
        step_analyzing: "Ê≠£Âú®ÂàÜÊûêÊèêÁ§∫",
        step_generating: "Ê≠£Âú®ÁîüÊàêÂõæÁâá",
        step_finalizing: "Ê≠£Âú®ÂÆåÊàêÁªìÊûú",
        elapsed_time: "Â∑≤Áî®Êó∂Èó¥Ôºö",
        cancel_btn: "ÂèñÊ∂à",
        create_new: "ÂàõÂª∫Êñ∞Âª∫",
        view_history: "Êü•ÁúãÂéÜÂè≤",
        history_title: "ÁîüÊàêÂéÜÂè≤",
        empty_history_title: "Â∞öÊó†ÁîüÊàêËÆ∞ÂΩï",
        empty_history_subtitle: "ÂàõÂª∫‰Ω†ÁöÑÁ¨¨‰∏ÄÂº† AI ÂõæÁâá‰ª•Âú®Ê≠§Êü•Áúã",
        generation_time: "ÁîüÊàêÊó∂Èó¥",
        error_prompt_required: "ËØ∑ÊèèËø∞‰Ω†ÁöÑÂõæÁâá",
        error_prompt_too_short: "ÊèêÁ§∫ËøáÁü≠ÔºàÊúÄÂ∞ë 5 ‰∏™Â≠óÁ¨¶Ôºâ",
        error_webhook_not_configured: "Webhook URL Êú™ÈÖçÁΩÆ",
        error_generation_failed: "ÁîüÊàêÂ§±Ë¥•",
        error_timeout: "ÁîüÊàêË∂ÖÊó∂„ÄÇËØ∑ÈáçËØï„ÄÇ",
        success_generated: "ÂõæÁâáÁîüÊàêÊàêÂäüÔºÅ",
        copied_to_clipboard: "Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø",
        download_started: "Â∑≤ÂºÄÂßã‰∏ãËΩΩ",
        limit_title: "ËææÂà∞ÁîüÊàêÈôêÂà∂",
        limit_message: "‰Ω†Â∑≤ËææÂà∞ÂÖçË¥πÁîüÊàêÈôêÂà∂„ÄÇÂçáÁ∫ß‰ª•ÁªßÁª≠ÂàõÂª∫ÊÉäËâ≥ÂõæÁâáÔºÅ",
        check_subsciption: "Ê£ÄÊü•ËÆ¢ÈòÖ",
        closeLimitModal: "‰πüËÆ∏Á®çÂêé",
        upgradeBtn: "Á´ãÂç≥ÂçáÁ∫ß",
        remove_user_image: "ÁßªÈô§",
        reference_image: "ÂèÇËÄÉ",
        upload_image: "‰∏ä‰º†ÂõæÁâá",
        please_upload_photo_session: "ËØ∑‰∏∫ÊãçÁÖßÊ®°Âºè‰∏ä‰º†‰Ω†ÁöÑÈù¢ÈÉ®ÁÖßÁâá„ÄÇÊàñÈÄâÊã©ÂÖ∂‰ªñÊ®°Âºè",
        upload_failed: "ÂõæÁâá‰∏ä‰º†Â§±Ë¥•„ÄÇËØ∑ÈáçËØï„ÄÇ",
        please_upload_for_upscale: "ËØ∑‰∏ä‰º†ÂõæÁâá‰ª•ËøõË°åÊîæÂ§ß„ÄÇ",
        please_upload_for_background_removal: "ËØ∑‰∏ä‰º†ÂõæÁâá‰ª•ËøõË°åÂéªËÉåÊôØ„ÄÇ"
    },

    pt: {
        loading: "Por favor, divirta-se",
        app_title: "pixPLace",
        connecting: "Conectando...",
        connected: "Conectado ao Telegram",
        welcome_title: "Crie Imagens Incr√≠veis",
        welcome_subtitle: "Descreva sua vis√£o e veja a IA torn√°‚Äëla realidade",
        prompt_label: "Prompt",
        prompt_placeholder: "Descreva sua vis√£o e veja a IA torn√°‚Äëla realidade...",
        style_label: "Estilo",
        style_realistic: "Realista",
        style_artistic: "Art√≠stico",
        style_cartoon: "Cartoon",
        style_fantasy: "Fantasia",
        style_anime: "Anime",
        style_cyberpunk: "Cyberpunk",
        style_popart: "Pop Art",
        style_abstract: "Abstrato",
        style_sketch: "Esbo√ßo",
        style_3d: "3D",
        style_sticker: "Adesivo",
        style_vector: "Vetor",
        style_interior: "Interiores",
        style_architecture: "Arquitetura",
        style_fashion: "Moda",
        style_tattoo: "Tatuagem",
        style_print: "Impress√£o",
        style_logo: "Logo",
        style_icon: "√çcone",
        style_banner: "Banner",
        mode_label: "Modo",
        mode_background_removal: "Remo√ß√£o de Fundo | img2img | ~1cr",
        mode_upscale_image: "Aprimorar Imagem | img2img | ~5cr",
        mode_print_maker: "Impress√£o | Adesivo | POD Helper | txt2img | ~2cr",
        mode_photo_session: "Sess√£o de Foto | Modelo Kontext | img2img | ~5cr",
        mode_fast_generation: "Mais R√°pido | Imagens Simples | txt2img | ~1cr",
        mode_pixplace_pro: "pixPLace Pro | Logo | Texto | img2img | ~5cr",
        size_label: "Tamanho",
        size_square: "1:1",
        size_portrait: "9:16",
        size_landscape: "16:9",
        generate_btn: "Gerar Imagem",
        processing_title: "Criando sua obra-prima",
        processing_subtitle: "Isso pode levar at√© 60 segundos",
        step_analyzing: "Analisando prompt",
        step_generating: "Gerando imagem",
        step_finalizing: "Finalizando resultado",
        elapsed_time: "Tempo decorrido:",
        cancel_btn: "Cancelar",
        create_new: "Criar novo",
        view_history: "Ver hist√≥rico",
        history_title: "Hist√≥rico de gera√ß√µes",
        empty_history_title: "Ainda sem gera√ß√µes",
        empty_history_subtitle: "Crie sua primeira imagem AI para v√™‚Äëla aqui",
        generation_time: "Tempo de gera√ß√£o",
        error_prompt_required: "Por favor descreva sua imagem",
        error_prompt_too_short: "Prompt muito curto (m√≠nimo 5 caracteres)",
        error_webhook_not_configured: "URL do webhook n√£o configurada",
        error_generation_failed: "Gera√ß√£o falhou",
        error_timeout: "Tempo de gera√ß√£o esgotado. Por favor, tente novamente.",
        success_generated: "Imagem gerada com sucesso!",
        copied_to_clipboard: "Copiado para a √°rea de transfer√™ncia",
        download_started: "Download iniciado",
        limit_title: "Limite de gera√ß√£o atingido",
        limit_message: "Voc√™ atingiu seu limite gratuito de gera√ß√µes. Fa√ßa upgrade para continuar criando imagens incr√≠veis!",
        check_subsciption: "Verificar assinatura",
        closeLimitModal: "Talvez depois",
        upgradeBtn: "Fazer upgrade",
        remove_user_image: "Remover",
        reference_image: "Refer√™ncia",
        upload_image: "Enviar imagem",
        please_upload_photo_session: "Por favor carregue sua foto de rosto para o modo Sess√£o de Foto. Ou escolha outro modo",
        upload_failed: "Falha ao enviar a imagem. Por favor, tente novamente.",
        please_upload_for_upscale: "Por favor envie uma imagem para aprimorar.",
        please_upload_for_background_removal: "Por favor envie uma imagem para remo√ß√£o de fundo."
    },

    ar: {
        loading: "ŸÖŸÜ ŸÅÿ∂ŸÑŸÉ ÿßÿ≥ÿ™ŸÖÿ™ÿπ",
        app_title: "pixPLace",
        connecting: "ÿ¨ÿßÿ±Ÿç ÿßŸÑÿßÿ™ÿµÿßŸÑ...",
        connected: "ŸÖÿ™ÿµŸÑ ÿ®ŸÄ Telegram",
        welcome_title: "ÿ£ŸÜÿ¥ÿ¶ ÿµŸàÿ±Ÿãÿß ŸÖÿØŸáÿ¥ÿ©",
        welcome_subtitle: "ŸàÿµŸÅ ÿ±ÿ§Ÿäÿ™ŸÉ Ÿàÿ¥ÿßŸáÿØ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä Ÿäÿ≠ŸÇŸÇŸáÿß",
        prompt_label: "ÿßŸÑŸÖÿ∑ÿßŸÑÿ®ÿ©",
        prompt_placeholder: "ŸàÿµŸÅ ÿ±ÿ§Ÿäÿ™ŸÉ Ÿàÿ¥ÿßŸáÿØ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä Ÿäÿ≠ŸÇŸÇŸáÿß...",
        style_label: "ÿßŸÑÿ£ÿ≥ŸÑŸàÿ®",
        style_realistic: "ŸàÿßŸÇÿπŸä",
        style_artistic: "ŸÅŸÜŸä",
        style_cartoon: "ÿ±ÿ≥ŸàŸÖ ŸÖÿ™ÿ≠ÿ±ŸÉÿ©",
        style_fantasy: "ÿÆŸäÿßŸÑŸä",
        style_anime: "ÿ£ŸÜŸÖŸä",
        style_cyberpunk: "ÿ≥ÿßŸäÿ®ÿ± ÿ®ÿßŸÜŸÉ",
        style_popart: "ÿ®Ÿàÿ® ÿ¢ÿ±ÿ™",
        style_abstract: "ÿ™ÿ¨ÿ±ŸäÿØŸä",
        style_sketch: "ÿ≥ŸÉŸäÿ™ÿ¥",
        style_3d: "3D",
        style_sticker: "ŸÖŸÑÿµŸÇ",
        style_vector: "ŸÅŸäŸÉÿ™Ÿàÿ±",
        style_interior: "ÿØÿßÿÆŸÑŸä",
        style_architecture: "ŸáŸÜÿØÿ≥ÿ© ŸÖÿπŸÖÿßÿ±Ÿäÿ©",
        style_fashion: "ŸÖŸàÿ∂ÿ©",
        style_tattoo: "Ÿàÿ¥ŸÖ",
        style_print: "ÿ∑ÿ®ÿßÿπÿ©",
        style_logo: "ÿ¥ÿπÿßÿ±",
        style_icon: "ÿ£ŸäŸÇŸàŸÜÿ©",
        style_banner: "ŸÑÿßŸÅÿ™ÿ©",
        mode_label: "ÿßŸÑŸàÿ∂ÿπ",
        mode_background_removal: "ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿÆŸÑŸÅŸäÿ© | img2img | ~1cr",
        mode_upscale_image: "ÿ™ŸÉÿ®Ÿäÿ± ÿßŸÑÿµŸàÿ±ÿ© | img2img | ~5cr",
        mode_print_maker: "ÿ∑ÿ®ÿßÿπÿ© | ŸÖŸÑÿµŸÇ | POD ŸÖÿ≥ÿßÿπÿØ | txt2img | ~2cr",
        mode_photo_session: "ÿ¨ŸÑÿ≥ÿ© ÿ™ÿµŸàŸäÿ± | ŸÜŸÖŸàÿ∞ÿ¨ Kontext | img2img | ~5cr",
        mode_fast_generation: "ÿßŸÑÿ£ÿ≥ÿ±ÿπ | ÿµŸàÿ± ÿ®ÿ≥Ÿäÿ∑ÿ© | txt2img | ~1cr",
        mode_pixplace_pro: "pixPLace Pro | ÿ¥ÿπÿßÿ± | ŸÜÿµ | img2img | ~5cr",
        size_label: "ÿßŸÑÿ≠ÿ¨ŸÖ",
        size_square: "1:1",
        size_portrait: "9:16",
        size_landscape: "16:9",
        generate_btn: "ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿµŸàÿ±ÿ©",
        processing_title: "ŸÜŸÇŸàŸÖ ÿ®ÿ•ŸÜÿ¥ÿßÿ° ÿ™ÿ≠ŸÅÿ™ŸÉ ÿßŸÑŸÅŸÜŸäÿ©",
        processing_subtitle: "ŸÇÿØ Ÿäÿ≥ÿ™ÿ∫ÿ±ŸÇ Ÿáÿ∞ÿß ÿ≠ÿ™Ÿâ 60 ÿ´ÿßŸÜŸäÿ©",
        step_analyzing: "ÿ¨ÿßÿ±Ÿç ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖÿ∑ÿßŸÑÿ®ÿ©",
        step_generating: "ÿ¨ÿßÿ±Ÿç ÿ™ŸàŸÑŸäÿØ ÿßŸÑÿµŸàÿ±ÿ©",
        step_finalizing: "ÿ¨ÿßÿ±Ÿç ÿ•ŸÜŸáÿßÿ° ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©",
        elapsed_time: "ÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÖŸÜŸÇÿ∂Ÿä:",
        cancel_btn: "ÿ•ŸÑÿ∫ÿßÿ°",
        create_new: "ÿ•ŸÜÿ¥ÿßÿ° ÿ¨ÿØŸäÿØ",
        view_history: "ÿπÿ±ÿ∂ ÿßŸÑÿ≥ÿ¨ŸÑ",
        history_title: "ÿ≥ÿ¨ŸÑ ÿßŸÑÿ•ŸÜÿ¥ÿßÿ°",
        empty_history_title: "ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿπŸÖŸÑŸäÿßÿ™ ÿ•ŸÜÿ¥ÿßÿ° ÿ®ÿπÿØ",
        empty_history_subtitle: "ÿ£ŸÜÿ¥ÿ¶ ÿµŸàÿ±ÿ™ŸÉ ÿßŸÑÿ£ŸàŸÑŸâ ÿ®Ÿàÿßÿ≥ÿ∑ÿ© ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ŸÑÿ™ÿ∏Ÿáÿ± ŸáŸÜÿß",
        generation_time: "ÿ≤ŸÖŸÜ ÿßŸÑÿ™ŸàŸÑŸäÿØ",
        error_prompt_required: "Ÿäÿ±ÿ¨Ÿâ ŸàÿµŸÅ ÿµŸàÿ±ÿ™ŸÉ",
        error_prompt_too_short: "ÿßŸÑŸÖÿ∑ÿßŸÑÿ®ÿ© ŸÇÿµŸäÿ±ÿ© ÿ¨ÿØŸãÿß (ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ÿØŸÜŸâ 5 ÿ£ÿ≠ÿ±ŸÅ)",
        error_webhook_not_configured: "ÿπŸÜŸàÿßŸÜ Webhook ÿ∫Ÿäÿ± ŸÖŸáŸäÿ£",
        error_generation_failed: "ŸÅÿ¥ŸÑÿ™ ÿπŸÖŸÑŸäÿ© ÿßŸÑÿ™ŸàŸÑŸäÿØ",
        error_timeout: "ÿßŸÜÿ™Ÿáÿ™ ŸÖŸáŸÑÿ© ÿßŸÑÿ™ŸàŸÑŸäÿØ. ÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.",
        success_generated: "ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿµŸàÿ±ÿ© ÿ®ŸÜÿ¨ÿßÿ≠!",
        copied_to_clipboard: "ÿ™ŸÖ ÿßŸÑŸÜÿ≥ÿÆ ÿ•ŸÑŸâ ÿßŸÑÿ≠ÿßŸÅÿ∏ÿ©",
        download_started: "ÿ™ŸÖ ÿ®ÿØÿ° ÿßŸÑÿ™ŸÜÿ≤ŸäŸÑ",
        limit_title: "ÿ™ŸÖ ÿßŸÑŸàÿµŸàŸÑ ŸÑÿ≠ÿØ ÿßŸÑÿ™ŸàŸÑŸäÿØ",
        limit_message: "ŸÑŸÇÿØ ŸàÿµŸÑÿ™ ÿ•ŸÑŸâ ÿ≠ÿØ ÿßŸÑÿ™ŸàŸÑŸäÿØ ÿßŸÑŸÖÿ¨ÿßŸÜŸä ÿßŸÑÿÆÿßÿµ ÿ®ŸÉ. ŸÇŸÖ ÿ®ÿßŸÑÿ™ÿ±ŸÇŸäÿ© ŸÑŸÑÿßÿ≥ÿ™ŸÖÿ±ÿßÿ± ŸÅŸä ÿ•ŸÜÿ¥ÿßÿ° ÿµŸàÿ± ŸÖÿ∞ŸáŸÑÿ©!",
        check_subsciption: "ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿßÿ¥ÿ™ÿ±ÿßŸÉ",
        closeLimitModal: "ÿ±ÿ®ŸÖÿß ŸÑÿßÿ≠ŸÇŸãÿß",
        upgradeBtn: "ÿßŸÑÿ™ÿ±ŸÇŸäÿ© ÿßŸÑÿ¢ŸÜ",
        remove_user_image: "ÿ•ÿ≤ÿßŸÑÿ©",
        reference_image: "ŸÖÿ±ÿ¨ÿπ",
        upload_image: "ÿ™ÿ≠ŸÖŸäŸÑ ÿµŸàÿ±ÿ©",
        please_upload_photo_session: "Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ≠ŸÖŸäŸÑ ÿµŸàÿ±ÿ© Ÿàÿ¨ŸáŸÉ ŸÑŸàÿ∂ÿπ ÿ¨ŸÑÿ≥ÿ© ÿßŸÑÿ™ÿµŸàŸäÿ±. ÿ£Ÿà ÿßÿÆÿ™ÿ± Ÿàÿ∂ÿπŸãÿß ÿ¢ÿÆÿ±",
        upload_failed: "ŸÅÿ¥ŸÑ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸàÿ±ÿ©. ÿ≠ÿßŸàŸÑ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ.",
        please_upload_for_upscale: "Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ≠ŸÖŸäŸÑ ÿµŸàÿ±ÿ© ŸÑŸÑÿ™ÿ≠ÿ≥ŸäŸÜ.",
        please_upload_for_background_removal: "Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ≠ŸÖŸäŸÑ ÿµŸàÿ±ÿ© ŸÑÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿÆŸÑŸÅŸäÿ©."
    },

    hi: {
        loading: "‡§ï‡•É‡§™‡§Ø‡§æ, ‡§Ü‡§®‡§Ç‡§¶ ‡§≤‡•á‡§Ç",
        app_title: "pixPLace",
        connecting: "‡§ï‡§®‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...",
        connected: "Telegram ‡§∏‡•á ‡§ú‡•Å‡§°‡§º‡§æ ‡§π‡•Å‡§Ü",
        welcome_title: "‡§Ö‡§¶‡•ç‡§≠‡•Å‡§§ ‡§ö‡§ø‡§§‡•ç‡§∞ ‡§¨‡§®‡§æ‡§Ø‡•á‡§Ç",
        welcome_subtitle: "‡§Ö‡§™‡§®‡•Ä ‡§ï‡§≤‡•ç‡§™‡§®‡§æ ‡§ï‡§æ ‡§µ‡§∞‡•ç‡§£‡§® ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§¶‡•á‡§ñ‡•á‡§Ç ‡§ï‡§ø AI ‡§á‡§∏‡•á ‡§ï‡•à‡§∏‡•á ‡§∏‡§æ‡§ï‡§æ‡§∞ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à",
        prompt_label: "Prompt",
        prompt_placeholder: "‡§Ö‡§™‡§®‡•Ä ‡§ï‡§≤‡•ç‡§™‡§®‡§æ ‡§ï‡§æ ‡§µ‡§∞‡•ç‡§£‡§® ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§¶‡•á‡§ñ‡•á‡§Ç ‡§ï‡§ø AI ‡§á‡§∏‡•á ‡§ï‡•à‡§∏‡•á ‡§∏‡§æ‡§ï‡§æ‡§∞ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à...",
        style_label: "‡§∂‡•à‡§≤‡•Ä",
        style_realistic: "‡§Ø‡§•‡§æ‡§∞‡•ç‡§•‡§µ‡§æ‡§¶‡•Ä",
        style_artistic: "‡§ï‡§≤‡§æ‡§§‡•ç‡§Æ‡§ï",
        style_cartoon: "‡§ï‡§æ‡§∞‡•ç‡§ü‡•Ç‡§®",
        style_fantasy: "‡§´‡•à‡§Ç‡§ü‡•á‡§∏‡•Ä",
        style_anime: "‡§ê‡§®‡§ø‡§Æ‡•á",
        style_cyberpunk: "‡§∏‡§æ‡§á‡§¨‡§∞‡§™‡§Ç‡§ï",
        style_popart: "‡§™‡•â‡§™ ‡§Ü‡§∞‡•ç‡§ü",
        style_abstract: "‡§Ö‡§Æ‡•Ç‡§∞‡•ç‡§§",
        style_sketch: "‡§∏‡•ç‡§ï‡•á‡§ö",
        style_3d: "3D",
        style_sticker: "‡§∏‡•ç‡§ü‡§ø‡§ï‡§∞",
        style_vector: "‡§µ‡•à‡§ï‡•ç‡§ü‡§∞",
        style_interior: "‡§á‡§Ç‡§ü‡•Ä‡§∞‡§ø‡§Ø‡§∞",
        style_architecture: "‡§µ‡§æ‡§∏‡•ç‡§§‡•Å‡§ï‡§≤‡§æ",
        style_fashion: "‡§´‡•à‡§∂‡§®",
        style_tattoo: "‡§ü‡•à‡§ü‡•Ç",
        style_print: "‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü",
        style_logo: "‡§≤‡•ã‡§ó‡•ã",
        style_icon: "‡§Ü‡§á‡§ï‡§®",
        style_banner: "‡§¨‡•à‡§®‡§∞",
        mode_label: "‡§Æ‡•ã‡§°",
        mode_background_removal: "‡§¨‡•à‡§ï‡§ó‡•ç‡§∞‡§æ‡§â‡§Ç‡§° ‡§π‡§ü‡§æ‡§è‡§Ç | img2img | ~1cr",
        mode_upscale_image: "‡§á‡§Æ‡•á‡§ú ‡§Ö‡§™‡§∏‡•ç‡§ï‡•á‡§≤ | img2img | ~5cr",
        mode_print_maker: "‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü | ‡§∏‡•ç‡§ü‡§ø‡§ï‡§∞ | POD ‡§π‡•á‡§≤‡•ç‡§™‡§∞ | txt2img | ~2cr",
        mode_photo_session: "‡§´‡•ã‡§ü‡•ã ‡§∏‡§§‡•ç‡§∞ | Kontext ‡§Æ‡•â‡§°‡§≤ | img2img | ~5cr",
        mode_fast_generation: "‡§∏‡§¨‡§∏‡•á ‡§§‡•á‡§ú‡§º | ‡§∏‡§æ‡§ß‡§æ‡§∞‡§£ ‡§ö‡§ø‡§§‡•ç‡§∞ | txt2img | ~1cr",
        mode_pixplace_pro: "pixPLace Pro | ‡§≤‡•ã‡§ó‡•ã | ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü | img2img | ~5cr",
        size_label: "‡§Ü‡§ï‡§æ‡§∞",
        size_square: "1:1",
        size_portrait: "9:16",
        size_landscape: "16:9",
        generate_btn: "‡§ö‡§ø‡§§‡•ç‡§∞ ‡§¨‡§®‡§æ‡§è‡§Ç",
        processing_title: "‡§Ü‡§™‡§ï‡•Ä ‡§Æ‡§æ‡§∏‡•ç‡§ü‡§∞‡§™‡•Ä‡§∏ ‡§¨‡§®‡§æ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç",
        processing_subtitle: "‡§á‡§∏‡§Æ‡•á‡§Ç ‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ 60 ‡§∏‡•á‡§ï‡§Ç‡§° ‡§≤‡§ó ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç",
        step_analyzing: "‡§™‡•ç‡§∞‡•â‡§Æ‡•ç‡§™‡•ç‡§ü ‡§ï‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç",
        step_generating: "‡§ö‡§ø‡§§‡•ç‡§∞ ‡§¨‡§®‡§æ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç",
        step_finalizing: "‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§ï‡§∞ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç",
        elapsed_time: "‡§≤‡§ó‡§æ ‡§π‡•Å‡§Ü ‡§∏‡§Æ‡§Ø:",
        cancel_btn: "‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç",
        create_new: "‡§®‡§Ø‡§æ ‡§¨‡§®‡§æ‡§è‡§Ç",
        view_history: "‡§á‡§§‡§ø‡§π‡§æ‡§∏ ‡§¶‡•á‡§ñ‡•á‡§Ç",
        history_title: "‡§ú‡§®‡§∞‡•á‡§∂‡§® ‡§á‡§§‡§ø‡§π‡§æ‡§∏",
        empty_history_title: "‡§Ö‡§≠‡•Ä ‡§§‡§ï ‡§ï‡•ã‡§à ‡§ú‡§®‡§∞‡•á‡§∂‡§® ‡§®‡§π‡•Ä‡§Ç",
        empty_history_subtitle: "‡§á‡§∏‡•á ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ö‡§™‡§®‡•Ä ‡§™‡§π‡§≤‡•Ä AI ‡§á‡§Æ‡•á‡§ú ‡§¨‡§®‡§æ‡§è‡§Ç",
        generation_time: "‡§ú‡§®‡§∞‡•á‡§∂‡§® ‡§∏‡§Æ‡§Ø",
        error_prompt_required: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡•á ‡§ö‡§ø‡§§‡•ç‡§∞ ‡§ï‡§æ ‡§µ‡§∞‡•ç‡§£‡§® ‡§ï‡§∞‡•á‡§Ç",
        error_prompt_too_short: "‡§™‡•ç‡§∞‡•â‡§Æ‡•ç‡§™‡•ç‡§ü ‡§¨‡§π‡•Å‡§§ ‡§õ‡•ã‡§ü‡§æ (‡§®‡•ç‡§Ø‡•Ç‡§®‡§§‡§Æ 5 ‡§Ö‡§ï‡•ç‡§∑‡§∞)",
        error_webhook_not_configured: "Webhook URL ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à",
        error_generation_failed: "‡§ú‡§®‡§∞‡•á‡§∂‡§® ‡§µ‡§ø‡§´‡§≤ ‡§∞‡§π‡§æ",
        error_timeout: "‡§ú‡§®‡§∞‡•á‡§∂‡§® ‡§ï‡§æ ‡§∏‡§Æ‡§Ø ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§",
        success_generated: "‡§ö‡§ø‡§§‡•ç‡§∞ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§¨‡§®‡§æ‡§Ø‡§æ ‡§ó‡§Ø‡§æ!",
        copied_to_clipboard: "‡§ï‡•ç‡§≤‡§ø‡§™‡§¨‡•ã‡§∞‡•ç‡§° ‡§™‡§∞ ‡§ï‡•â‡§™‡•Ä ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ",
        download_started: "‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•Å‡§Ü",
        limit_title: "‡§ú‡§®‡§∞‡•á‡§∂‡§® ‡§∏‡•Ä‡§Æ‡§æ ‡§§‡§ï ‡§™‡§π‡•Å‡§Å‡§ö‡§æ",
        limit_message: "‡§Ü‡§™ ‡§Ö‡§™‡§®‡•Ä ‡§Æ‡•Å‡§´‡•ç‡§§ ‡§ú‡§®‡§∞‡•á‡§∂‡§® ‡§∏‡•Ä‡§Æ‡§æ ‡§§‡§ï ‡§™‡§π‡•Å‡§Å‡§ö ‡§ö‡•Å‡§ï‡•á ‡§π‡•à‡§Ç‡•§ ‡§Ö‡§¶‡•ç‡§Ø‡§§‡§® ‡§ï‡§∞‡•á‡§Ç ‡§§‡§æ‡§ï‡§ø ‡§Ü‡§™ ‡§î‡§∞ ‡§ö‡§ø‡§§‡•ç‡§∞ ‡§¨‡§®‡§æ ‡§∏‡§ï‡•á‡§Ç!",
        check_subsciption: "‡§∏‡§¶‡§∏‡•ç‡§Ø‡§§‡§æ ‡§¶‡•á‡§ñ‡•á‡§Ç",
        closeLimitModal: "‡§∂‡§æ‡§Ø‡§¶ ‡§¨‡§æ‡§¶ ‡§Æ‡•á‡§Ç",
        upgradeBtn: "‡§Ö‡§¨ ‡§Ö‡§™‡§ó‡•ç‡§∞‡•á‡§° ‡§ï‡§∞‡•á‡§Ç",
        remove_user_image: "‡§π‡§ü‡§æ‡§è‡§Ç",
        reference_image: "‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠",
        upload_image: "‡§õ‡§µ‡§ø ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç",
        please_upload_photo_session: "‡§´‡•ã‡§ü‡•ã ‡§∏‡§§‡•ç‡§∞ ‡§Æ‡•ã‡§° ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡§æ ‡§ö‡•á‡§π‡§∞‡§æ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§Ø‡§æ ‡§ï‡•ã‡§à ‡§Ö‡§®‡•ç‡§Ø ‡§Æ‡•ã‡§° ‡§ö‡•Å‡§®‡•á‡§Ç",
        upload_failed: "‡§õ‡§µ‡§ø ‡§Ö‡§™‡§≤‡•ã‡§° ‡§µ‡§ø‡§´‡§≤‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§",
        please_upload_for_upscale: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§∏‡•ç‡§ï‡•á‡§≤ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§õ‡§µ‡§ø ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç‡•§",
        please_upload_for_background_removal: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§¨‡•à‡§ï‡§ó‡•ç‡§∞‡§æ‡§â‡§Ç‡§° ‡§π‡§ü‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§õ‡§µ‡§ø ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç‡•§"
    },

    ja: {
        loading: "„Å©„ÅÜ„Åû„ÅäÊ•Ω„Åó„Åø„Åè„Å†„Åï„ÅÑ",
        app_title: "pixPLace",
        connecting: "Êé•Á∂ö‰∏≠...",
        connected: "Telegram „Å´Êé•Á∂ö„Åï„Çå„Åæ„Åó„Åü",
        welcome_title: "È©ö„Åè„Åπ„ÅçÁîªÂÉè„Çí‰ΩúÊàê",
        welcome_subtitle: "„ÅÇ„Å™„Åü„ÅÆ„Éì„Ç∏„Éß„É≥„ÇíË™¨Êòé„Åó„ÄÅAI „Åå„Åù„Çå„ÇíÂÆüÁèæ„Åô„ÇãÊßòÂ≠ê„ÇíË¶ã„Åæ„Åó„Çá„ÅÜ",
        prompt_label: "„Éó„É≠„É≥„Éó„Éà",
        prompt_placeholder: "„ÅÇ„Å™„Åü„ÅÆ„Éì„Ç∏„Éß„É≥„ÇíË™¨Êòé„Åó„ÄÅAI „Åå„Åù„Çå„ÇíÂÆüÁèæ„Åô„ÇãÊßòÂ≠ê„ÇíË¶ã„Åæ„Åó„Çá„ÅÜ...",
        style_label: "„Çπ„Çø„Ç§„É´",
        style_realistic: "„É™„Ç¢„É´",
        style_artistic: "„Ç¢„Éº„ÉÜ„Ç£„Çπ„ÉÜ„Ç£„ÉÉ„ÇØ",
        style_cartoon: "„Ç´„Éº„Éà„Ç•„Éº„É≥",
        style_fantasy: "„Éï„Ç°„É≥„Çø„Ç∏„Éº",
        style_anime: "„Ç¢„Éã„É°",
        style_cyberpunk: "„Çµ„Ç§„Éê„Éº„Éë„É≥„ÇØ",
        style_popart: "„Éù„ÉÉ„Éó„Ç¢„Éº„Éà",
        style_abstract: "ÊäΩË±°",
        style_sketch: "„Çπ„Ç±„ÉÉ„ÉÅ",
        style_3d: "3D",
        style_sticker: "„Çπ„ÉÜ„ÉÉ„Ç´„Éº",
        style_vector: "„Éô„ÇØ„Çø„Éº",
        style_interior: "„Ç§„É≥„ÉÜ„É™„Ç¢",
        style_architecture: "Âª∫ÁØâ",
        style_fashion: "„Éï„Ç°„ÉÉ„Ç∑„Éß„É≥",
        style_tattoo: "„Çø„Éà„Ç•„Éº",
        style_print: "„Éó„É™„É≥„Éà",
        style_logo: "„É≠„Ç¥",
        style_icon: "„Ç¢„Ç§„Ç≥„É≥",
        style_banner: "„Éê„Éä„Éº",
        mode_label: "„É¢„Éº„Éâ",
        mode_background_removal: "ËÉåÊôØÈô§Âéª | img2img | ~1cr",
        mode_upscale_image: "ÁîªÂÉè„Ç¢„ÉÉ„Éó„Çπ„Ç±„Éº„É´ | img2img | ~5cr",
        mode_print_maker: "Âç∞Âà∑ | „Çπ„ÉÜ„ÉÉ„Ç´„Éº | POD „Éò„É´„Éë„Éº | txt2img | ~2cr",
        mode_photo_session: "„Éï„Ç©„Éà„Çª„ÉÉ„Ç∑„Éß„É≥ | Kontext „É¢„Éá„É´ | img2img | ~5cr",
        mode_fast_generation: "ÊúÄÈÄü | „Ç∑„É≥„Éó„É´ÁîªÂÉè | txt2img | ~1cr",
        mode_pixplace_pro: "pixPLace Pro | „É≠„Ç¥ | „ÉÜ„Ç≠„Çπ„Éà | img2img | ~5cr",
        size_label: "„Çµ„Ç§„Ç∫",
        size_square: "1:1",
        size_portrait: "9:16",
        size_landscape: "16:9",
        generate_btn: "ÁîªÂÉè„ÇíÁîüÊàê",
        processing_title: "„ÅÇ„Å™„Åü„ÅÆÂÇë‰Ωú„Çí‰ΩúÊàê‰∏≠",
        processing_subtitle: "ÊúÄÂ§ß 60 Áßí„Åã„Åã„ÇãÂ†¥Âêà„Åå„ÅÇ„Çä„Åæ„Åô",
        step_analyzing: "„Éó„É≠„É≥„Éó„Éà„ÇíËß£Êûê‰∏≠",
        step_generating: "ÁîªÂÉè„ÇíÁîüÊàê‰∏≠",
        step_finalizing: "ÁµêÊûú„ÇíÊúÄÁµÇÂåñ„Åó„Å¶„ÅÑ„Åæ„Åô",
        elapsed_time: "ÁµåÈÅéÊôÇÈñìÔºö",
        cancel_btn: "„Ç≠„É£„É≥„Çª„É´",
        create_new: "Êñ∞Ë¶è‰ΩúÊàê",
        view_history: "Â±•Ê≠¥„ÇíË¶ã„Çã",
        history_title: "ÁîüÊàêÂ±•Ê≠¥",
        empty_history_title: "„Åæ„Å†ÁîüÊàê„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì",
        empty_history_subtitle: "„Åì„Åì„Å´Ë°®Á§∫„Åô„Çã„Å´„ÅØÊúÄÂàù„ÅÆ AI ÁîªÂÉè„Çí‰ΩúÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ",
        generation_time: "ÁîüÊàêÊôÇÈñì",
        error_prompt_required: "ÁîªÂÉè„ÇíË™¨Êòé„Åó„Å¶„Åè„Å†„Åï„ÅÑ",
        error_prompt_too_short: "„Éó„É≠„É≥„Éó„Éà„ÅåÁü≠„Åô„Åé„Åæ„ÅôÔºàÊúÄÂ∞è 5 ÊñáÂ≠óÔºâ",
        error_webhook_not_configured: "Webhook URL „ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì",
        error_generation_failed: "ÁîüÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü",
        error_timeout: "ÁîüÊàê„ÅÆ„Çø„Ç§„É†„Ç¢„Ç¶„Éà„ÄÇÂÜçË©¶Ë°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
        success_generated: "ÁîªÂÉè„ÅåÊ≠£Â∏∏„Å´ÁîüÊàê„Åï„Çå„Åæ„Åó„ÅüÔºÅ",
        copied_to_clipboard: "„ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å´„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü",
        download_started: "„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„ÇíÈñãÂßã„Åó„Åæ„Åó„Åü",
        limit_title: "ÁîüÊàêÂà∂Èôê„Å´ÈÅî„Åó„Åæ„Åó„Åü",
        limit_message: "ÁÑ°ÊñôÁîüÊàê„ÅÆ‰∏äÈôê„Å´ÈÅî„Åó„Åæ„Åó„Åü„ÄÇ„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ„Åó„Å¶Âºï„ÅçÁ∂ö„ÅçÁ¥†Êô¥„Çâ„Åó„ÅÑÁîªÂÉè„Çí‰ΩúÊàê„Åó„Åæ„Åó„Çá„ÅÜÔºÅ",
        check_subsciption: "„Çµ„Éñ„Çπ„ÇØ„É™„Éó„Ç∑„Éß„É≥„ÇíÁ¢∫Ë™ç",
        closeLimitModal: "Âæå„Åß",
        upgradeBtn: "‰ªä„Åô„Åê„Ç¢„ÉÉ„Éó„Ç∞„É¨„Éº„Éâ",
        remove_user_image: "ÂâäÈô§",
        reference_image: "ÂèÇÁÖß",
        upload_image: "ÁîªÂÉè„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ",
        please_upload_photo_session: "„Éï„Ç©„Éà„Çª„ÉÉ„Ç∑„Éß„É≥„É¢„Éº„Éâ„Å´„ÅØÈ°îÂÜôÁúü„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ‰ªñ„ÅÆ„É¢„Éº„Éâ„ÇíÈÅ∏„Å∂„Åì„Å®„ÇÇ„Åß„Åç„Åæ„Åô",
        upload_failed: "ÁîªÂÉè„ÅÆ„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇÂÜçË©¶Ë°å„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
        please_upload_for_upscale: "„Ç¢„ÉÉ„Éó„Çπ„Ç±„Éº„É´„Åô„Çã„Åü„ÇÅ„ÅÆÁîªÂÉè„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
        please_upload_for_background_removal: "ËÉåÊôØÈô§ÂéªÁî®„ÅÆÁîªÂÉè„Çí„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"
    },

    it: {
        loading: "Per favore, divertiti",
        app_title: "pixPLace",
        connecting: "Connessione in corso...",
        connected: "Connesso a Telegram",
        welcome_title: "Crea immagini sorprendenti",
        welcome_subtitle: "Descrivi la tua visione e guarda l'IA realizzarla",
        prompt_label: "Prompt",
        prompt_placeholder: "Descrivi la tua visione e guarda l'IA realizzarla...",
        style_label: "Stile",
        style_realistic: "Realistico",
        style_artistic: "Artistico",
        style_cartoon: "Cartoon",
        style_fantasy: "Fantasy",
        style_anime: "Anime",
        style_cyberpunk: "Cyberpunk",
        style_popart: "Pop Art",
        style_abstract: "Astratto",
        style_sketch: "Schizzo",
        style_3d: "3D",
        style_sticker: "Sticker",
        style_vector: "Vettoriale",
        style_interior: "Interni",
        style_architecture: "Architettura",
        style_fashion: "Moda",
        style_tattoo: "Tatuaggio",
        style_print: "Stampa",
        style_logo: "Logo",
        style_icon: "Icona",
        style_banner: "Banner",
        mode_label: "Modalit√†",
        mode_background_removal: "Rimozione sfondo | img2img | ~1cr",
        mode_upscale_image: "Upscale immagine | img2img | ~5cr",
        mode_print_maker: "Stampa | Sticker | POD Helper | txt2img | ~2cr",
        mode_photo_session: "Sessione foto | Modello Kontext | img2img | ~5cr",
        mode_fast_generation: "Pi√π veloce | Immagini semplici | txt2img | ~1cr",
        mode_pixplace_pro: "pixPLace Pro | Logo | Testo | img2img | ~5cr",
        size_label: "Dimensione",
        size_square: "1:1",
        size_portrait: "9:16",
        size_landscape: "16:9",
        generate_btn: "Genera immagine",
        processing_title: "Creazione del tuo capolavoro",
        processing_subtitle: "Potrebbe richiedere fino a 60 secondi",
        step_analyzing: "Analisi del prompt",
        step_generating: "Generazione immagine",
        step_finalizing: "Finalizzazione risultato",
        elapsed_time: "Tempo trascorso:",
        cancel_btn: "Annulla",
        create_new: "Crea nuovo",
        view_history: "Visualizza cronologia",
        history_title: "Cronologia generazioni",
        empty_history_title: "Nessuna generazione ancora",
        empty_history_subtitle: "Crea la tua prima immagine AI per vederla qui",
        generation_time: "Tempo di generazione",
        error_prompt_required: "Per favore descrivi la tua immagine",
        error_prompt_too_short: "Prompt troppo corto (minimo 5 caratteri)",
        error_webhook_not_configured: "URL webhook non configurato",
        error_generation_failed: "Generazione fallita",
        error_timeout: "Timeout di generazione. Per favore riprova.",
        success_generated: "Immagine generata con successo!",
        copied_to_clipboard: "Copiato negli appunti",
        download_started: "Download avviato",
        limit_title: "Limite di generazione raggiunto",
        limit_message: "Hai raggiunto il limite gratuito di generazioni. Effettua l'upgrade per continuare a creare immagini straordinarie!",
        check_subsciption: "Verifica abbonamento",
        closeLimitModal: "Forse pi√π tardi",
        upgradeBtn: "Aggiorna ora",
        remove_user_image: "Rimuovi",
        reference_image: "Riferimento",
        upload_image: "Carica immagine",
        please_upload_photo_session: "Per la modalit√† Photo Session carica la foto del tuo volto. Oppure scegli un'altra modalit√†",
        upload_failed: "Caricamento immagine fallito. Per favore riprova.",
        please_upload_for_upscale: "Per favore carica un'immagine per l'upscale.",
        please_upload_for_background_removal: "Per favore carica un'immagine per la rimozione dello sfondo."
    },

    ko: {
        loading: "Ï¶êÍ≤ÅÍ≤å Ïù¥Ïö©ÌïòÏÑ∏Ïöî",
        app_title: "pixPLace",
        connecting: "Ïó∞Í≤∞ Ï§ë...",
        connected: "TelegramÏóê Ïó∞Í≤∞Îê®",
        welcome_title: "ÎÜÄÎùºÏö¥ Ïù¥ÎØ∏ÏßÄÎ•º ÎßåÎì§Ïñ¥Î≥¥ÏÑ∏Ïöî",
        welcome_subtitle: "ÎãπÏã†Ïùò ÎπÑÏ†ÑÏùÑ ÏÑ§Î™ÖÌïòÎ©¥ AIÍ∞Ä Í∑∏Í≤ÉÏùÑ Íµ¨ÌòÑÌïòÎäî Î™®ÏäµÏùÑ Î≥º Ïàò ÏûàÏäµÎãàÎã§",
        prompt_label: "ÌîÑÎ°¨ÌîÑÌä∏",
        prompt_placeholder: "ÎãπÏã†Ïùò ÎπÑÏ†ÑÏùÑ ÏÑ§Î™ÖÌïòÎ©¥ AIÍ∞Ä Í∑∏Í≤ÉÏùÑ Íµ¨ÌòÑÌïòÎäî Î™®ÏäµÏùÑ Î≥º Ïàò ÏûàÏäµÎãàÎã§...",
        style_label: "Ïä§ÌÉÄÏùº",
        style_realistic: "Î¶¨ÏñºÎ¶¨Ïä§Ìã±",
        style_artistic: "ÏïÑÌã∞Ïä§Ìã±",
        style_cartoon: "Ïπ¥Ìà∞",
        style_fantasy: "ÌåêÌÉÄÏßÄ",
        style_anime: "Ïï†ÎãàÎ©î",
        style_cyberpunk: "ÏÇ¨Ïù¥Î≤ÑÌéëÌÅ¨",
        style_popart: "Ìåù ÏïÑÌä∏",
        style_abstract: "Ï∂îÏÉÅ",
        style_sketch: "Ïä§ÏºÄÏπò",
        style_3d: "3D",
        style_sticker: "Ïä§Ìã∞Ïª§",
        style_vector: "Î≤°ÌÑ∞",
        style_interior: "Ïù∏ÌÖåÎ¶¨Ïñ¥",
        style_architecture: "Í±¥Ï∂ï",
        style_fashion: "Ìå®ÏÖò",
        style_tattoo: "ÌÉÄÌà¨",
        style_print: "ÌîÑÎ¶∞Ìä∏",
        style_logo: "Î°úÍ≥†",
        style_icon: "ÏïÑÏù¥ÏΩò",
        style_banner: "Î∞∞ÎÑà",
        mode_label: "Î™®Îìú",
        mode_background_removal: "Î∞∞Í≤Ω Ï†úÍ±∞ | img2img | ~1cr",
        mode_upscale_image: "Ïù¥ÎØ∏ÏßÄ ÏóÖÏä§ÏºÄÏùº | img2img | ~5cr",
        mode_print_maker: "ÌîÑÎ¶∞Ìä∏ | Ïä§Ìã∞Ïª§ | POD ÎèÑÏö∞ÎØ∏ | txt2img | ~2cr",
        mode_photo_session: "Ìè¨ÌÜ† ÏÑ∏ÏÖò | Kontext Î™®Îç∏ | img2img | ~5cr",
        mode_fast_generation: "Í∞ÄÏû• Îπ†Î¶Ñ | Îã®Ïàú Ïù¥ÎØ∏ÏßÄ | txt2img | ~1cr",
        mode_pixplace_pro: "pixPLace Pro | Î°úÍ≥† | ÌÖçÏä§Ìä∏ | img2img | ~5cr",
        size_label: "ÌÅ¨Í∏∞",
        size_square: "1:1",
        size_portrait: "9:16",
        size_landscape: "16:9",
        generate_btn: "Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ±",
        processing_title: "ÎãπÏã†Ïùò Í±∏ÏûëÏùÑ ÏÉùÏÑ± Ï§ë",
        processing_subtitle: "ÏµúÎåÄ 60Ï¥àÍ∞Ä ÏÜåÏöîÎê† Ïàò ÏûàÏäµÎãàÎã§",
        step_analyzing: "ÌîÑÎ°¨ÌîÑÌä∏ Î∂ÑÏÑù Ï§ë",
        step_generating: "Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ± Ï§ë",
        step_finalizing: "Í≤∞Í≥º ÎßàÎ¨¥Î¶¨ Ï§ë",
        elapsed_time: "Í≤ΩÍ≥º ÏãúÍ∞Ñ:",
        cancel_btn: "Ï∑®ÏÜå",
        create_new: "ÏÉàÎ°ú ÎßåÎì§Í∏∞",
        view_history: "Í∏∞Î°ù Î≥¥Í∏∞",
        history_title: "ÏÉùÏÑ± Í∏∞Î°ù",
        empty_history_title: "ÏïÑÏßÅ ÏÉùÏÑ±Îêú Ìï≠Î™©Ïù¥ ÏóÜÏäµÎãàÎã§",
        empty_history_subtitle: "Ïó¨Í∏∞Ïóê ÌëúÏãúÌïòÎ†§Î©¥ Ï≤´ Î≤àÏß∏ AI Ïù¥ÎØ∏ÏßÄÎ•º ÏÉùÏÑ±ÌïòÏÑ∏Ïöî",
        generation_time: "ÏÉùÏÑ± ÏãúÍ∞Ñ",
        error_prompt_required: "Ïù¥ÎØ∏ÏßÄÎ•º ÏÑ§Î™ÖÌï¥ Ï£ºÏÑ∏Ïöî",
        error_prompt_too_short: "ÌîÑÎ°¨ÌîÑÌä∏Í∞Ä ÎÑàÎ¨¥ ÏßßÏäµÎãàÎã§ (ÏµúÏÜå 5Ïûê)",
        error_webhook_not_configured: "Webhook URLÏù¥ ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§",
        error_generation_failed: "ÏÉùÏÑ± Ïã§Ìå®",
        error_timeout: "ÏÉùÏÑ± ÏãúÍ∞ÑÏù¥ Ï¥àÍ≥ºÎêòÏóàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌïòÏÑ∏Ïöî.",
        success_generated: "Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ± ÏôÑÎ£å!",
        copied_to_clipboard: "ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨Îê®",
        download_started: "Îã§Ïö¥Î°úÎìú ÏãúÏûëÎê®",
        limit_title: "ÏÉùÏÑ± ÌïúÎèÑ ÎèÑÎã¨",
        limit_message: "Î¨¥Î£å ÏÉùÏÑ± ÌïúÎèÑÏóê ÎèÑÎã¨ÌñàÏäµÎãàÎã§. ÏóÖÍ∑∏Î†àÏù¥ÎìúÌïòÏó¨ Í≥ÑÏÜç ÎÜÄÎùºÏö¥ Ïù¥ÎØ∏ÏßÄÎ•º ÎßåÎì§Ïñ¥Î≥¥ÏÑ∏Ïöî!",
        check_subsciption: "Íµ¨ÎèÖ ÌôïÏù∏",
        closeLimitModal: "ÎÇòÏ§ëÏóê",
        upgradeBtn: "ÏßÄÍ∏à ÏóÖÍ∑∏Î†àÏù¥Îìú",
        remove_user_image: "Ï†úÍ±∞",
        reference_image: "Ï∞∏Í≥† Ïù¥ÎØ∏ÏßÄ",
        upload_image: "Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú",
        please_upload_photo_session: "Ìè¨ÌÜ† ÏÑ∏ÏÖò Î™®ÎìúÏóêÎäî ÏñºÍµ¥ ÏÇ¨ÏßÑÏùÑ ÏóÖÎ°úÎìúÌïòÏÑ∏Ïöî. ÎòêÎäî Îã§Î•∏ Î™®ÎìúÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî",
        upload_failed: "Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú Ïã§Ìå®. Îã§Ïãú ÏãúÎèÑÌïòÏÑ∏Ïöî.",
        please_upload_for_upscale: "ÏóÖÏä§ÏºÄÏùºÌï† Ïù¥ÎØ∏ÏßÄÎ•º ÏóÖÎ°úÎìúÌïòÏÑ∏Ïöî.",
        please_upload_for_background_removal: "Î∞∞Í≤Ω Ï†úÍ±∞Ìï† Ïù¥ÎØ∏ÏßÄÎ•º ÏóÖÎ°úÎìúÌïòÏÑ∏Ïöî."
    },

    tr: {
        loading: "L√ºtfen, iyi eƒülenceler",
        app_title: "pixPLace",
        connecting: "Baƒülanƒ±yor...",
        connected: "Telegram'e baƒülƒ±",
        welcome_title: "Muhte≈üem G√∂rseller Olu≈üturun",
        welcome_subtitle: "Vizyonunuzu anlatƒ±n, AI'nin onu hayata ge√ßirmesini izleyin",
        prompt_label: "Prompt",
        prompt_placeholder: "Vizyonunuzu anlatƒ±n, AI'nin onu hayata ge√ßirmesini izleyin...",
        style_label: "Stil",
        style_realistic: "Ger√ßek√ßi",
        style_artistic: "Sanatsal",
        style_cartoon: "√áizgi",
        style_fantasy: "Fantastik",
        style_anime: "Anime",
        style_cyberpunk: "Siberpunk",
        style_popart: "Pop Art",
        style_abstract: "Soyut",
        style_sketch: "Eskiz",
        style_3d: "3D",
        style_sticker: "Sticker",
        style_vector: "Vekt√∂r",
        style_interior: "ƒ∞√ß Mekan",
        style_architecture: "Mimari",
        style_fashion: "Moda",
        style_tattoo: "D√∂vme",
        style_print: "Baskƒ±",
        style_logo: "Logo",
        style_icon: "Simge",
        style_banner: "Afi≈ü",
        mode_label: "Mod",
        mode_background_removal: "Arka Plan Kaldƒ±rma | img2img | ~1cr",
        mode_upscale_image: "G√∂r√ºnt√º Y√ºkseltme | img2img | ~5cr",
        mode_print_maker: "Baskƒ± | Sticker | POD Yardƒ±mcƒ± | txt2img | ~2cr",
        mode_photo_session: "Fotoƒüraf Oturumu | Kontext Modeli | img2img | ~5cr",
        mode_fast_generation: "En Hƒ±zlƒ± | Basit G√∂rseller | txt2img | ~1cr",
        mode_pixplace_pro: "pixPLace Pro | Logo | Metin | img2img | ~5cr",
        size_label: "Boyut",
        size_square: "1:1",
        size_portrait: "9:16",
        size_landscape: "16:9",
        generate_btn: "G√∂rsel Olu≈ütur",
        processing_title: "Ba≈üyapƒ±tƒ±nƒ±zƒ± olu≈üturuyoruz",
        processing_subtitle: "Bu i≈ülem 60 saniyeye kadar s√ºrebilir",
        step_analyzing: "Prompt analiz ediliyor",
        step_generating: "G√∂rsel olu≈üturuluyor",
        step_finalizing: "Sonu√ß tamamlanƒ±yor",
        elapsed_time: "Ge√ßen s√ºre:",
        cancel_btn: "ƒ∞ptal",
        create_new: "Yeni olu≈ütur",
        view_history: "Ge√ßmi≈üi g√∂r√ºnt√ºle",
        history_title: "Olu≈üturma Ge√ßmi≈üi",
        empty_history_title: "Hen√ºz olu≈üturma yok",
        empty_history_subtitle: "Burada g√∂rmek i√ßin ilk AI g√∂rselinizi olu≈üturun",
        generation_time: "Olu≈üturma s√ºresi",
        error_prompt_required: "L√ºtfen g√∂rselinizi tanƒ±mlayƒ±n",
        error_prompt_too_short: "Prompt √ßok kƒ±sa (minimum 5 karakter)",
        error_webhook_not_configured: "Webhook URL yapƒ±landƒ±rƒ±lmamƒ±≈ü",
        error_generation_failed: "Olu≈üturma ba≈üarƒ±sƒ±z",
        error_timeout: "Olu≈üturma zaman a≈üƒ±mƒ±. L√ºtfen tekrar deneyin.",
        success_generated: "G√∂rsel ba≈üarƒ±yla olu≈üturuldu!",
        copied_to_clipboard: "Panoya kopyalandƒ±",
        download_started: "ƒ∞ndirme ba≈üladƒ±",
        limit_title: "Olu≈üturma Limiti A≈üƒ±ldƒ±",
        limit_message: "√úcretsiz olu≈üturma limitinize ula≈ütƒ±nƒ±z. Devam etmek i√ßin y√ºkseltin!",
        check_subsciption: "Aboneliƒüi kontrol et",
        closeLimitModal: "Belki Sonra",
        upgradeBtn: "≈ûimdi y√ºkselt",
        remove_user_image: "Kaldƒ±r",
        reference_image: "Referans",
        upload_image: "G√∂rsel Y√ºkle",
        please_upload_photo_session: "Fotoƒüraf Oturumu modu i√ßin l√ºtfen y√ºz fotoƒürafƒ±nƒ±zƒ± y√ºkleyin. Veya ba≈üka bir mod se√ßin",
        upload_failed: "G√∂rsel y√ºkleme ba≈üarƒ±sƒ±z. L√ºtfen tekrar deneyin.",
        please_upload_for_upscale: "L√ºtfen y√ºkseltme i√ßin bir g√∂rsel y√ºkleyin.",
        please_upload_for_background_removal: "L√ºtfen arka plan kaldƒ±rma i√ßin bir g√∂rsel y√ºkleyin."
    },

    pl: {
        loading: "Proszƒô, baw siƒô dobrze",
        app_title: "pixPLace",
        connecting: "≈ÅƒÖczenie...",
        connected: "Po≈ÇƒÖczono z Telegram",
        welcome_title: "Tw√≥rz niesamowite obrazy",
        welcome_subtitle: "Opisz swojƒÖ wizjƒô i zobacz, jak AI jƒÖ realizuje",
        prompt_label: "Prompt",
        prompt_placeholder: "Opisz swojƒÖ wizjƒô i zobacz, jak AI jƒÖ realizuje...",
        style_label: "Styl",
        style_realistic: "Realistyczny",
        style_artistic: "Artystyczny",
        style_cartoon: "Kresk√≥wka",
        style_fantasy: "Fantazja",
        style_anime: "Anime",
        style_cyberpunk: "Cyberpunk",
        style_popart: "Pop Art",
        style_abstract: "Abstrakcja",
        style_sketch: "Szkic",
        style_3d: "3D",
        style_sticker: "Naklejka",
        style_vector: "Wektor",
        style_interior: "Wnƒôtrze",
        style_architecture: "Architektura",
        style_fashion: "Moda",
        style_tattoo: "Tatua≈º",
        style_print: "Druk",
        style_logo: "Logo",
        style_icon: "Ikona",
        style_banner: "Baner",
        mode_label: "Tryb",
        mode_background_removal: "Usuwanie t≈Ça | img2img | ~1cr",
        mode_upscale_image: "Skalowanie obrazu | img2img | ~5cr",
        mode_print_maker: "Druk | Naklejka | POD Pomocnik | txt2img | ~2cr",
        mode_photo_session: "Sesja zdjƒôciowa | Model Kontext | img2img | ~5cr",
        mode_fast_generation: "Najszybszy | Proste obrazy | txt2img | ~1cr",
        mode_pixplace_pro: "pixPLace Pro | Logo | Tekst | img2img | ~5cr",
        size_label: "Rozmiar",
        size_square: "1:1",
        size_portrait: "9:16",
        size_landscape: "16:9",
        generate_btn: "Generuj obraz",
        processing_title: "Tworzymy Twoje arcydzie≈Ço",
        processing_subtitle: "To mo≈ºe potrwaƒá do 60 sekund",
        step_analyzing: "Analizowanie promptu",
        step_generating: "Generowanie obrazu",
        step_finalizing: "Finalizowanie wyniku",
        elapsed_time: "Up≈Çynƒô≈Ço czasu:",
        cancel_btn: "Anuluj",
        create_new: "Utw√≥rz nowe",
        view_history: "Zobacz historiƒô",
        history_title: "Historia generacji",
        empty_history_title: "Brak wygenerowanych obraz√≥w",
        empty_history_subtitle: "Stw√≥rz sw√≥j pierwszy obraz AI, aby zobaczyƒá go tutaj",
        generation_time: "Czas generacji",
        error_prompt_required: "Proszƒô opisaƒá obraz",
        error_prompt_too_short: "Prompt za kr√≥tki (minimum 5 znak√≥w)",
        error_webhook_not_configured: "Adres webhook nie jest skonfigurowany",
        error_generation_failed: "Generowanie nie powiod≈Ço siƒô",
        error_timeout: "Przekroczono czas generowania. Spr√≥buj ponownie.",
        success_generated: "Obraz zosta≈Ç wygenerowany pomy≈õlnie!",
        copied_to_clipboard: "Skopiowano do schowka",
        download_started: "Rozpoczƒôto pobieranie",
        limit_title: "OsiƒÖgniƒôto limit generacji",
        limit_message: "OsiƒÖgnƒÖ≈Çe≈õ sw√≥j darmowy limit generacji. Zaktualizuj konto, aby kontynuowaƒá tworzenie wspania≈Çych obraz√≥w!",
        check_subsciption: "Sprawd≈∫ subskrypcjƒô",
        closeLimitModal: "Mo≈ºe p√≥≈∫niej",
        upgradeBtn: "Zaktualizuj teraz",
        remove_user_image: "Usu≈Ñ",
        reference_image: "Referencja",
        upload_image: "Prze≈õlij obraz",
        please_upload_photo_session: "Proszƒô przes≈Çaƒá zdjƒôcie twarzy do trybu Photo Session. Lub wybierz inny tryb",
        upload_failed: "Przesy≈Çanie obrazu nie powiod≈Ço siƒô. Spr√≥buj ponownie.",
        please_upload_for_upscale: "Proszƒô przes≈Çaƒá obraz do skalowania.",
        please_upload_for_background_removal: "Proszƒô przes≈Çaƒá obraz do usuniƒôcia t≈Ça."
    }
};

class AppState {
    constructor() {
        this.tg = null;
        this.currentLanguage = CONFIG.DEFAULT_LANGUAGE;
        this.currentTheme = 'dark';
        this.selectedStyle = 'realistic';
        this.isGenerating = false;
        this.userId = null;
        this.userName = null;
        this.generationHistory = [];
        this.currentGeneration = null;
        this.startTime = null;
        this.timerInterval = null;
        // –î–æ–±–∞–≤–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        this.userCredits = null; // —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –∫—Ä–µ–¥–∏—Ç–æ–≤
        this.lastBalanceUpdate = null; // –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
    }

    // Language methods
    setLanguage(lang) {
        if (CONFIG.LANGUAGES.includes(lang)) {
            this.currentLanguage = lang;
            document.body.setAttribute('data-lang', lang);
            this.updateTranslations();
            this.saveSettings();
        }
    }

    toggleLanguage() {
        const currentIndex = CONFIG.LANGUAGES.indexOf(this.currentLanguage);
        const nextIndex = (currentIndex + 1) % CONFIG.LANGUAGES.length;
        this.setLanguage(CONFIG.LANGUAGES[nextIndex]);
    }

    translate(key) {
        return TRANSLATIONS[this.currentLanguage]?.[key] || TRANSLATIONS[CONFIG.DEFAULT_LANGUAGE]?.[key] || key;
    }

    updateTranslations() {
        // –û–±—ã—á–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å data-i18n
        document.querySelectorAll('[data-i18n]').forEach(element => {
            const key = element.getAttribute('data-i18n');
            element.textContent = this.translate(key);
        });

        // –≠–ª–µ–º–µ–Ω—Ç—ã —Å placeholder
        document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
            const key = element.getAttribute('data-i18n-placeholder');
            element.placeholder = this.translate(key);
        });

        // –≠–ª–µ–º–µ–Ω—Ç—ã —Å data-i18n-price –¥–ª—è —Ü–µ–Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        document.querySelectorAll('[data-i18n-price]').forEach(element => {
            const key = element.getAttribute('data-i18n-price');
            element.textContent = this.translate(key);
        });
    }

    // Theme methods
    setTheme(theme) {
        this.currentTheme = theme;
        document.body.setAttribute('data-theme', theme);
        this.saveSettings();
    }

    toggleTheme() {
        const themes = ['light', 'dark', 'auto'];
        const currentIndex = themes.indexOf(this.currentTheme);
        const nextIndex = (currentIndex + 1) % themes.length;
        this.setTheme(themes[nextIndex]);
    }
    // Storage methods
    saveSettings() {
        try {
            localStorage.setItem('appSettings', JSON.stringify({
                language: this.currentLanguage,
                theme: this.currentTheme
            }));
        } catch (error) {
            console.error('Failed to save settings:', error);
        }
    }

    loadSettings() {
        try {
            const settings = JSON.parse(localStorage.getItem('appSettings') || '{}');
            if (settings.language) this.setLanguage(settings.language);
            if (settings.theme) this.setTheme(settings.theme);
        } catch (error) {
            console.error('Failed to load settings:', error);
        }
    }

    saveHistory() {
        try {
            localStorage.setItem('generationHistory', JSON.stringify(this.generationHistory));
        } catch (error) {
            console.error('Failed to save history:', error);
        }
    }

    loadHistory() {
        try {
            const history = localStorage.getItem('generationHistory');
            if (history) {
                this.generationHistory = JSON.parse(history);
            }
        } catch (error) {
            console.error('Failed to load history:', error);
            this.generationHistory = [];
        }
    }
}

// üéØ Global state
const appState = new AppState();

// ‚ö° Ultra-Fast Global Image Loading Manager - Max Performance
class GlobalHistoryLoader {
    constructor() {
        // Singleton pattern - only one Observer per app
        if (GlobalHistoryLoader.instance) {
            return GlobalHistoryLoader.instance;
        }

        this.imageObserver = new IntersectionObserver(
            this.handleIntersection.bind(this),
            {
                rootMargin: '100px', // —É–º–µ–Ω—å—à–µ–Ω –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏ (–±—ã–ª–æ 300px)
                threshold: 0.1, // –ø–æ–≤—ã—à–µ–Ω –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏ (–±—ã–ª–æ 0.01)
                root: null, // viewport
            }
        );

        // –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ registry —Å Map –¥–ª—è O(1) –¥–æ—Å—Ç—É–ø–∞
        this.observedImages = new Map();
        this.loadingQueue = new Set();
        this.maxConcurrent = 6; // –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∑–∫–∏ (—É–≤–µ–ª–∏—á–µ–Ω–æ —Å 3)
        this.pendingQueue = []; // –æ—á–µ—Ä–µ–¥—å –æ–∂–∏–¥–∞—é—â–∏—Ö –∑–∞–≥—Ä—É–∑–∫–∏
        this.logout = false;

        GlobalHistoryLoader.instance = this;
        console.log('üöÄ Ultra-Fast Global History Loader initialized with max performance');
    }

    handleIntersection(entries, observer) {
        if (this.logout) return;

        // –£–±–∏—Ä–∞–µ–º —Å–ø–∞–º - –ª–æ–≥–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –º–Ω–æ–≥–æ –∑–∞–ø–∏—Å–µ–π (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–µ)
        if (entries.length > 10) {
            console.warn('‚ö° IntersectionObserver triggered:', entries.length, 'entries - performance warning');
        }

        // –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º–∏ –ø–æ—Ä–æ–≥–∞–º–∏
        const highPriorityEntries = [];
        const normalPriorityEntries = [];
        const lowPriorityEntries = [];
        const invisibleEntries = [];

        for (const entry of entries) {
            // –£–±–∏—Ä–∞–µ–º —Å–ø–∞–º - –ª–æ–≥–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –≤ 2% —Å–ª—É—á–∞–µ–≤ –∏ —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
            if (Math.random() < 0.02) {
                console.log('üìä Entry intersection:', entry.intersectionRatio.toFixed(2));
            }

            if (entry.isIntersecting) {
                // –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —Ü–µ–Ω—Ç—Ä–µ —ç–∫—Ä–∞–Ω–∞ (40%+ –≤–∏–¥–∏–º–æ—Å—Ç–∏, —Å–Ω–∏–∂–µ–Ω –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏)
                if (entry.intersectionRatio >= 0.4) {
                    highPriorityEntries.push(entry);
                }
                // –ù–æ—Ä–º–∞–ª—å–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç - –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å (15%+ –≤–∏–¥–∏–º–æ—Å—Ç–∏, —Å–Ω–∏–∂–µ–Ω –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏)
                else if (entry.intersectionRatio >= 0.15) {
                    normalPriorityEntries.push(entry);
                }
                // –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç - —Å–ª–∞–±–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å (–¥–ª—è –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏)
                else if (entry.intersectionRatio > 0.1) {
                    lowPriorityEntries.push(entry);
                }
            } else {
                invisibleEntries.push(entry);
            }
        }

        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å –≤—ã—Å–æ–∫–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –≤–Ω–∞—á–∞–ª–µ
        if (highPriorityEntries.length > 0 || normalPriorityEntries.length > 0) {
            console.log('üéØ Processing high/normal priority images:', highPriorityEntries.length + normalPriorityEntries.length);
            this.processVisibleImages([...highPriorityEntries, ...normalPriorityEntries]);
        }

        // –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
        if (lowPriorityEntries.length > 0) {
            setTimeout(() => {
                console.log('üéØ Processing low priority images:', lowPriorityEntries.length);
                this.processVisibleImages(lowPriorityEntries);
            }, 200);
        }

        // –û—á–∏—â–∞–µ–º –Ω–µ–≤–∏–¥–∏–º—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
        if (invisibleEntries.length > 0) {
            setTimeout(() => {
                this.cleanupInvisibleImages(invisibleEntries);
            }, 1000); // –æ—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
        }
    }

    processVisibleImages(entries) {
        console.log(`üëÅÔ∏è Processing ${entries.length} visible images`);

        for (const entry of entries) {
            const img = entry.target;

            // –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Map
            if (!this.observedImages.has(img)) continue;

            // –£–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
            if (img.src && !img.dataset.src) {
                this.safeUnobserve(img);
                continue;
            }

            // –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å src –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
            if (img.dataset.src && !this.loadingQueue.has(img)) {
                this.startLoading(img);
            }
        }
    }

    startLoading(img) {
        const container = img.closest('.history-mini');

        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–≤—Ä–µ–∂–¥–µ–Ω –∏–ª–∏ –µ—â–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
        if (!container || container.classList.contains('history-loading')) {
            return;
        }

        // –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫ - –¥–æ–±–∞–≤–ª—è–µ–º –≤ –æ—á–µ—Ä–µ–¥—å
        if (this.loadingQueue.size >= this.maxConcurrent) {
            this.pendingQueue.push(img);
            return;
        }

        this.loadingQueue.add(img);

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ src —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
        const loadPromise = new Promise((resolve, reject) => {
            img.onload = () => {
                img.classList.add('loaded');
                delete img.dataset.src; // –æ—á–∏—â–∞–µ–º data-src
                console.log('‚úÖ Image loaded successfully');
                resolve();
            };

            img.onerror = () => {
                console.warn('‚ùå Image load failed');
                img.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PC9zdmc+';
                resolve();
            };

            // –ó–∞–ø—É—Å–∫ –∑–∞–≥—Ä—É–∑–∫–∏
            img.src = img.dataset.src;
        });

        loadPromise.finally(() => {
            this.loadingQueue.delete(img);
            this.safeUnobserve(img);

            // –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –∏–∑ –æ—á–µ—Ä–µ–¥–∏, –µ—Å–ª–∏ –µ—Å—Ç—å –º–µ—Å—Ç–æ
            if (this.pendingQueue.length > 0 && this.loadingQueue.size < this.maxConcurrent) {
                const nextImg = this.pendingQueue.shift();
                this.startLoading(nextImg);
            }
        });
    }

    cleanupInvisibleImages(entries) {
        for (const entry of entries) {
            const img = entry.target;

            // –û—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞–±–ª—é–¥–∞–µ–º—ã–º–∏ –µ—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å
            if (img.dataset.src && !img.src) {
                continue;
            }

            // –û—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞–±–ª—é–¥–∞–µ–º—ã–º–∏ –µ—Å–ª–∏ –æ–Ω–∏ –≤ –æ—á–µ—Ä–µ–¥–∏ –∑–∞–≥—Ä—É–∑–∫–∏
            if (this.loadingQueue.has(img)) {
                continue;
            }

            // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è
            this.safeUnobserve(img);
        }
    }

    observe(img) {
        if (!img || img.nodeType !== 1) return; // –ø—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —ç–ª–µ–º–µ–Ω—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

        // –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Map
        if (this.observedImages.has(img)) return;

        this.imageObserver.observe(img);
        this.observedImages.set(img, true);

        console.log(`üëÅÔ∏è Started observing image: ${img.src || img.dataset.src}`);
    }

    safeUnobserve(img) {
        if (!img || !this.observedImages.has(img)) return;

        try {
            this.imageObserver.unobserve(img);
            this.observedImages.delete(img);
        } catch (error) {
            console.warn('Failed to unobserve image:', error);
        }
    }

    // üîß –î–û–ë–ê–í–õ–ï–ù–ò–ï: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–∞—Å—Å–æ–≤–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π
    massCleanup() {
        const historyList = document.getElementById('historyList');
        if (!historyList) return;

        const currentImages = historyList.querySelectorAll('.history-mini img');
        const validImageSet = new WeakSet(Array.from(currentImages));

        let cleanupCount = 0;
        let maxObserversExceeded = 0;

        // üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª–µ–π –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        const MAX_ACTIVE_OBSERVERS = 40; // —É–≤–µ–ª–∏—á–µ–Ω–æ –¥–æ 40 –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü

        // –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º –Ω–∞–±–ª—é–¥–∞–µ–º—ã–º —ç–ª–µ–º–µ–Ω—Ç–∞–º
        for (const [img] of this.observedImages) {
            // –£–¥–∞–ª—è–µ–º –µ—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –±–æ–ª—å—à–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–µ –≤ –∏—Å—Ç–æ—Ä–∏–∏
            if (!img || !img.isConnected || !validImageSet.has(img)) {
                this.safeUnobserve(img);
                cleanupCount++;
            } else if (this.observedImages.size > MAX_ACTIVE_OBSERVERS && !img.dataset.src) {
                // üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –£–º–µ–Ω—å—à–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª–µ–π –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (—Ç–æ–ª—å–∫–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ)
                this.safeUnobserve(img);
                maxObserversExceeded++;
            }
        }

        // –û—á–∏—â–∞–µ–º –æ—á–µ—Ä–µ–¥—å –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        for (const img of this.loadingQueue) {
            if (!img || !img.isConnected) {
                this.loadingQueue.delete(img);
                cleanupCount++;
            }
        }

        if (cleanupCount > 0 || maxObserversExceeded > 0) {
            console.log(`üßπ Enhanced Mass cleanup: ${cleanupCount} elements removed, ${maxObserversExceeded} observers trimmed (max: ${MAX_ACTIVE_OBSERVERS})`);
        }
    }

    // –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã
    destroy() {
        this.logout = true;

        // –û—Ç–∫–ª—é—á–∞–µ–º –≤—Å–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è
        this.imageObserver.disconnect();

        // –û—á–∏—â–∞–µ–º –≤—Å–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
        this.observedImages.clear();
        this.loadingQueue.clear();

        GlobalHistoryLoader.instance = null;
        console.log('üí£ Ultra-Fast Global History Loader destroyed completely');
    }

    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç—ã
    getStats() {
        return {
            observedImages: this.observedImages.size,
            loadingQueue: this.loadingQueue.size,
            total: this.observedImages.size + this.loadingQueue.size
        };
    }
}

// Global instance
const globalHistoryLoader = new GlobalHistoryLoader();

// ‚ö° Smart History Management with Virtualization
class HistoryManager {
    static PAGE_SIZE = 20; // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
    static CACHE_SIZE = 100; // —Ä–∞–∑–º–µ—Ä –∫—ç—à–∞ DOM —ç–ª–µ–º–µ–Ω—Ç–æ–≤

    // –ö—ç—à DOM —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
    static elementCache = new Map();
    static currentPage = 0;
    static maxLoadedPage = 0;
    static isLoadingPage = false;

    static getVisibleItems(limit = 15) {
        // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —ç–ª–µ–º–µ–Ω—Ç—ã —Å –≤–∞–ª–∏–¥–Ω—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ (–∏—Å–∫–ª—é—á–∞–µ–º undefined/null)
        const validItems = appState.generationHistory.filter(item =>
            item.result &&
            typeof item.result === 'string' &&
            item.result.trim() !== '' &&
            item.result !== 'undefined'
        );

        return validItems.slice(0, limit);
    }

    static getValidItemsOnly() {
        return appState.generationHistory.filter(item =>
            item.result &&
            typeof item.result === 'string' &&
            item.result.trim() !== '' &&
            item.result !== 'undefined'
        );
    }

    static getItemsForPage(page) {
        const validItems = this.getValidItemsOnly();
        const start = page * this.PAGE_SIZE;
        const end = start + this.PAGE_SIZE;
        return validItems.slice(start, end);
    }

    static getTotalPages() {
        const validCount = this.getValidItemsOnly().length;
        return Math.ceil(validCount / this.PAGE_SIZE);
    }

    static hasMorePages(page) {
        return page < this.getTotalPages() - 1;
    }

    static getTotalCount() {
        return appState.generationHistory.length;
    }

    static needsShowMore(limit = 15) {
        const validCount = this.getValidItemsOnly().length;
        return validCount > limit;
    }

    static getValidTotalCount() {
        return this.getValidItemsOnly().length;
    }

    // –ú–µ—Ç–æ–¥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–ø–æ–ª—É—á–µ–Ω–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ DOM —ç–ª–µ–º–µ–Ω—Ç–∞ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç —É—Ç–µ—á–µ–∫
    static createHistoryItemElement(item, forceNoCache = false) {
        // üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è cacheKey –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–º–∞—Ö–æ–≤ –∫–µ—à–∞
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: ID –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–±–µ–∑ –ª–∏—à–Ω–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)
        const cacheKey = `hist_${item.id}_${item.result || 'no-result'}`;

        // –£–±–∏—Ä–∞–µ–º —Å–ø–∞–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è - –ª–æ–≥–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –≤ 1% —Å–ª—É—á–∞–µ–≤ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        if (Math.random() < 0.01) {
            console.log(`üîë Generated cacheKey: ${cacheKey} for item ${item.id}`);
        }

        // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à (–µ—Å–ª–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ)
        if (!forceNoCache && this.elementCache.has(cacheKey)) {
            // –£–±–∏—Ä–∞–µ–º —Å–ø–∞–º –≤ –∫–æ–Ω—Å–æ–ª—å - –ª–æ–≥–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –≤ 1% —Å–ª—É—á–∞–µ–≤
            if (Math.random() < 0.01) {
                console.log(`‚úÖ Cache hit for item ${item.id}`);
            }
            return this.elementCache.get(cacheKey).cloneNode(true);
        }

        // –£–±–∏—Ä–∞–µ–º —Å–ø–∞–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è - —Ç–æ–ª—å–∫–æ –≤ 5% —Å–ª—É—á–∞–µ–≤ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–º–∞—Ö–æ–≤
        if (Math.random() < 0.05) {
            console.log(`üì¶ Cache miss for item ${item.id}, creating new element`);
        }

        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç
        const element = this.createHistoryItemElementFromScratch(item);

        // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∫—ç—à –µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π (success/error) –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ
        if (!forceNoCache && (item.status === 'success' || item.status === 'error')) {
            // üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ 80% –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è (—Ä–∞–Ω—å—à–µ –±—ã–ª–æ > CACHE_SIZE)
            if (this.elementCache.size >= Math.floor(this.CACHE_SIZE * 0.8)) {
                this.autoCleanupCache();
            }

            this.elementCache.set(cacheKey, element.cloneNode(true));

            // üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –û—á–∏—â–∞–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è
            if (this.elementCache.size > this.CACHE_SIZE) {
                this.forceCleanupOldElements(5); // –æ—á–∏—â–∞–µ–º 5 —Å–∞–º—ã—Ö —Å—Ç–∞—Ä—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            }

            console.log(`üíæ Cached element for ${cacheKey}, cache size: ${this.elementCache.size}/${this.CACHE_SIZE}`);
        }

        return element;
    }

    // üîß –î–û–ë–ê–í–õ–ï–ù–ò–ï: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–æ LRU –ø—Ä–∏–Ω—Ü–∏–ø—É
    static autoCleanupCache() {
        const currentSize = this.elementCache.size;
        if (currentSize < Math.floor(this.CACHE_SIZE * 0.7)) return; // –Ω–µ –æ—á–∏—â–∞–µ–º –µ—Å–ª–∏ –º–µ–Ω—å—à–µ 70%

        const keysToRemove = Math.floor(currentSize * 0.2); // –æ—á–∏—â–∞–µ–º 20% —Å–∞–º—ã—Ö —Å—Ç–∞—Ä—ã—Ö
        this.forceCleanupOldElements(keysToRemove);

        console.log(`üßπ Auto-cleaned history cache: ${currentSize} ‚Üí ${this.elementCache.size}`);
    }

    // üîß –î–û–ë–ê–í–õ–ï–ù–ò–ï: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∫—ç—à–∞
    static forceCleanupOldElements(count = 1) {
        const keys = Array.from(this.elementCache.keys());
        for (let i = 0; i < Math.min(count, keys.length); i++) {
            this.elementCache.delete(keys[i]);
        }
    }

    static createHistoryItemElementFromScratch(item) {
        const element = document.createElement('div');
        element.className = 'history-mini';
        element.id = `history-${item.id}`;
        element.onclick = () => viewHistoryItem(item.id);

        element.innerHTML = `
            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjMzc0MTUxIj48L3JlY3Q+PC9zdmc+"
                 data-src="${item.result || ''}"
                 alt="Generated"
                 class="lazy-loading"
                 loading="lazy"
                 decoding="async"
                 ${item.result ? '' : 'style="opacity: 0.7;"'}
                 />
            <p class="history-caption">${new Date(item.timestamp).toLocaleDateString()} | ${appState.translate('style_' + item.style)} | ${appState.translate('mode_' + item.mode)}</p>
        `;

        return element;
    }

    // –ú–µ—Ç–æ–¥ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞
    static clearCache() {
        this.elementCache.clear();
        this.currentPage = 0;
        this.maxLoadedPage = 0;
        this.isLoadingPage = false;
        console.log('üßπ History cache cleared');
    }
}



// üéØ Utility Functions
function showStatus(type, message) {
    const statusBar = document.getElementById('statusBar');
    const statusText = document.querySelector('.status-text');

    if (statusBar && statusText) {
        statusText.textContent = message;
        statusBar.className = `status-bar ${type} show`;

        setTimeout(() => {
            statusBar.classList.remove('show');
        }, 3000);
    }
}

function showToast(type, message) {
    const container = document.getElementById('toastContainer');
    if (!container) return;

    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.textContent = message;

    container.appendChild(toast);

    // Trigger animation
    setTimeout(() => toast.classList.add('show'), 100);

    // Remove after delay
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => container.removeChild(toast), 300);
    }, 3000);
}

function triggerHaptic(type) {
    if (appState.tg?.HapticFeedback) {
        switch (type) {
            case 'light':
                appState.tg.HapticFeedback.impactOccurred('light');
                break;
            case 'medium':
                appState.tg.HapticFeedback.impactOccurred('medium');
                break;
            case 'heavy':
                appState.tg.HapticFeedback.impactOccurred('heavy');
                break;
            case 'success':
                appState.tg.HapticFeedback.notificationOccurred('success');
                break;
            case 'error':
                appState.tg.HapticFeedback.notificationOccurred('error');
                break;
        }
    }
}


// üìä Processing Animation
function updateProcessingSteps(activeStep) {
    document.querySelectorAll('.step').forEach((step, index) => {
        if (index + 1 <= activeStep) {
            step.classList.add('active');
        } else {
            step.classList.remove('active');
        }
    });

    // Update progress circle
    const progressCircle = document.querySelector('.progress-circle');
    if (progressCircle) {
        const progress = (activeStep / 3) * 283; // 283 is circumference
        progressCircle.style.strokeDashoffset = 283 - progress;
    }
}
function updateProgressBar(elapsed) {
    const progressBar = document.querySelector('.progress-bar');
    const progressFill = document.querySelector('.progress-fill');

    if (progressBar && progressFill) {
        // –ü—Ä–∏–º–µ—Ä–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Ä–µ–º–µ–Ω–∏ (0-100%)
        const maxTime = 60; // –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –æ–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
        const progress = Math.min((elapsed / maxTime) * 100, 100);
        progressFill.style.width = progress + '%';
    }

    // –û–±–Ω–æ–≤–∏—Ç—å –∫—Ä—É–≥–æ–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å, –µ—Å–ª–∏ –µ—Å—Ç—å
    const progressCircle = document.querySelector('.progress-circle');
    if (progressCircle) {
        const circumference = 283; // –æ–∫—Ä—É–∂–Ω–æ—Å—Ç—å –∫—Ä—É–≥–∞
        const progress = Math.min((elapsed / 60) * 100, 100);
        const offset = circumference - (progress / 100) * circumference;
        progressCircle.style.strokeDashoffset = offset;
    }
}
function startTimer() {
    const elapsedTimeElement = document.getElementById('elapsedTime');
    let step = 1;

    appState.timerInterval = setInterval(() => {
        const elapsed = Math.floor((Date.now() - appState.startTime) / 1000);
        if (elapsedTimeElement) {
            elapsedTimeElement.textContent = elapsed + 's';
        }
        updateProgressBar(elapsed);
        // Update steps based on time

    }, 1000);
}

function stopTimer() {
    if (appState.timerInterval) {
        clearInterval(appState.timerInterval);
        appState.timerInterval = null;
    }
}

// üìã History Management

function showBackButton(show) {
    const body = document.body;
    if (show) {
        body.classList.add('show-back');
    } else {
        body.classList.remove('show-back');
    }
}

function toggleHistoryList() {
    const list = document.getElementById('historyList');
    const btn = document.getElementById('historyToggleBtn');
    if (list.classList.contains('hidden')) {
        list.classList.remove('hidden');
        btn.classList.add('active');
        updateHistoryDisplay();

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –±—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É (–Ω–∏–∂–Ω–µ–º—É) –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –∏—Å—Ç–æ—Ä–∏–∏
        setTimeout(async () => {
            await scrollToBottomImage();
        }, 150);
    } else {
        list.classList.add('hidden');
        btn.classList.remove('active');
    }
}

function updateHistoryDisplay(page = 0) {
    const historyList = document.getElementById('historyList');
    if (!historyList) return;

    const validItems = HistoryManager.getValidItemsOnly();
    if (validItems.length === 0) {
        historyList.innerHTML = `
    <div class="empty-history">
    <div class="empty-icon">üìã</div>
    <h3 data-i18n="empty_history_title">${appState.translate('empty_history_title')}</h3>
    <p data-i18n="empty_history_subtitle">${appState.translate('empty_history_subtitle')}</p>
    </div>
    `;
        return;
    }

    // –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ - –æ—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫
    if (page === 0) {
        historyList.innerHTML = '';
        HistoryManager.clearCache();
        console.log('üìã Cleared history list for fresh display');
    }

    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ª–∏–º–∏—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    const itemsPerPage = page === 0 ? 8 : 15; // –ø–µ—Ä–≤—ã–π —Ä–∞–∑ 8 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –ø–æ—Ç–æ–º 15

    // –ó–∞–≥—Ä—É–∂–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    if (HistoryManager.isLoadingPage) {
        console.log('‚ö° Page already loading, skipping...');
        return;
    }

    HistoryManager.isLoadingPage = true;
    const pageItems = HistoryManager.getItemsForPage(page);

    if (pageItems.length > 0) {
        console.log(`üìÑ Loading page ${page} with ${pageItems.length} items`);

        // –î–æ–±–∞–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        pageItems.forEach(item => {
            const element = HistoryManager.createHistoryItemElement(item);
            if (element) {
                historyList.appendChild(element);
                // –ü–æ–¥–∫–ª—é—á–∞–µ–º –∫ Observer –¥–ª—è –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
                const img = element.querySelector('img[data-src]');
                if (img) globalHistoryLoader.observe(img);
            }
        });

        HistoryManager.maxLoadedPage = page;
        HistoryManager.currentPage = page;

        // –£–ø—Ä–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        const existingBtn = document.getElementById('loadMoreHistoryBtn');

        if (HistoryManager.hasMorePages(page)) {
            if (existingBtn) {
                // –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –ø–µ—Ä–µ–Ω–æ—Å–∏–º –µ—ë –≤ –∫–æ–Ω–µ—Ü —Å–ø–∏—Å–∫–∞
                historyList.appendChild(existingBtn);
            } else {
                // –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—É—é –∫–Ω–æ–ø–∫—É
                const loadMoreBtn = document.createElement('button');
                loadMoreBtn.className = 'load-more-btn';
                loadMoreBtn.id = 'loadMoreHistoryBtn';
                // –î–æ–±–∞–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É —Å—Ç—Ä–µ–ª–∫–∏ –≤–Ω–∏–∑
                loadMoreBtn.innerHTML = `
                    <span>–ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â—ë...</span>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="btn-icon">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                    <span class="btn-ripple"></span>
                `;

                // –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫: —Ç–æ–ª—å–∫–æ –∑–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏, –±–µ–∑ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
                loadMoreBtn.onclick = (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    loadNextHistoryPage();
                };

                historyList.appendChild(loadMoreBtn);
            }
        } else {
            // –£–¥–∞–ª—è–µ–º –∫–Ω–æ–ø–∫—É –µ—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–ª–∏ –∫–æ–Ω—Ü–∞ –∏—Å—Ç–æ—Ä–∏–∏
            if (existingBtn) {
                existingBtn.remove();
            }
        }
    }

    HistoryManager.isLoadingPage = false;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏—Å—Ç–æ—Ä–∏–∏
function loadNextHistoryPage() {
    const nextPage = HistoryManager.currentPage + 1;
    if (!HistoryManager.hasMorePages(HistoryManager.currentPage)) {
        console.log('üìÑ No more pages to load');
        return;
    }

    console.log(`üìÑ Loading next history page: ${nextPage}`);
    updateHistoryDisplay(nextPage);

    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏
    setTimeout(() => {
        const btn = document.getElementById('loadMoreHistoryBtn');
        if (btn) {
            if (!HistoryManager.hasMorePages(nextPage)) {
                btn.textContent = '–í—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ! üéâ';
                btn.disabled = true;
                btn.style.opacity = '0.5';
            } else {
                btn.textContent = '–ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â—ë...';
                btn.disabled = false;
            }
            // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –Ω–æ–≤–æ–π –∫–Ω–æ–ø–∫–µ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
            btn.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    }, 300);
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –≤—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏ –±–µ–∑ –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
function showAllHistory() {
    const historyList = document.getElementById('historyList');
    if (!historyList) return;

    // –û—Ç–∫–ª—é—á–∞–µ–º –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø–æ–∫–∞–∑–∞
    HistoryManager.clearCache();

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã
    historyList.innerHTML = HistoryManager.getValidItemsOnly().map(item => {
        const element = HistoryManager.createHistoryItemElement(item);
        return element.outerHTML;
    }).join('');

    // –ü–æ–¥–∫–ª—é—á–∞–µ–º Observer –∫–æ –≤—Å–µ–º –Ω–æ–≤—ã–º –∫–∞—Ä—Ç–∏–Ω–∫–∞–º
    const newImages = historyList.querySelectorAll('img[data-src]');
    newImages.forEach(img => globalHistoryLoader.observe(img));

    console.log('üìÑ All history loaded without virtualization');
}

function getStatusText(status) {
    switch (status) {
        case 'processing': return '‚è≥';
        case 'success': return '‚úÖ';
        case 'error': return '‚ùå';
        default: return status;
    }
}

function viewHistoryItem(id) {
    const item = appState.generationHistory.find(h => h.id == id);
    if (item && item.result) {
        appState.currentGeneration = item;
        showResult({ image_url: item.result });
    }
}

function clearHistory() {
    if (confirm('Clear all generation history?')) {
        appState.generationHistory = [];
        appState.saveHistory();
        if (!document.getElementById('historyList').classList.contains('hidden')) {
            updateHistoryDisplay();
        }
        triggerHaptic('medium');
    }
}

function showHistory() {
    toggleHistoryList();
}

window.toggleHistoryList = toggleHistoryList;

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ –∏—Å—Ç–æ—Ä–∏–∏
function updateHistoryDisplayFullScreen() {
    const historyContent = document.getElementById('historyContent');
    if (!historyContent) return;

    if (appState.generationHistory.length === 0) {
        historyContent.innerHTML = `
    <div class="empty-history">
    <div class="empty-icon">üìã</div>
    <h3 data-i18n="empty_history_title">${appState.translate('empty_history_title')}</h3>
    <p data-i18n="empty_history_subtitle">${appState.translate('empty_history_subtitle')}</p>
    </div>
    `;
        return;
    }

    historyContent.innerHTML = appState.generationHistory.map(item => `
    <div class="history-item" onclick="viewHistoryItem('${item.id}')">
    <div class="history-header">
    <span class="history-date">${new Date(item.timestamp).toLocaleString()}</span>
    <span class="history-status ${item.status}">${getStatusText(item.status)}</span>
    </div>
    <div class="history-prompt">${item.prompt}</div>
    <div class="history-details">
    <span class="info-pair">
    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFF"><path d="M480-80q-82 0-155-31.5t-127.5-86Q143-252 111.5-325T80-480q0-83 32.5-156t88-127Q256-817 330-848.5T488-880q80 0 151 27.5t124.5 76q53.5 48.5 85 115T880-518q0 115-70 176.5T640-280h-74q-9 0-12.5 5t-3.5 11q0 12 15 34.5t15 51.5q0 50-27.5 74T480-80Zm0-400Zm-220 40q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm120-160q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm200 0q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm120 160q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17ZM480-160q9 0 14.5-5t5.5-13q0-14-15-33t-15-57q0-42 29-67t71-25h70q66 0 113-38.5T800-518q0-121-92.5-201.5T488-800q-136 0-232 93t-96 227q0 133 93.5 226.5T480-160Z"/></svg>
    ${appState.translate('style_' + item.style)}
    </span>
    <span class="info-pair">
    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#FFFF"><path d="M240-40v-329L110-580l185-300h370l185 300-130 211v329l-240-80-240 80Zm80-111 160-53 160 53v-129H320v129Zm20-649L204-580l136 220h280l136-220-136-220H340Zm98 383L296-558l57-57 85 85 169-170 57 56-226 227ZM320-280h320-320Z"/></svg>
    ${appState.translate('mode_' + item.mode)}
    </span>
    ${item.duration ? `<span> ‚è± ${Math.round(item.duration / 1000)}s</span>` : ''}
    </div>
    ${item.result ? `<img src="${item.result}" alt="Generated" class="history-image" loading="lazy" />` : ''}
    ${item.error ? `<p style="color: var(--error-500); font-size: var(--font-size-sm); margin-top: var(--space-2);">‚ùå ${item.error}</p>` : ''}
    </div>
    `).join('');
    showBackButton(true); // –ø–æ–∫–∞–∑–∞—Ç—å

}

function getStatusText(status) {
    switch (status) {
        case 'processing': return '‚è≥';
        case 'success': return '‚úÖ';
        case 'error': return '‚ùå';
        default: return status;
    }
}

function viewHistoryItem(id) {
    const item = appState.generationHistory.find(h => h.id == id);
    if (item && item.result) {
        appState.currentGeneration = item;
        showResult({ image_url: item.result });
    }
}

function clearHistory() {
    if (confirm('Clear all generation history?')) {
        appState.generationHistory = [];
        appState.saveHistory();
        updateHistoryDisplay();
        triggerHaptic('medium');
    }
}
function showHistory() {
    showScreen('historyScreen');
    updateHistoryDisplay();
}

// –§—É–Ω–∫—Ü–∏—è –ø–ª–∞–≤–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –∫ –∏—Å—Ç–æ—Ä–∏–∏ –∏ –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–ø–∏—Å–∫–∞
async function showHistoryWithScroll() {
    const historyBtn = document.getElementById('historyToggleBtn');
    const historyList = document.getElementById('historyList');

    if (historyBtn) {
        // –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –∫–Ω–æ–ø–∫–µ –∏—Å—Ç–æ—Ä–∏–∏ - —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –µ—ë
        historyBtn.scrollIntoView({
            behavior: 'smooth',
            block: 'center',
            inline: 'nearest'
        });
    }

    // –ü–æ–¥–æ–∂–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
    await new Promise(resolve => setTimeout(resolve, 300));

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏—Å—Ç–æ—Ä–∏–∏ –µ—Å–ª–∏ –æ–Ω –∑–∞–∫—Ä—ã—Ç
    if (historyList && historyList.classList.contains('hidden')) {
        const btn = document.getElementById('historyToggleBtn');
        historyList.classList.remove('hidden');
        btn.classList.add('active');
        updateHistoryDisplay();

        // –ñ–¥–µ–º –ø–æ–∫–∞ DOM –æ–±–Ω–æ–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è
        await new Promise(resolve => setTimeout(resolve, 100));
    }

    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –∫—Ä–∞–π–Ω–µ–º—É (–Ω–æ–≤–æ–º—É) –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –∏—Å—Ç–æ—Ä–∏–∏
    await scrollToLatestImage();
}

// –§—É–Ω–∫—Ü–∏—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –∫ –∫—Ä–∞–π–Ω–µ–º—É (–Ω–æ–≤–æ–º—É) –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é –≤ –∏—Å—Ç–æ—Ä–∏–∏
async function scrollToLatestImage() {
    const historyList = document.getElementById('historyList');
    if (!historyList) return;

    // –£–±–∏—Ä–∞–µ–º –∏–∑–ª–∏—à–Ω—é—é –∑–∞–¥–µ—Ä–∂–∫—É - –æ–Ω–∞ —Ç–æ–ª—å–∫–æ –∑–∞–º–µ–¥–ª—è–µ—Ç
    await new Promise(resolve => setTimeout(resolve, 50));

    // –ò—â–µ–º –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –∏—Å—Ç–æ—Ä–∏–∏ (—ç—Ç–æ –±—É–¥–µ—Ç –∫—Ä–∞–π–Ω–µ–µ/–Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ)
    const firstHistoryItem = historyList.querySelector('.history-mini');
    if (firstHistoryItem) {
        // –£–±–∏—Ä–∞–µ–º —Å–ø–∞–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è - –ª–æ–≥–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –≤ 5% —Å–ª—É—á–∞–µ–≤
        if (Math.random() < 0.05) {
            console.log('üöÄ –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –∫—Ä–∞–π–Ω–µ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é');
        }

        // –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –±–µ–∑ –ø–ª–∞–≤–Ω–æ—Å—Ç–∏ –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –ø–æ–∫–∞–∑–∞
        firstHistoryItem.scrollIntoView({
            behavior: 'instant', // 'instant' –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
            block: 'start', // scroll to top of the element instead of center
            inline: 'nearest'
        });

        // –£–±–∏—Ä–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∏ –ø–æ–¥—Å–≤–µ—Ç–∫—É - –æ–Ω–∏ –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã –∏ –∑–∞–º–µ–¥–ª—è—é—Ç
        if (Math.random() < 0.05) {
            console.log('‚úÖ –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –∫—Ä–∞–π–Ω–µ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
        }
    } else {
        // –£–±–∏—Ä–∞–µ–º —Å–ø–∞–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        if (Math.random() < 0.01) {
            console.warn('‚ö†Ô∏è –ù–µ –Ω–∞–π–¥–µ–Ω–æ –∫—Ä–∞–π–Ω–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏');
        }
    }
}

// –§—É–Ω–∫—Ü–∏—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É (–Ω–∏–∂–Ω–µ–º—É) –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é –≤ –∏—Å—Ç–æ—Ä–∏–∏
async function scrollToBottomImage() {
    const historyList = document.getElementById('historyList');
    if (!historyList) return;

    // –£–±–∏—Ä–∞–µ–º –∑–∞–¥–µ—Ä–∂–∫—É - –æ–Ω–∞ –∑–∞–º–µ–¥–ª—è–µ—Ç
    await new Promise(resolve => setTimeout(resolve, 50));

    // –ò—â–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏—Å—Ç–æ—Ä–∏–∏
    const historyItems = historyList.querySelectorAll('.history-mini');
    if (historyItems.length > 0) {
        // –ë–µ—Ä–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç (—Å–∞–º–æ–µ –Ω–∏–∂–Ω–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ)
        const lastHistoryItem = historyItems[historyItems.length - 1];

        // –£–±–∏—Ä–∞–µ–º —Å–ø–∞–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        if (Math.random() < 0.05) {
            console.log('üöÄ –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é');
        }

        // –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –±–µ–∑ –ø–ª–∞–≤–Ω–æ—Å—Ç–∏ –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –ø–æ–∫–∞–∑–∞
        lastHistoryItem.scrollIntoView({
            behavior: 'instant', // 'instant' –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
            block: 'center',
            inline: 'nearest'
        });

        // –£–±–∏—Ä–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∏ –ø–æ–¥—Å–≤–µ—Ç–∫—É - –æ–Ω–∏ –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã
        if (Math.random() < 0.05) {
            console.log('‚úÖ –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
        }
    } else {
        // –£–±–∏—Ä–∞–µ–º —Å–ø–∞–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        if (Math.random() < 0.01) {
            console.warn('‚ö†Ô∏è –ù–µ –Ω–∞–π–¥–µ–Ω—ã —ç–ª–µ–º–µ–Ω—Ç—ã –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏');
        }
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è placeholder'–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤ –∏—Å—Ç–æ—Ä–∏–∏
function createLoadingHistoryItem(generation) {
    const historyList = document.getElementById('historyList');
    if (!historyList) return;

    // –°–æ–∑–¥–∞—ë–º —ç–ª–µ–º–µ–Ω—Ç –Ω–æ–≤–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∏—Å—Ç–æ—Ä–∏–∏
    const loadingItem = document.createElement('div');
    loadingItem.className = 'history-mini history-loading';
    loadingItem.id = `loading-${generation.id}`;
    // –î–æ–±–∞–≤–ª—è–µ–º onclick —Å—Ä–∞–∑—É
    loadingItem.onclick = () => console.log('Loading item clicked, but still processing...');

    // –°–æ–∑–¥–∞—ë–º –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ (–±–µ–∑ src - —Ç–æ–ª—å–∫–æ placeholder)
    const loadingImage = document.createElement('img');
    loadingImage.className = 'loading-image-placeholder';
    // —É–±–∏—Ä–∞–µ–º src —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –∏–∫–æ–Ω–∫–∏
    loadingImage.alt = 'Generating...';

    // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø—É–ª—å—Å–∞—Ü–∏–∏
    loadingImage.style.animation = 'image-loading 2s infinite';

    // –°–æ–∑–¥–∞—ë–º –ø–æ–¥–ø–∏—Å—å –¥–ª—è —à–∏—Ä–æ–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ - –±—É–¥–µ–º –∑–∞–ø–æ–ª–Ω—è—Ç—å –ø—Ä–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
    const loadingCaption = document.createElement('p');
    loadingCaption.classList.add('history-caption');
    loadingCaption.innerHTML = ` `; // –ü—É—Å—Ç–æ, –∑–∞–ø–æ–ª–Ω–∏–º –ø–æ–∑–¥–Ω–µ–µ

    // –°–æ–±–∏—Ä–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç
    loadingItem.appendChild(loadingImage);
    loadingItem.appendChild(loadingCaption);

    // –í—Å—Ç–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –≤ –Ω–∞—á–∞–ª–æ —Å–ø–∏—Å–∫–∞
    const firstHistoryItem = historyList.querySelector('.history-mini');
    if (firstHistoryItem) {
        historyList.insertBefore(loadingItem, firstHistoryItem);
    } else {
        historyList.appendChild(loadingItem);
    }

    return loadingItem;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–∏–Ω–∏–∞—Ç—é—Ä—ã –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
function updateHistoryItemWithImage(generationId, imageUrl) {
    const loadingItem = document.getElementById(`loading-${generationId}`);
    if (!loadingItem) return;

    // –°–Ω–∏–º–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø—É–ª—å—Å–∞—Ü–∏–∏ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    const loadingImage = loadingItem.querySelector('.loading-image-placeholder');
    if (loadingImage) {
        // –£–±–∏—Ä–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
        loadingImage.style.animation = 'none';

        // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞ –≥–æ—Ç–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        loadingImage.src = imageUrl;
        loadingImage.alt = 'Generated image';

        // –î–æ–±–∞–≤–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç –ø–ª–∞–≤–Ω–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è
        loadingImage.style.opacity = '0';
        requestAnimationFrame(() => {
            loadingImage.style.opacity = '1';
            loadingImage.style.transition = 'opacity 0.3s ease-in-out';
        });
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥–ø–∏—Å—å - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
    const loadingCaption = loadingItem.querySelector('p');
    if (loadingCaption) {
        // –ù–∞–π–¥–µ–º –æ–±—ä–µ–∫—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ ID
        const generation = appState.generationHistory.find(g => g.id == generationId);
        const mode = generation ? generation.mode : 'unknown';
        const style = generation ? generation.style : 'realistic';

        loadingCaption.innerHTML = `
    <span class="complete-status">‚úÖ Complete</span><br>
    <small class="history-date">${new Date().toLocaleDateString()} | ${appState.translate('style_' + style)} | ${appState.translate('mode_' + mode)}</small>
`;

        // –î–æ–±–∞–≤–ª—è–µ–º –º—è–≥–∫—É—é –∞–Ω–∏–º–∞—Ü–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
        loadingCaption.style.opacity = '0';
        requestAnimationFrame(() => {
            loadingCaption.style.opacity = '1';
            loadingCaption.style.transition = 'opacity 0.2s ease-in-out';
        });
    }

    // –£–±–∏—Ä–∞–µ–º loading –∫–ª–∞—Å—Å —á–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è –¥–ª—è smooth —ç—Ñ—Ñ–µ–∫—Ç–∞
    setTimeout(() => {
        loadingItem.classList.remove('history-loading');
    }, 300);

    // –î–æ–±–∞–≤–ª—è–µ–º onclick –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    loadingItem.onclick = () => viewHistoryItem(generationId);

    console.log('üñºÔ∏è Updated history item with generated image:', generationId, imageUrl);
}

// üñºÔ∏è UI Initialization
// üé¨ Screen Management with cleanup
let carouselCleanup = null;

function showLoadingScreen() {
    document.getElementById('loadingScreen').classList.add('active');
}

function hideLoadingScreen() {
    document.getElementById('loadingScreen').classList.remove('active');
}

// Cleanup function for memory leaks
function cleanupMemoryLeaks() {
    // Disconnect Global History Loader
    if (globalHistoryLoader) {
        globalHistoryLoader.destroy();
    }

    // Clear any pending timers
    if (appState.timerInterval) {
        clearInterval(appState.timerInterval);
        appState.timerInterval = null;
    }

    // Remove carousel event listeners
    if (carouselCleanup) {
        carouselCleanup();
        carouselCleanup = null;
    }

    console.log('üßπ Memory leaks cleaned up successfully - including global history loader');
}

// Call cleanup on page unload
window.addEventListener('beforeunload', cleanupMemoryLeaks);

function showApp() {
    document.getElementById('app').classList.add('loaded');
}
function getCurrentScreen() {
    const generationEl = document.getElementById('generationScreen');
    const processingEl = document.getElementById('processingScreen');
    const resultEl = document.getElementById('resultScreen');
    const historyEl = document.getElementById('historyScreen');

    const isVisible = el => {
        if (!el) return false;
        const cs = window.getComputedStyle(el);
        if (el.classList.contains('hidden')) return false;
        return cs.display !== 'none' && cs.visibility !== 'hidden' && cs.opacity !== '0';
    };

    if (isVisible(resultEl)) return 'result';
    if (isVisible(processingEl)) return 'processing';
    if (isVisible(historyEl)) return 'history';
    if (isVisible(generationEl)) return 'generation';
    return 'unknown';
}

/*
function showScreen(screenId) {
    // Hide all screens
    document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
    });

    // Show target screen
    const targetScreen = document.getElementById(screenId);
    if (targetScreen) {
        targetScreen.classList.add('active');
    }
    if (!targetScreen) { console.error('Screen not found:', screenId); return; }

    // Update main button
    //updateMainButton(screenId);
}
*/

function showScreen(screenId) {
    // –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º –Ω—É–∂–Ω—ã–π —ç–∫—Ä–∞–Ω
    const targetScreen = document.getElementById(screenId);
    if (!targetScreen) {
        console.error('Screen not found:', screenId);
        return;
    }

    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
    document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
        screen.classList.add('hidden'); // –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –ø—Ä—è—á–µ–º
    });

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π
    targetScreen.classList.remove('hidden');
    targetScreen.classList.add('active');
}


function showProcessing() {
    showScreen('processingScreen');
    updateProcessingSteps(1);
    console.log('--- –ü—Ä–æ–≤–µ—Ä–∫–∞ processingScreen ---');
    const proc = document.getElementById('processingScreen');
    if (!proc) {
        console.error('‚ùå –ù–µ—Ç –±–ª–æ–∫–∞ #processingScreen –≤ DOM');
    } else {
        console.log('‚úÖ –ù–∞—à—ë–ª processingScreen:', proc);
        console.log('–ö–ª–∞—Å—Å—ã:', proc.className);
        console.log('display:', getComputedStyle(proc).display);
        console.log('opacity:', getComputedStyle(proc).opacity);
        console.log('transform:', getComputedStyle(proc).transform);
        console.log('innerHTML –¥–ª–∏–Ω–∞:', proc.innerHTML.length);
    }

    console.log('after showProcessing ->', getCurrentScreen());
}

function showResult(result) {
    showScreen('resultScreen');

    // Update result display
    const resultImage = document.getElementById('resultImage');
    const resultPrompt = document.getElementById('resultPrompt');
    const resultStyle = document.getElementById('resultStyle');
    const resultMode = document.getElementById('resultMode');
    const resultTime = document.getElementById('resultTime');

    if (resultImage) resultImage.src = result.image_url;
    if (resultPrompt) resultPrompt.textContent = appState.currentGeneration.prompt;
    if (resultStyle) resultStyle.textContent = appState.translate('style_' + appState.currentGeneration.style);
    if (resultMode) resultMode.textContent = appState.translate('mode_' + appState.currentGeneration.mode);

    // –û–±–Ω–æ–≤–ª–µ–Ω–æ: –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–º–µ—Å—Ç–æ –≤—Ä–µ–º–µ–Ω–∏
    if (resultTime) {
        const cost = result.cost || result.generation_cost;
        if (cost && !isNaN(cost)) {
            const formattedCost = parseFloat(cost).toFixed(2);
            const currency = result.cost_currency || 'cr';
            resultTime.textContent = `${formattedCost} ${currency}`;
        } else {
            // Fallback –µ—Å–ª–∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–µ –ø—Ä–∏—à–ª–∞
            const duration = Math.round((appState.currentGeneration.duration || 0) / 1000);
            resultTime.textContent = `${duration}s`;
        }
    }

    console.log('after showResult ->', getCurrentScreen());
}

// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ header
function updateUserBalance(credits) {
    // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –≤ appState
    if (credits !== null && credits !== undefined) {
        appState.userCredits = parseFloat(credits);
        appState.lastBalanceUpdate = Date.now();
        appState.saveSettings(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage

        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ header
        const balanceElement = document.getElementById('userCreditsDisplay');
        if (balanceElement) {
            if (!isNaN(credits) && credits !== null) {
                balanceElement.textContent = parseFloat(credits).toLocaleString('en-US');
            } else {
                balanceElement.textContent = '--';
            }
        }
    }
}

function showSubscriptionNotice(result) {
    console.log('üîó Full result object:', result);
    console.log('üîó Payment URLs from result:', result.payment_urls);

    const modal = document.getElementById('limitModal');
    if (!modal) {
        console.error('‚ùå Modal not found!');
        return;
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    modal.classList.add('show');

    // Helper function for safe redirections with error handling
    const safeRedirect = (url, planName) => {
        modal.classList.remove('show');
        showGeneration();
        setTimeout(() => {
            try {
                console.log(`üîó Redirecting to ${planName} payment URL: ${url}`);
                // Try modern way first
                if (appState.tg && appState.tg.openLink) {
                    appState.tg.openLink(url);
                } else {
                    // Fallback to regular navigation
                    window.open(url, '_blank');
                }
            } catch (error) {
                console.error(`‚ùå Error redirecting to ${planName} payment link:`, error);
                showToast('error', `–û—à–∏–±–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ ${planName}. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.`);
                // Fallback to popup
                window.open(url, '_blank', 'noopener,noreferrer');
            }
        }, 100);
    };

    // –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ç—Ä–µ—Ö –∫–Ω–æ–ø–æ–∫ —Ç–∞—Ä–∏—Ñ–æ–≤
    const upgradeBtn = document.getElementById('upgradeBtn'); // –õ–ò–¢–ï –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
    const upgradeBtnPro = document.getElementById('upgradebtn_pro'); // –ü–†–û –Ω–æ–≤—ã–π
    const upgradeBtnStudio = document.getElementById('upgradebtn_studio'); // –°–¢–£–î–ò–û –Ω–æ–≤—ã–π

    console.log('üîò Upgrade buttons found:', !!upgradeBtn, !!upgradeBtnPro, !!upgradeBtnStudio);

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –õ–ò–¢–ï —Ç–∞—Ä–∏—Ñ–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–Ω–æ–ø–∫—É upgradeBtn)
    if (upgradeBtn) {
        upgradeBtn.onclick = () => {
            console.log('üîò LITE Upgrade button clicked');
            const paymentUrl = result.payment_urls?.lite || 'https://t.me/tribute/app?startapp=syDv';
            safeRedirect(paymentUrl, 'LITE');
        };
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ü–†–û —Ç–∞—Ä–∏—Ñ–∞ (–Ω–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞)
    if (upgradeBtnPro) {
        upgradeBtnPro.onclick = () => {
            console.log('üîò PRO Upgrade button clicked');
            const paymentUrl = result.payment_urls?.pro || 'https://t.me/tribute/app?startapp=syDv';
            safeRedirect(paymentUrl, 'PRO');
        };
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –°–¢–£–î–ò–û —Ç–∞—Ä–∏—Ñ–∞ (–Ω–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞)
    if (upgradeBtnStudio) {
        upgradeBtnStudio.onclick = () => {
            console.log('üîò STUDIO Upgrade button clicked');
            const paymentUrl = result.payment_urls?.studio || 'https://t.me/tribute/app?startapp=syDv';
            safeRedirect(paymentUrl, 'STUDIO');
        };
    }

    // –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–Ω–æ–ø–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è
    const closeBtn = document.getElementById('closeLimitModal');
    if (closeBtn) {
        closeBtn.onclick = () => {
            modal.classList.remove('show');
            showGeneration(); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è
        };
    }
}

/*function showGeneration() {
    document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
    });
    document.getElementById('generationScreen').classList.add('active');
    showBackButton(false);
*/
function showGeneration() {
    const screens = document.querySelectorAll('.screen');
    screens.forEach(s => {
        s.classList.remove('active');
        s.classList.add('hidden');
    });

    const gen = document.getElementById('generationScreen');
    if (!gen) {
        console.warn('generationScreen –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
    }

    gen.classList.remove('hidden');
    gen.classList.add('active');

    showBackButton(false);
}


// üé® UI Initialization
function initializeUI() {
    // Character counter
    const promptInput = document.getElementById('promptInput');
    const charCounter = document.getElementById('charCounter');

    if (promptInput && charCounter) {
        promptInput.addEventListener('input', function () {
            charCounter.textContent = this.value.length;

            // Auto-resize
            this.style.height = 'auto';
            this.style.height = this.scrollHeight + 'px';
        });
    }

    // Form submission
    const form = document.querySelector('.generation-form');
    if (form) {
        form.addEventListener('submit', generateImage);
    }

    // Update translations
    appState.updateTranslations();

    console.log('‚úÖ UI initialized');
}

// ===== –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: —Å–æ—Å—Ç–æ—è–Ω–∏–µ =====
const userImageState = {
    file: null,        // File
    dataUrl: null,     // data:image/...;base64,...
    uploadedUrl: null, // –ø—É–±–ª–∏—á–Ω—ã–π URL –æ—Ç imgbb
};


// ===== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è UI –∑–∞–≥—Ä—É–∑–∫–∏ =====
function initUserImageUpload() {
    const input = document.getElementById('userImage');
    const chooseBtn = document.getElementById('chooseUserImage');
    const removeBtn = document.getElementById('removeUserImage');

    chooseBtn?.addEventListener('click', () => input?.click());
    input?.addEventListener('change', onUserImageChange);
    removeBtn?.addEventListener('click', clearUserImage);
}

function readFileAsDataURL(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
    });
}
// ===== –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ =====
async function onUserImageChange(e) {
    const file = e.target.files?.[0];
    const errorEl = document.getElementById('userImageError');
    const preview = document.getElementById('userImagePreview');
    const img = document.getElementById('userImagePreviewImg');

    const chooseBtn = document.getElementById('chooseUserImage');
    const optionalLabel = document.querySelector('.under-user-image-label');

    if (errorEl) errorEl.textContent = '';
    if (!file) return;

    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    //if (!CONFIG.ALLOWED_TYPES.includes(file.type)) {
    if (!CONFIG.ALLOWED_TYPES.includes(file.type)) {
        if (errorEl) errorEl.textContent = 'formats Allowed to upload: JPG, PNG, WEBP, GIF.';
        e.target.value = '';
        return;
    }
    const maxBytes = CONFIG.MAX_IMAGE_MB * 2048 * 2048;
    if (file.size > maxBytes) {
        if (errorEl) errorEl.textContent = `–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º—É–º ${CONFIG.MAX_IMAGE_MB} MB.`;
        e.target.value = '';
        return;
    }

    try {
        const dataUrl = await readFileAsDataURL(file);
        const compressed = await maybeCompressImage(
            dataUrl,
            CONFIG.PREVIEW_MAX_W,
            CONFIG.PREVIEW_MAX_H,
            CONFIG.PREVIEW_JPEG_QUALITY
        );

        userImageState.file = file;
        userImageState.dataUrl = compressed;
        userImageState.uploadedUrl = null;

        if (img) img.src = compressed;
        if (preview) preview.classList.remove('hidden');
        const wrapper = document.getElementById('userImageWrapper');
        wrapper?.classList.add('has-image');
        wrapper?.classList.remove('need-image');

        // –°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É –∏ "(Optional)"
        if (chooseBtn) chooseBtn.style.display = 'none';
        if (optionalLabel) optionalLabel.style.display = 'none';

    } catch (err) {
        console.error(err);
        if (errorEl) errorEl.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å/–æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.';
        e.target.value = '';
    }
}

function clearUserImage() {
    const input = document.getElementById('userImage');
    const preview = document.getElementById('userImagePreview');
    const img = document.getElementById('userImagePreviewImg');
    const errorEl = document.getElementById('userImageError');

    const chooseBtn = document.getElementById('chooseUserImage');
    const optionalLabel = document.querySelector('.under-user-image-label');

    if (input) input.value = '';
    if (img) img.removeAttribute('src');
    if (preview) preview.classList.add('hidden');
    if (errorEl) errorEl.textContent = '';

    // –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É –∏ "(Optional)" –æ–±—Ä–∞—Ç–Ω–æ
    if (chooseBtn) chooseBtn.style.display = '';
    if (optionalLabel) optionalLabel.style.display = '';

    userImageState.file = null;
    userImageState.dataUrl = null;
    userImageState.uploadedUrl = null;
    const wrapper = document.getElementById('userImageWrapper');
    wrapper?.classList.remove('has-image');
    wrapper?.classList.remove('need-image');
}

function maybeCompressImage(dataUrl, maxW = 1024, maxH = 1024, quality = 0.9) {
    return new Promise(resolve => {
        const img = new Image();
        img.onload = () => {
            let w = img.width, h = img.height;
            const ratio = Math.min(maxW / w, maxH / h, 1);
            w = Math.round(w * ratio);
            h = Math.round(h * ratio);

            const canvas = document.createElement('canvas');
            canvas.width = w;
            canvas.height = h;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, w, h);
            resolve(canvas.toDataURL('image/jpeg', quality));
        };
        img.onerror = () => resolve(dataUrl);
        img.src = dataUrl;
    });
}

// ===== –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ imgbb –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–≥–æ URL =====
// –ú—è–≥–∫–∏–π –∞–ø–ª–æ–∞–¥: –µ—Å–ª–∏ –∫–ª—é—á–∞ –Ω–µ—Ç ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –±–µ–∑ throw
async function uploadToImgbb(dataUrl, apiKey) {
    const key = (apiKey || '').trim();
    if (!key) {
        console.warn('IMGBB API key missing ‚Äî skipping user image upload');
        return null; // –Ω–µ –ª–æ–º–∞–µ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
    }

    const base64 = String(dataUrl).split(',')[1];
    const form = new FormData();
    form.append('image', base64);

    const res = await fetch(`https://api.imgbb.com/1/upload?key=${encodeURIComponent(key)}`, {
        method: 'POST',
        body: form
    });

    let json;
    try {
        json = await res.json();
    } catch (e) {
        console.error('IMGBB: failed to parse JSON', e);
        return null;
    }
    console.debug('imgbb status:', res.status, res.statusText, json);

    if (!res.ok || !json?.success) {
        console.warn('IMGBB upload failed:', json?.error || json);
        return null;
    }
    return json.data.url;
}

// –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ –∏ –µ—â—ë –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ
async function uploadUserImageIfAny() {
    if (!userImageState.dataUrl) return null;
    if (userImageState.uploadedUrl) return userImageState.uploadedUrl;

    const url = await uploadToImgbb(userImageState.dataUrl, CONFIG.IMGBB_API_KEY);
    userImageState.uploadedUrl = url || null;
    return userImageState.uploadedUrl;
}

// üì± Telegram WebApp Integration

async function initTelegramApp() {
    console.log('üîç Initializing Telegram WebApp...');

    // üöÄ –í–ê–†–ò–ê–ù–¢ 3: –£–º–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ Telegram SDK
    const waitForTelegram = async (timeoutMs = 3000) => {
        return new Promise((resolve, reject) => {
            let elapsed = 0;
            const checkInterval = 100; // –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 100–º—Å

            const check = () => {
                if (typeof window.Telegram !== 'undefined') {
                    resolve(window.Telegram);
                    return;
                }

                elapsed += checkInterval;
                if (elapsed >= timeoutMs) {
                    resolve(null); // –≤–æ–∑–≤—Ä–∞—â–∞–µ–º null –µ—Å–ª–∏ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è
                    return;
                }

                setTimeout(check, checkInterval);
            };

            check(); // –ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ —Å—Ä–∞–∑—É
        });
    };

    const telegram = await waitForTelegram();
    const isAvailable = telegram?.WebApp;
    console.log('üì± Telegram SDK loaded:', !!isAvailable);

    console.log('üì± After waiting - Telegram available:', !!window.Telegram?.WebApp);

    if (typeof window.Telegram === 'undefined' || !window.Telegram.WebApp) {
        console.log('‚ùå Telegram WebApp still not available - using fallback');
        appState.userId = 'fallback_' + Date.now();
        appState.userName = 'Fallback User';
        showStatus('info', 'Running in fallback mode');
        return;
    }

    try {
        appState.tg = window.Telegram.WebApp;
        appState.tg.ready();
        appState.tg.expand();
        console.log('üßæ Full initDataUnsafe dump:', JSON.stringify(appState.tg.initDataUnsafe, null, 2));

        // ‚ö†Ô∏è –ü–†–û–í–ï–†–ö–ê: –ï—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å?
        if (!appState.tg.initData || !appState.tg.initDataUnsafe?.user) {
            showStatus('error', '‚ö†Ô∏è WebApp –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–∑ Telegram. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ –±–æ—Ç–∞.');
            return;
        }

        // ‚úÖ –£–õ–£–ß–®–ï–ù–ù–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê:
        console.log('üîç Telegram WebApp data:', {
            available: !!appState.tg,
            platform: appState.tg.platform,
            version: appState.tg.version,
            initDataUnsafe: appState.tg.initDataUnsafe,
            user: appState.tg.initDataUnsafe?.user,
            // –ù–û–í–´–ï –ü–†–û–í–ï–†–ö–ò:
            initData: appState.tg.initData, // –°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
            isExpanded: appState.tg.isExpanded,
            viewportHeight: appState.tg.viewportHeight,
            colorScheme: appState.tg.colorScheme,
            themeParams: appState.tg.themeParams
        });

        // –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê:
        console.log('üåç Environment check:', {
            url: window.location.href,
            referrer: document.referrer,
            userAgent: navigator.userAgent,
            isHTTPS: window.location.protocol === 'https:',
            hasInitData: !!appState.tg.initData,
            initDataLength: appState.tg.initData?.length || 0
        });

        console.log('üë§ User data extracted:', {
            userId: appState.tg.initDataUnsafe?.user?.id,
            firstName: appState.tg.initDataUnsafe?.user?.first_name,
            lastName: appState.tg.initDataUnsafe?.user?.last_name,
            username: appState.tg.initDataUnsafe?.user?.username
        });

        // Get user data
        if (appState.tg.initDataUnsafe && appState.tg.initDataUnsafe.user) {
            const user = appState.tg.initDataUnsafe.user;

            // –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            appState.userId = user.id.toString();
            appState.userName = user.first_name + (user.last_name ? ' ' + user.last_name : '');

            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            appState.userUsername = user.username || null;
            appState.userLanguage = user.language_code || 'en';
            appState.userIsPremium = user.is_premium || false;
            appState.userPhotoUrl = user.photo_url || null;
            appState.userAllowsWriteToPm = user.allows_write_to_pm || false;

            // –î–∞–Ω–Ω—ã–µ —á–∞—Ç–∞/—Å–µ—Å—Å–∏–∏
            appState.chatInstance = appState.tg.initDataUnsafe.chat_instance || null;
            appState.chatType = appState.tg.initDataUnsafe.chat_type || null;
            appState.authDate = appState.tg.initDataUnsafe.auth_date || null;

            // –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∏ –≤–µ—Ä—Å–∏—è
            appState.telegramPlatform = appState.tg.platform || 'unknown';
            appState.telegramVersion = appState.tg.version || 'unknown';

            console.log('‚úÖ REAL USER DATA SET:', {
                userId: appState.userId,
                userName: appState.userName,
                username: appState.userUsername,
                language: appState.userLanguage,
                isPremium: appState.userIsPremium,
                platform: appState.telegramPlatform,
                version: appState.telegramVersion,
                chatType: appState.chatType
            });
        } else {
            // ‚úÖ –£–õ–£–ß–®–ï–ù–ù–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê:
            console.log('‚ùå NO USER DATA - detailed check:', {
                hasInitDataUnsafe: !!appState.tg.initDataUnsafe,
                initDataUnsafeKeys: Object.keys(appState.tg.initDataUnsafe || {}),
                hasInitData: !!appState.tg.initData,
                initDataPreview: appState.tg.initData?.substring(0, 100),
                launchedVia: appState.tg.initDataUnsafe?.start_param || 'unknown',
                currentURL: window.location.href,
                isDirectAccess: !document.referrer.includes('telegram')
            });

            // –†–∞–∑–Ω—ã–µ fallback –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
            if (!appState.tg.initDataUnsafe) {
                appState.userId = 'fallback_no_unsafe_' + Date.now();
                appState.userName = 'No InitDataUnsafe';
            } else if (!appState.tg.initDataUnsafe.user) {
                appState.userId = 'fallback_no_user_' + Date.now();
                appState.userName = 'No User Data';
            } else {
                appState.userId = 'fallback_unknown_' + Date.now();
                appState.userName = 'Unknown Issue';
            }

            appState.userUsername = null;
            appState.userLanguage = 'en';
            appState.userIsPremium = false;
            appState.userPhotoUrl = null;
            appState.telegramPlatform = appState.tg?.platform || 'unknown';
            appState.telegramVersion = appState.tg?.version || 'unknown';
        }


        // Auto-detect language
        // Auto-detect language, –Ω–æ –Ω–µ –ø–µ—Ä–µ—Ç–∏—Ä–∞—Ç—å –≤—Ä—É—á–Ω—É—é —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π
        const tgLangRaw = appState.tg.initDataUnsafe?.user?.language_code;
        const tgLang = tgLangRaw?.split('-')[0]; // "ru-RU" ‚Üí "ru"
        const saved = JSON.parse(localStorage.getItem('appSettings') || '{}');
        if (!saved.language && tgLang && CONFIG.LANGUAGES.includes(tgLang)) {
            appState.setLanguage(tgLang);
        }

        showStatus('success', appState.translate('connected'));

    } catch (error) {
        console.error('‚ùå Telegram initialization error:', error);
        showStatus('error', 'Telegram connection error');
    }
}

function initLanguageDropdown() {
    const btn = document.getElementById('langBtn');
    const menu = document.getElementById('langMenu');
    if (!btn || !menu) return;

    // –ó–∞–ø–æ–ª–Ω–∏—Ç—å –º–µ–Ω—é —è–∑—ã–∫–∞–º–∏
    menu.innerHTML = '';
    CONFIG.LANGUAGES.forEach(l => {
        const li = document.createElement('li');
        li.textContent = l; // –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –∫—Ä–∞—Å–∏–≤–æ–µ –∏–º—è, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        li.addEventListener('click', (evt) => {
            evt.stopPropagation();
            appState.setLanguage(l);        // —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ localStorage —á–µ—Ä–µ–∑ saveSettings()
            menu.style.display = 'none';    // —Å–∫—Ä—ã—Ç—å –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞
        });
        menu.appendChild(li);
    });

    // –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç–æ (–¥—É–±–ª–∏—Ä—É–µ–º CSS –Ω–∞ —Å–ª—É—á–∞–π –∑–∞–¥–µ—Ä–∂–∫–∏ —Å—Ç–∏–ª–µ–π)
    menu.style.display = 'none';

    // –û—Ç–∫—Ä—ã—Ç—å/–∑–∞–∫—Ä—ã—Ç—å –ø–æ –∫–Ω–æ–ø–∫–µ
    btn.addEventListener('click', (evt) => {
        evt.stopPropagation();
        menu.style.display = (menu.style.display === 'block') ? 'none' : 'block';
    });

    // –ó–∞–∫—Ä—ã—Ç—å –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ
    document.addEventListener('click', (evt) => {
        if (!menu.contains(evt.target) && !btn.contains(evt.target)) {
            menu.style.display = 'none';
        }
    });

    // –ó–∞–∫—Ä—ã—Ç—å –ø–æ Esc
    document.addEventListener('keydown', (evt) => {
        if (evt.key === 'Escape') {
            menu.style.display = 'none';
        }
    });
}

// üöÄ App Initialization
document.addEventListener('DOMContentLoaded', async function () {
    console.log('üöÄ pixPLace Creator starting...');


    showLoadingScreen();
    appState.loadSettings();
    appState.loadHistory();

    try {
        await loadTelegramSDK();    // üëâ –¥–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≥—Ä—É–∑–∫–∏ SDK
        await initTelegramApp();    // üëâ —Ç–æ–ª—å–∫–æ —Ç–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ WebApp
    } catch (e) {
        console.error('‚ùå SDK load error:', e);
        showStatus('error', 'Telegram SDK load failed');
    }

    initializeUI();
    initUserImageUpload(); // ‚Üê –¥–æ–±–∞–≤—å —ç—Ç—É —Å—Ç—Ä–æ–∫—É
    initLanguageDropdown();

    const carouselImages = document.querySelectorAll('.carousel-2d-item img');
    carouselImages.forEach(img => {
        img.loading = 'lazy';
        img.decoding = 'async';
    });

    setTimeout(() => {
        hideLoadingScreen();
        showApp();

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        updateUserBalance(appState.userCredits);

        // AI Coach initialization
        initAICoach();
    }, 1500);
});



// üñºÔ∏è Image Generation - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
async function generateImage(event) {
    if (event) {
        event.preventDefault();
    }

    if (appState.isGenerating) return;

    const prompt = document.getElementById('promptInput').value.trim();
    const mode = document.getElementById('modeSelect').value;
    const size = document.getElementById('sizeSelect').value;

    console.log('üöÄ Starting generation:', { prompt, style: appState.selectedStyle, mode, size });

    // Validation
    if (!prompt) {
        showToast('error', appState.translate('error_prompt_required'));
        triggerHaptic('error');
        return;
    }

    if (prompt.length < 5) {
        showToast('error', appState.translate('error_prompt_too_short'));
        triggerHaptic('error');
        return;
    }

    if (!CONFIG.WEBHOOK_URL || CONFIG.WEBHOOK_URL.includes('WEBHOOK')) {
        showToast('error', appState.translate('error_webhook_not_configured'));
        return;
    }



    // === GUARD: photo_session, upscale, background_removal —Ç—Ä–µ–±—É—é—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —Ñ–æ—Ç–æ ===
    const requiresImage = ['photo_session', 'upscale_image', 'background_removal'].includes(mode);
    if (requiresImage) {
        const wrapper = document.getElementById('userImageWrapper');
        const hasLocalImage =
            !!userImageState?.file || !!userImageState?.dataUrl || !!userImageState?.uploadedUrl;

        if (!hasLocalImage) {
            wrapper?.classList.add('need-image');
            const messageKey = mode === 'upscale_image'
                ? 'please_upload_for_upscale'
                : mode === 'background_removal'
                    ? 'please_upload_for_background_removal'
                    : 'please_upload_photo_session';
            showToast('error', appState.translate(messageKey));
            triggerHaptic('error');
            return; // –Ω–µ –Ω–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –∏ –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º webhook
        }
    }

    appState.isGenerating = true;
    appState.startTime = Date.now();

    // Create generation record
    // üëâ –ë–µ—Ä—ë–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–∞—Ä—Ç–æ—á–∫—É –∏–∑ –∫–∞—Ä—É—Å–µ–ª–∏ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∏–ª—å
    const activeCard = document.querySelector('.carousel-2d-item.active');
    const currentStyle = (activeCard?.dataset.style || '').toLowerCase();
    appState.selectedStyle = currentStyle || appState.selectedStyle;

    appState.currentGeneration = {
        id: Date.now(),
        prompt: prompt,
        style: appState.selectedStyle,
        mode: mode,
        size: size,
        timestamp: new Date().toISOString(),
        status: 'processing',
        startTime: appState.startTime
    };

    // Add to history
    appState.generationHistory.unshift(appState.currentGeneration);
    appState.saveHistory();

    // –ö–æ–º–º–µ–Ω—Ç–∏—Ä—É–µ–º –ø–æ–∫–∞–∑ —ç–∫—Ä–∞–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è –Ω–æ–≤–æ–≥–æ UX —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π –∫ –∏—Å—Ç–æ—Ä–∏–∏
    // showProcessing();

    startTimer();

    // –î–æ–±–∞–≤–ª—è–µ–º –ø–ª–∞–≤–Ω—É—é –ø—Ä–æ–∫—Ä—É—Ç–∫—É –∫ –∏—Å—Ç–æ—Ä–∏–∏ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ
    setTimeout(async () => {
        await showHistoryWithScroll();
        createLoadingHistoryItem(appState.currentGeneration);
    }, 100);

    // 1) –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ‚Äî –∑–∞–≥—Ä—É–∑–∏–º –Ω–∞ imgbb
    let userImageUrl = null;
    try {
        userImageUrl = await uploadUserImageIfAny();
    } catch (err) {
        console.warn('User image upload failed:', err);
        const errorEl = document.getElementById('userImageError');
        if (errorEl && !errorEl.textContent) {
            errorEl.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –±–µ–∑ –Ω–µ–≥–æ.';
        }
    }
    // === –ï—Å–ª–∏ —Ä–µ–∂–∏–º photo_session ‚Äî –±–µ–∑ –≤–∞–ª–∏–¥–Ω–æ–≥–æ URL –¥–∞–ª—å—à–µ –Ω–µ –∏–¥—ë–º ===
    if (mode === 'photo_session' && !userImageUrl) {
        const wrapper = document.getElementById('userImageWrapper');
        wrapper?.classList.add('need-image');
        showToast('error', appState.translate('upload_failed'));
        triggerHaptic('error');
        // –û—Ç–∫–∞—Ç—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —ç–∫—Ä–∞–Ω –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
        appState.isGenerating = false;
        stopTimer();
        showGeneration();
        return; // –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º webhook
    }
    try {
        console.log('üì§ Sending to webhook...');

        // Send request to Make webhook
        const result = await sendToWebhook({
            action: 'Image Generation',
            prompt: prompt,
            style: appState.selectedStyle,
            mode: mode,
            size: size,
            user_image_url: userImageUrl,
            user_id: appState.userId,
            user_name: appState.userName,
            user_username: appState.userUsername,
            user_language: appState.userLanguage,
            user_is_premium: appState.userIsPremium,
            telegram_platform: appState.telegramPlatform,
            telegram_version: appState.telegramVersion,
            timestamp: new Date().toISOString(),
            generation_id: appState.currentGeneration.id
        });

        console.log('üì• Webhook response received:', result);

        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
        appState.currentGeneration.endTime = Date.now();
        appState.currentGeneration.duration = appState.currentGeneration.endTime - appState.currentGeneration.startTime;

        // Handle response
        if (!result || typeof result !== 'object') {
            throw new Error('Invalid response from webhook');
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—à–∏–±–∫—É
        if (result.status === 'error' || result.error) {
            throw new Error(result.error || result.message || 'Unknown error from webhook');
        }

        /// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ (–ü–ï–†–í–ê–Ø –ü–†–û–í–ï–†–ö–ê)
        console.log('üîç Checking if limit reached...');
        const limitReached = result.limit_reached === true ||
            result.limit_reached === 'true' ||
            result.limit_reached === '1' ||
            result.limit_reached === 1;

        console.log('üîç Limit reached result:', limitReached);

        if (limitReached) {
            console.log('‚ö†Ô∏è LIMIT REACHED - Opening modal');
            appState.currentGeneration.status = 'limit';
            appState.currentGeneration.result = result.image_url || null;
            appState.saveHistory();

            // –ü–æ–ª—É—á–∞–µ–º URL –¥–ª—è –æ–ø–ª–∞—Ç—ã –∏–∑ –æ—Ç–≤–µ—Ç–∞ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π
            const paymentUrl = result.payment_url || 'https://t.me/tribute/app?startapp=syDv';
            console.log('üîó Payment URL:', paymentUrl);

            // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            console.log('üîó Calling showSubscriptionNotice...');
            showSubscriptionNotice(result);

            showToast('warning', result.message || 'Generation limit reached');
            triggerHaptic('warning');
            return;
        }
        // –£—Å–ø–µ—à–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
        if (result.status === 'success' && result.image_url) {
            console.log('‚úÖ Generation successful');
            appState.currentGeneration.status = 'success';
            appState.currentGeneration.result = result.image_url;
            appState.saveHistory();

            // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –æ—Ç–≤–µ—Ç–∞
            if (result.remaining_credits !== undefined || result.credit_balance !== undefined || result.cost_balance !== undefined) {
                const balance = result.remaining_credits || result.credit_balance || result.cost_balance;
                updateUserBalance(balance);
                console.log('üí≥ Updated user balance:', balance);
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –º–∏–Ω–∏–∞—Ç—é—Ä—É –≤ –∏—Å—Ç–æ—Ä–∏–∏ —Å –Ω–æ–≤—ã–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
            updateHistoryItemWithImage(appState.currentGeneration.id, result.image_url);

            // üîß –î–û–ë–ê–í–õ–ï–ù–ò–ï: –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏, –µ—Å–ª–∏ –æ–Ω–∞ —É–∂–µ –æ—Ç–∫—Ä—ã—Ç–∞
            // –≠—Ç–æ –∏—Å–ø—Ä–∞–≤–∏—Ç –ø—Ä–æ–±–ª–µ–º—É, –∫–æ–≥–¥–∞ –∏—Å—Ç–æ—Ä–∏—è –Ω–µ –ø—Ä–æ–≥—Ä—É–∂–∞–µ—Ç—Å—è –¥–æ –ø–µ—Ä–≤–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
            const historyList = document.getElementById('historyList');
            if (historyList && !historyList.classList.contains('hidden')) {
                console.log('üìã History is open, updating display after generation');
                updateHistoryDisplay();
            }

            showResult(result);
            showToast('success', appState.translate('success_generated'));
            triggerHaptic('success');
            return;
        }

        // –ï—Å–ª–∏ –¥–æ—à–ª–∏ —Å—é–¥–∞ - –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞
        console.error('‚ùå Unexpected response format:', result);
        throw new Error('Unexpected response format: ' + JSON.stringify(result));

    } catch (error) {
        console.error('‚ùå Generation error:', error);

        appState.currentGeneration.status = 'error';
        appState.currentGeneration.error = error.message;
        appState.currentGeneration.endTime = Date.now();
        appState.currentGeneration.duration = appState.currentGeneration.endTime - appState.currentGeneration.startTime;
        appState.saveHistory();

        showToast('error', appState.translate('error_generation_failed') + ': ' + error.message);
        triggerHaptic('error');
        showGeneration();
    } finally {
        appState.isGenerating = false;
        stopTimer();
    }
}
// üåê Webhook Communication
async function sendToWebhook(data) {
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), CONFIG.TIMEOUT);

    try {
        console.log('üì§ Sending webhook request:', data);

        const response = await fetch(CONFIG.WEBHOOK_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            body: JSON.stringify(data),
            signal: controller.signal
        });

        clearTimeout(timeoutId);

        console.log('üì• Webhook response status:', response.status, response.statusText);

        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º Content-Type
        const contentType = response.headers.get('content-type');
        console.log('üìÑ Response content-type:', contentType);

        let result;
        try {
            if (contentType && contentType.includes('application/json')) {
                const jsonText = await response.text();
                result = JSON.parse(jsonText);
                console.log('‚úÖ Parsed webhook response:', result);
            } else if (contentType && contentType.includes('text/')) {
                // –°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª —Ç–µ–∫—Å—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—à–∏–±–∫—É)
                const textResponse = await response.text();
                console.log('üìÑ Server returned text:', textResponse);
                throw new Error('Server returned text instead of JSON: ' + textResponse);
            } else {
                // –ù–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π content-type ‚Äî –ø—ã—Ç–∞–µ–º—Å—è –ø–∞—Ä—Å–∏—Ç—å –∫–∞–∫ JSON
                const textResponse = await response.text();
                console.log('üìÑ Unexpected content-type, trying to parse as JSON:', textResponse);
                try {
                    result = JSON.parse(textResponse);
                } catch (parseError) {
                    console.error('‚ùå Failed to parse response:', textResponse);
                    throw new Error('Server returned invalid format: ' + textResponse.substring(0, 100));
                }
            }
        } catch (error) {
            console.error('‚ùå Response parsing error:', error);
            if (error instanceof SyntaxError) {
                throw new Error('Server returned malformed JSON');
            }
            throw error;
        }

        console.log('‚úÖ Parsed webhook response:', result);
        return result;

    } catch (error) {
        clearTimeout(timeoutId);

        if (error.name === 'AbortError') {
            throw new Error(appState.translate('error_timeout'));
        }

        console.error('‚ùå Webhook error:', error);
        throw error;
    }
}
// üé® Style Selection
//  2D Carousel (loop, Android-friendly)
(() => {
    // –ù–∞—Ö–æ–¥–∏–º —Ç—Ä–µ–∫ –ø–æ id –∏–ª–∏ –ø–æ –∫–ª–∞—Å—Å—É
    const track = document.getElementById('carousel2d') || document.querySelector('.carousel-2d');
    if (!track) { console.warn('[carousel2d] —Ç—Ä–µ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω'); return; }
    if (track._carouselInited) return; // –∑–∞—â–∏—Ç–∞ –æ—Ç –¥–≤–æ–π–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    track._carouselInited = true;

    const cards = Array.from(track.querySelectorAll('.carousel-2d-item'));
    if (!cards.length) { console.warn('[carousel2d] –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã'); return; }

    let selectedStyle = (cards[0].dataset.style || '').toLowerCase();
    let isPointerDown = false;
    let moved = false;
    let startX = 0, startY = 0, startScroll = 0;

    // ===== helpers =====
    function updateGutters() {
        const cardW = cards[0]?.offsetWidth || 0;
        const viewport = track.clientWidth || 0;
        if (!cardW || !viewport) return;
        const gutter = Math.max(0, (viewport - cardW) / 2);
        track.style.paddingLeft = `${gutter}px`;
        track.style.paddingRight = `${gutter}px`;
    }

    function centerCard(card, smooth = true) {
        if (!card) return;
        const viewport = track.clientWidth;
        const left = card.offsetLeft - (viewport - card.offsetWidth) / 2;
        const maxScroll = track.scrollWidth - viewport;
        const clamped = Math.max(0, Math.min(left, maxScroll));
        track.scrollTo({ left: clamped, behavior: smooth ? 'smooth' : 'auto' });
    }

    function highlight(card, { scroll = false } = {}) {
        cards.forEach(c => c.classList.remove('active'));
        if (!card) return;
        card.classList.add('active');

        // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å—Ç–∏–ª—å
        selectedStyle = (card.dataset.style || '').toLowerCase();
        if (window.appState) window.appState.selectedStyle = selectedStyle;

        // –°–æ–æ–±—â–∞–µ–º –Ω–∞—Ä—É–∂—É (–µ—Å–ª–∏ –∫—Ç–æ-—Ç–æ —Å–ª—É—à–∞–µ—Ç)
        document.dispatchEvent(new CustomEvent('style:change', { detail: { style: selectedStyle } }));

        if (scroll) centerCard(card, true);
    }

    function nearestCard() {
        const trackRect = track.getBoundingClientRect();
        const centerX = trackRect.left + trackRect.width / 2;
        let best = null, bestDist = Infinity;
        for (const c of cards) {
            const r = c.getBoundingClientRect();
            const cardCenter = r.left + r.width / 2;
            const dist = Math.abs(cardCenter - centerX);
            if (dist < bestDist) { bestDist = dist; best = c; }
        }
        return best;
    }
    // ===== /helpers =====

    // Pointer-—Å–æ–±—ã—Ç–∏—è (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ –¥–ª—è –º—ã—à–∏/—Ç–∞—á–∞/–ø–µ—Ä–∞)
    track.addEventListener('pointerdown', (e) => {
        isPointerDown = true;
        moved = false;
        startX = e.clientX;
        startY = e.clientY;
        startScroll = track.scrollLeft;
        track.setPointerCapture?.(e.pointerId);
    });

    track.addEventListener('pointermove', (e) => {
        if (!isPointerDown) return;
        const dx = e.clientX - startX;
        const dy = e.clientY - startY;
        if (!moved && Math.hypot(dx, dy) > 8) moved = true; // —á—É—Ç—å –±–æ–ª—å—à–µ –ø–æ—Ä–æ–≥ ¬´–¥—Ä–æ–∂–∞–Ω–∏—è¬ª
        track.scrollLeft = startScroll - dx;
    });

    function endPointer(e) {
        if (!isPointerDown) return;
        isPointerDown = false;

        if (moved) {
            // –ø–æ—Å–ª–µ —Å–≤–∞–π–ø–∞ ‚Äî —Å–Ω—ç–ø –∫ –±–ª–∏–∂–∞–π—à–µ–π
            requestAnimationFrame(() => {
                const c = nearestCard();
                if (c) highlight(c, { scroll: true });
            });
        } else {
            // —ç—Ç–æ ¬´—Ç–∞–ø¬ª: –≤–æ–∑—å–º—ë–º —ç–ª–µ–º–µ–Ω—Ç –ø–æ–¥ –ø–∞–ª—å—Ü–µ–º/–º—ã—à—å—é
            const el = document.elementFromPoint(e.clientX, e.clientY);
            const card = el?.closest?.('.carousel-2d-item');
            if (card && track.contains(card)) {
                highlight(card, { scroll: true });
            }
        }
    }

    track.addEventListener('pointerup', endPointer);
    track.addEventListener('pointercancel', endPointer);
    track.addEventListener('pointerleave', endPointer);

    // –î–æ–ø. —Ñ–æ–ª–±—ç–∫: —è–≤–Ω—ã–µ –∫–ª–∏–∫–∏ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–∞–º (–Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ pointer —Å–æ–±—ã—Ç–∏—è –≥–¥–µ-—Ç–æ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç—Å—è)
    cards.forEach(c => {
        c.addEventListener('click', (e) => {
            // –µ—Å–ª–∏ —Ç–æ–ª—å–∫–æ —á—Ç–æ –±—ã–ª —Å–≤–∞–π–ø ‚Äî –Ω–µ —Å—á–∏—Ç–∞–µ–º —ç—Ç–æ –∫–ª–∏–∫–æ–º
            if (moved) return;
            highlight(c, { scroll: true });
        });
    });

    // –ü—É–±–ª–∏—á–Ω—ã–π API (–µ—Å–ª–∏ –≥–¥–µ-—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è)
    window.getSelectedStyle = function () { return selectedStyle; };
    window.setCarouselStyle = function (style) {
        const target = String(style || '').toLowerCase();
        const card = cards.find(c => (c.dataset.style || '').toLowerCase() === target);
        if (card) highlight(card, { scroll: true });
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    updateGutters();
    highlight(cards[0], { scroll: false });

    window.addEventListener('resize', () => {
        updateGutters();
        const active = track.querySelector('.carousel-2d-item.active');
        if (active) centerCard(active, true);
    });
})();


/*(function () {
    const track = document.getElementById('carousel2d');
    const wrapper = track?.closest('.carousel-2d-wrapper');
    if (!track || !wrapper) return;

    const cards = Array.from(track.querySelectorAll('.carousel-2d-item'));
    if (!cards.length) return;

    let selectedStyle = (cards[0].dataset.style || '').toLowerCase();
    let isPointerDown = false;
    let startX = 0;
    let startScroll = 0;
    let moved = false;

    
function nearestCard() {
    const trackRect = track.getBoundingClientRect();
    const center = trackRect.left + trackRect.width / 2;
    let best = null, bestDist = Infinity;

    for (const c of cards) {
        const r = c.getBoundingClientRect();
        const cardCenter = r.left + r.width / 2;
        const dist = Math.abs(cardCenter - center);
        if (dist < bestDist) {
            bestDist = dist;
            best = c;
        }
    }
    return best;
}

function highlight(card, { scroll = false } = {}) {
    cards.forEach(c => c.classList.remove('active'));
    if (!card) return;
    card.classList.add('active');

    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∏–ª—å
    selectedStyle = (card.dataset.style || '').toLowerCase();
    if (window.appState) {
        appState.selectedStyle = selectedStyle;
    }

    console.log('üé® Highlighted style:', selectedStyle);
    console.log('üé® appState.selectedStyle:', appState?.selectedStyle);

    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —è–≤–Ω–æ —Å–∫–∞–∑–∞–Ω–æ
    if (scroll) {
        card.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
    }
}

// –ù–∞–π—Ç–∏ –±–ª–∏–∂–∞–π—à—É—é –∫–∞—Ä—Ç–æ—á–∫—É –∫ —Ç–µ–∫—É—â–µ–º—É —Å–∫—Ä–æ–ª–ª—É

// –°–Ω—ç–ø–∏–º –∫ –±–ª–∏–∂–∞–π—à–µ–π –∫–∞—Ä—Ç–æ—á–∫–µ
function onCardClick(e) {
    if (moved) return; // —Å–≤–∞–π–ø ‚Äî –Ω–µ –∫–ª–∏–∫
    const card = e.currentTarget;
    highlight(card, { scroll: true });
}

function snapToNearest() {
    const card = nearestCard();
    if (card) highlight(card, { scroll: true });
}


// Pointer —Å–æ–±—ã—Ç–∏—è –Ω–∞ —Ç—Ä–µ–∫–µ
track.addEventListener('pointerdown', (e) => {
    isPointerDown = true;
    moved = false;
    startX = e.clientX;
    startScroll = track.scrollLeft;
    track.setPointerCapture(e.pointerId);
});

track.addEventListener('pointermove', (e) => {
    if (!isPointerDown) return;
    const dx = e.clientX - startX;
    if (Math.abs(dx) > 5) moved = true;
    // –∏–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –¥–ª—è —Å–∫—Ä–æ–ª–ª–∞
    track.scrollLeft = startScroll - dx;
});

function endPointer(e) {
    if (!isPointerDown) return;
    isPointerDown = false;
    // –ø–æ—Å–ª–µ —Å–≤–∞–π–ø–∞ ‚Äî —Å–Ω—ç–ø –∫ –±–ª–∏–∂–∞–π—à–µ–π
    requestAnimationFrame(snapToNearest);
}

track.addEventListener('pointerup', endPointer);
track.addEventListener('pointercancel', endPointer);
track.addEventListener('pointerleave', endPointer);

// –ü—É–±–ª–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –≤–Ω–µ—à–Ω–µ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
window.getSelectedStyle = function () {
    return selectedStyle;
};
window.setCarouselStyle = function (style) {
    const target = String(style || '').toLowerCase();
    const card = cards.find(c => (c.dataset.style || '').toLowerCase() === target);
    if (card) highlight(card, { scroll: true });
};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ‚Äî –≤—ã–¥–µ–ª–∏–º –ø–µ—Ä–≤—É—é –≤–∏–¥–∏–º—É—é/–ø–µ—Ä–≤—É—é –ø–æ —Å–ø–∏—Å–∫—É
// highlight(cards[0]);
highlight(cards[0], { scroll: false });

// –ù–∞ —Ä–µ—Å–∞–π–∑ ‚Äî —É–¥–µ—Ä–∂–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—É—é –≤ –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç–∏
window.addEventListener('resize', () => {
    const active = track.querySelector('.carousel-2d-item.active');
    if (active) active.scrollIntoView({ behavior: 'smooth', inline: 'nearest', block: 'nearest' });
});
}) ();
*/
// üîÑ Action Functions
function newGeneration() {
    showGeneration();
    // Clear form
    //  document.getElementById('promptInput').value = '';
    //  document.getElementById('charCounter').textContent = '0';
}

function cancelGeneration() {
    if (appState.currentGeneration) {
        appState.currentGeneration.status = 'cancelled';
        appState.currentGeneration.error = 'Cancelled by user';
        appState.saveHistory();
    }

    appState.isGenerating = false;
    stopTimer();
    showGeneration();
    triggerHaptic('medium');
}

// üì± Device Integration
async function downloadImage() {
    if (!appState.currentGeneration?.result) return;

    try {
        const response = await fetch(appState.currentGeneration.result);
        const blob = await response.blob();
        const url = URL.createObjectURL(blob);

        const link = document.createElement('a');
        link.href = url;
        link.download = `ai-generated-${appState.currentGeneration.id}.png`; // –ª—É—á—à–µ –æ—Å—Ç–∞–≤–∏—Ç—å .png
        document.body.appendChild(link); // –∏–Ω–æ–≥–¥–∞ –±–µ–∑ —ç—Ç–æ–≥–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ Safari
        link.click();
        document.body.removeChild(link);

        URL.revokeObjectURL(url); // —á–∏—Å—Ç–∏–º –ø–∞–º—è—Ç—å

        showToast('info', appState.translate('download_started'));
        triggerHaptic('light');
    } catch (err) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏:", err);
        showToast('error', 'Download failed');
    }
}
/*function downloadImage() {
    if (!appState.currentGeneration?.result) return;

    const link = document.createElement('a');
    link.href = appState.currentGeneration.result;
    link.download = `ai-generated-${appState.currentGeneration.id}.png`;
    link.click();

    showToast('info', appState.translate('download_started'));
    triggerHaptic('light');
}
*/

async function shareImage() {
    const gen = appState.currentGeneration;
    if (!gen?.result) return;

    const imageUrl = gen.result;
    const prompt = (gen.prompt || 'pixPLace Image').trim();
    const botUrl = CONFIG.TELEGRAM_BOT_URL || 'https://t.me/your_bot';
    const hashtags = CONFIG.SHARE_DEFAULT_HASHTAGS || '#pixPLace';

    // –ó–∞–≥–æ–ª–æ–≤–æ–∫ + —Ç–µ–∫—Å—Ç –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
    const title = prompt.length > 100 ? (prompt.slice(0, 97) + '...') : prompt;
    const postText = `${prompt}\n\nCreated with pixPLace ‚ú®\nTry it: ${botUrl}\n${hashtags}`;

    // –§—É–Ω–∫—Ü–∏—è –Ω–∞ —Å–ª—É—á–∞–π —Ñ–æ–ª–±—ç–∫–∞ ‚Äî –æ—Ç–∫—Ä—ã—Ç—å Pinterest composer –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç
    const openPinterestFallback = async () => {
        try {
            // –û—Ç–∫—Ä–æ–µ–º Pinterest Pin Builder c –º–µ–¥–∏–∞ –∏ —Å—Å—ã–ª–∫–æ–π –Ω–∞ –±–æ—Ç–∞
            const pinUrl = `https://www.pinterest.com/pin-builder/?` +
                `media=${encodeURIComponent(imageUrl)}` +
                `&url=${encodeURIComponent(botUrl)}` +
                `&description=${encodeURIComponent(postText)}`;
            window.open(pinUrl, '_blank', 'noopener,noreferrer');

            // –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å–∫–æ–ø–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç
            try {
                await navigator.clipboard.writeText(postText);
                showToast('info', appState.translate('copied_to_clipboard'));
            } catch { }
            triggerHaptic('light');
        } catch (e) {
            console.error('Pinterest fallback error:', e);
            // –ö—Ä–∞–π–Ω–∏–π —Ñ–æ–ª–±—ç–∫ ‚Äî –ø—Ä–æ—Å—Ç–æ –∫–æ–ø–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –±–æ—Ç–∞ + —Ç–µ–∫—Å—Ç
            try {
                await navigator.clipboard.writeText(`${postText}`);
                showToast('info', appState.translate('copied_to_clipboard'));
            } catch { }
        }
    };

    // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞—à–∞—Ä–∏—Ç—å —Ñ–∞–π–ª (Web Share API Level 2)
    try {
        // –°–∫–∞—á–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞–∫ blob (–º–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å –∏–∑-–∑–∞ CORS ‚Äî –æ–±—Ä–∞–±–æ—Ç–∞–µ–º)
        const resp = await fetch(imageUrl, { mode: 'cors' });
        const blob = await resp.blob();

        const extByType = {
            'image/png': 'png',
            'image/jpeg': 'jpg',
            'image/webp': 'webp',
            'image/gif': 'gif'
        };
        const ext = extByType[blob.type] || 'png';

        // –ò–º—è —Ñ–∞–π–ª–∞ –∏–∑ –ø—Ä–æ–º–ø—Ç–∞
        const safeName = (prompt || 'pixplace-image')
            .toLowerCase()
            .replace(/[^\p{L}\p{N}\-_. ]/gu, '') // –æ—Å—Ç–∞–≤–∏—Ç—å –±—É–∫–≤—ã/—Ü–∏—Ñ—Ä—ã/–¥–µ—Ñ–∏—Å/–ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏–µ/—Ç–æ—á–∫—É/–ø—Ä–æ–±–µ–ª
            .trim()
            .replace(/\s+/g, '-')
            .slice(0, 60) || 'pixplace-image';

        const file = new File([blob], `${safeName}.${ext}`, { type: blob.type || 'image/png' });

        if (navigator.canShare && navigator.canShare({ files: [file] })) {
            const shareData = {
                title,
                text: postText,
                files: [file],
                // url –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å; –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —à–∞—Ä—ã –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ files
                url: botUrl
            };

            await navigator.share(shareData);
            triggerHaptic('light');
            return;
        }

        // –ï—Å–ª–∏ canShare —Å —Ñ–∞–π–ª–∞–º–∏ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è ‚Äî Pinterest —Ñ–æ–ª–±—ç–∫
        await openPinterestFallback();
    } catch (err) {
        // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–∫–∞—á–∞—Ç—å blob (—á–∞—Å—Ç–æ –∏–∑-–∑–∞ CORS) ‚Äî —É–π–¥—ë–º –≤ Pinterest —Ñ–æ–ª–±—ç–∫
        console.warn('Share with file failed (likely CORS). Fallback to Pinterest:', err);
        await openPinterestFallback();
    }
}



// üåç Global Functions
window.toggleLanguage = () => appState.toggleLanguage();
window.toggleTheme = () => appState.toggleTheme();
window.showHistory = showHistory;
window.showGeneration = showGeneration;
window.showProcessing = showProcessing;
//window.selectStyle = selectStyle;
window.selectStyle = (s) => window.setCarouselStyle(s);
window.generateImage = generateImage;
window.newGeneration = newGeneration;
window.cancelGeneration = cancelGeneration;
window.clearHistory = clearHistory;
window.downloadImage = downloadImage;
window.shareImage = shareImage;
window.showSubscriptionNotice = showSubscriptionNotice;

// üéµ Music Functions
/*let currentWidget = null;
let isPlaying = false;

function toggleMusicDropdown() {
    const dropdown = document.getElementById('musicDropdown');
    const isVisible = dropdown.style.display === 'block';

    if (isVisible) {
    dropdown.style.display = 'none';
    } else {
    dropdown.style.display = 'block';
    }

    console.log('üéµ Music dropdown toggled:', !isVisible);
}

function playPlaylist(type) {
    const playlists = {
    lofi: 'https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/330718027&color=%237a8fb5&auto_play=true&hide_related=true&show_comments=false&show_user=false&show_reposts=false&show_teaser=false',
    ambient: 'https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/330718027&color=%237a8fb5&auto_play=true&hide_related=true&show_comments=false&show_user=false&show_reposts=false&show_teaser=false',
    jazz: 'https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/330718027&color=%237a8fb5&auto_play=true&hide_related=true&show_comments=false&show_user=false&show_reposts=false&show_teaser=false',
    relax: 'https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/330718027&color=%237a8fb5&auto_play=true&hide_related=true&show_comments=false&show_user=false&show_reposts=false&show_teaser=false'
    };

    const iframe = document.getElementById('musicPlayer');
    iframe.src = playlists[type];

    // –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—ã
    const controls = document.getElementById('musicControls');
    if (controls) {
    controls.style.display = 'flex';
    }

    // –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É
    const playBtn = document.getElementById('playPauseBtn');
    if (playBtn) {
    playBtn.textContent = '‚ñ∂ Play';
    playBtn.onclick = function () {
    startMusicPlayback(type);
    };
    }

    console.log(`üéµ Loading ${type} playlist`);
}

function startMusicPlayback(type) {
    const playlists = {
    lofi: 'https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/330718027&color=%237a8fb5&auto_play=true&hide_related=true&show_comments=false&show_user=false&show_reposts=false&show_teaser=false',
    ambient: 'https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/330718027&color=%237a8fb5&auto_play=true&hide_related=true&show_comments=false&show_user=false&show_reposts=false&show_teaser=false',
    jazz: 'https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/330718027&color=%237a8fb5&auto_play=true&hide_related=true&show_comments=false&show_user=false&show_reposts=false&show_teaser=false',
    relax: 'https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/330718027&color=%237a8fb5&auto_play=true&hide_related=true&show_comments=false&show_user=false&show_reposts=false&show_teaser=false'
    };

    const iframe = document.getElementById('musicPlayer');
    iframe.src = playlists[type];

    const playBtn = document.getElementById('playPauseBtn');
    if (playBtn) {
    playBtn.textContent = '‚è∏';
    playBtn.onclick = togglePlayPause;
    }

    isPlaying = true;
    console.log(`üéµ Started ${type} playlist`);
}

function togglePlayPause() {
    const playBtn = document.getElementById('playPauseBtn');
    if (isPlaying) {
    playBtn.textContent = '‚ñ∂';
    isPlaying = false;
    } else {
    playBtn.textContent = '‚è∏';
    isPlaying = true;
    }
}

function setVolume(value) {
    console.log(`üîä Volume set to ${value}%`);
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ dropdown –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
document.addEventListener('click', function (event) {
    const musicWidget = document.querySelector('.music-widget');
    const dropdown = document.getElementById('musicDropdown');

    if (musicWidget && dropdown && !musicWidget.contains(event.target)) {
    dropdown.style.display = 'none';
    }
});*/
// üîó Telegram SDK Loader
async function loadTelegramSDK() {
    console.log('üì± Loading Telegram WebApp SDK...');

    // –ï—Å–ª–∏ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω - —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞–µ–º
    if (typeof window !== 'undefined' && window.Telegram?.WebApp) {
        console.log('‚úÖ Telegram SDK already loaded');
        return Promise.resolve();
    }

    return new Promise((resolve, reject) => {
        const timeout = setTimeout(() => {
            console.warn('‚ö†Ô∏è Telegram SDK load timeout - using fallback mode');
            resolve(); // —Ä–∞–∑—Ä–µ—à–∞–µ–º –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –±–µ–∑ SDK
        }, 5000); // 5 —Å–µ–∫—É–Ω–¥ —Ç–∞–π–º—É—Ç

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ Telegram
        const existingScript = document.querySelector('script[src*="telegram-web-app.js"]');
        if (existingScript) {
            console.log('‚úÖ Telegram script already exists');
            clearTimeout(timeout);
            resolve();
            return;
        }

        // –°–æ–∑–¥–∞—ë–º –∏ –∑–∞–≥—Ä—É–∂–∞–µ–º —Å–∫—Ä–∏–ø—Ç
        const script = document.createElement('script');
        script.src = 'https://telegram.org/js/telegram-web-app.js';
        script.async = true;
        script.defer = true;

        script.onload = () => {
            console.log('‚úÖ Telegram SDK loaded successfully');
            clearTimeout(timeout);

            // –ü–æ–¥–æ–∂–¥—ë–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ SDK
            setTimeout(() => {
                resolve();
            }, 100);
        };

        script.onerror = (error) => {
            console.error('‚ùå Failed to load Telegram SDK:', error);
            clearTimeout(timeout);
            resolve(); // —Ä–∞–∑—Ä–µ—à–∞–µ–º –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –±–µ–∑ SDK
        };

        // –î–æ–±–∞–≤–ª—è–µ–º —Å–∫—Ä–∏–ø—Ç –≤ head
        document.head.appendChild(script);
        console.log('üì± Telegram SDK loading started...');
    });
}

// üß™ Debug Functions
window.getAppState = () => appState;
window.setWebhookUrl = (url) => {
    CONFIG.WEBHOOK_URL = url;
    console.log('‚úÖ Webhook URL updated');
};

console.log('üéØ pixPLace App loaded!');
console.log('üîß Debug commands:');
console.log('- getAppState() - get current app state');
console.log('- setWebhookUrl("url") - set webhook URL');
console.log('‚ö†Ô∏è Don\'t forget to set your webhook URL!');
// –î–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞:
window.closeLimitModal = () => {
    const modal = document.getElementById('limitModal');
    if (modal) {
        modal.classList.remove('show');
        showGeneration();
    }
};

// ========== COGNITIVE ASSISTANT INTEGRATION ==========
function createCoachButton() {
    // Create button
    const coachButton = document.createElement('button');
    coachButton.textContent = 'AI Prompt Assistant';
    coachButton.className = 'ai-coach-btn';

    // –í–∞–Ω–∏–ª—å–Ω—ã–µ CSS —Å—Ç–∏–ª–∏ –≤–º–µ—Å—Ç–æ Tailwind –∫–ª–∞—Å—Å–æ–≤ (–ø—Ä–æ–µ–∫—Ç –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Tailwind)
    Object.assign(coachButton.style, {
        position: 'fixed',
        top: '6rem',         // top-4 = 16px
        right: '1rem',       // right-4 = 16px
        zIndex: '40',        // z-40
        background: 'linear-gradient(135deg, #173565ff, #2f3032ff)', // blue-600 to blue-700
        color: 'white',
        padding: '0.5rem 1rem', // px-4 py-2
        borderRadius: '0.5rem',   // rounded-lg
        boxShadow: '0 10px 15px -3px rgba(0, 0, 0, 0.1)', // shadow-lg
        border: 'none',
        cursor: 'pointer',
        fontSize: '0.875rem',   // text-sm
        fontWeight: '600',
        transition: 'all 0.2s ease' // transition-all duration-200
    });
    coachButton.onclick = () => {
        if (window.AICoach) {
            window.AICoach.show();
        } else {
            console.warn('AI Coach not loaded');
        }
    };

    // Add to body (fixed position for easy access)
    document.body.appendChild(coachButton);

    // Style injection for button (minimal)
    const style = document.createElement('style');
    style.textContent = `
        .ai-coach-btn {
            font-size: 14px;
            border: none;
            cursor: pointer;
        }
        .ai-coach-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
    `;
    document.head.appendChild(style);

    console.log('üß† AI Coach button created');
}

async function initAICoach() {
    try {
        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ AICoach –¥–æ—Å—Ç—É–ø–µ–Ω (—É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω –∏–∑ HTML)
        if (!window.AICoach) {
            console.warn('AI Coach not loaded from HTML');
            return;
        }

        createCoachButton();
        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –º–æ–∂–Ω–æ –ø—Ä–æ—Å–ª—É—à–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        window.addEventListener('ai-coach-ready', createCoachButton);
    } catch (error) {
        console.error('Failed to init AI Coach:', error);
    }
}

function createChatButton() {
    // Create floating chat button
    const chatBtn = document.createElement('button');
    chatBtn.id = 'ai-chat-float-btn';
    chatBtn.innerHTML = 'AI Chat';
    chatBtn.style.cssText = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: linear-gradient(135deg, #6366f1, #8b5cf6);
        color: white;
        border: none;
        border-radius: 50px;
        padding: 12px 20px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4);
        transition: all 0.3s ease;
        z-index: 1000;
        display: flex;
        align-items: center;
        gap: 8px;
    `;

    chatBtn.onmouseenter = () => {
        chatBtn.style.transform = 'scale(1.05)';
        chatBtn.style.boxShadow = '0 6px 25px rgba(99, 102, 241, 0.6)';
    };

    chatBtn.onmouseleave = () => {
        chatBtn.style.transform = 'scale(1)';
        chatBtn.style.boxShadow = '0 4px 20px rgba(99, 102, 241, 0.4)';
    };

    chatBtn.onclick = () => {
        if (window.AICoach) {
            window.AICoach.show();
            triggerHaptic('light');
        }
    };

    document.body.appendChild(chatBtn);
    console.log('üß† AI Chat floating button created');
}

// üî• –ö–ê–†–£–°–ï–õ–¨ –ü–õ–ê–ù–û–í –í –õ–ò–ú–ò–¢ –ú–û–î–ê–õ
// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ä—É—Å–µ–ª—å—é –ø–ª–∞–Ω–æ–≤
let planCarouselInterval = null;
let currentPlanSlide = 0;

function initPlansCarousel() {
    const carousel = document.querySelector('.plans-carousel');
    const indicators = document.querySelectorAll('.indicator');

    if (!carousel || !indicators.length) {
        console.log('Plans carousel not found, skipping init');
        return;
    }

    const cards = document.querySelectorAll('.plan-card');
    const totalSlides = Math.ceil(cards.length / 3); // 3 –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–∞ —Å–ª–∞–π–¥

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤
    function updateIndicators(activeIndex) {
        indicators.forEach((indicator, index) => {
            indicator.classList.toggle('active', index === activeIndex);
        });
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –∫ —Å–ª–∞–π–¥—É
    function scrollToSlide(slideIndex) {
        currentPlanSlide = slideIndex;
        const cardWidth = cards[0].offsetWidth;
        const gap = 16; // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ –≤ px
        const scrollLeft = slideIndex * (cardWidth * 3 + gap * 2);
        carousel.scrollTo({
            left: scrollLeft,
            behavior: 'smooth'
        });
        updateIndicators(slideIndex);
    }

    // –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ - —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç
    let userIsInteracting = false; // —Ñ–ª–∞–≥ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

    function startAutoScroll() {
        stopAutoScroll(); // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞
        planCarouselInterval = setInterval(() => {
            // –ù–ï –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç
            if (!userIsInteracting) {
                currentPlanSlide = (currentPlanSlide + 1) % totalSlides;
                scrollToSlide(currentPlanSlide);
            }
        }, 5000); // –£–≤–µ–ª–∏—á–∏–ª–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–æ 5 —Å–µ–∫—É–Ω–¥ –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
    }

    function stopAutoScroll() {
        if (planCarouselInterval) {
            clearInterval(planCarouselInterval);
            planCarouselInterval = null;
        }
    }

    // –ü–∞—É–∑–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
    carousel.addEventListener('mouseenter', stopAutoScroll);
    carousel.addEventListener('mouseleave', startAutoScroll);

    // –ö–ª–∏–∫ –ø–æ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞–º
    indicators.forEach((indicator, index) => {
        indicator.addEventListener('click', () => {
            scrollToSlide(index);
            stopAutoScroll();
            setTimeout(startAutoScroll, 2000);
        });
    });

    // –°–≤–∞–π–ø—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
    let touchStartX = 0;
    carousel.addEventListener('touchstart', (e) => {
        touchStartX = e.changedTouches[0].screenX;
        stopAutoScroll();
    });

    carousel.addEventListener('touchend', (e) => {
        const touchEndX = e.changedTouches[0].screenX;
        const diff = touchStartX - touchEndX;

        if (Math.abs(diff) > 50) {
            if (diff > 0 && currentPlanSlide < totalSlides - 1) {
                scrollToSlide(currentPlanSlide + 1);
            } else if (diff < 0 && currentPlanSlide > 0) {
                scrollToSlide(currentPlanSlide - 1);
            }
        }
        setTimeout(startAutoScroll, 3000);
    });

    // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø - –§–û–†–°–ò–†–û–í–ê–ù–ù–û –¶–ï–ù–¢–†–ò–†–£–ï–ú PRO –ö–ê–†–¢–£ (–∏–Ω–¥–µ–∫—Å 1)
    const centerCardIndex = 1; // –ü—Ä–æ = –∏–Ω–¥–µ–∫—Å 1 (–¥–ª—è 3 –∫–∞—Ä—Ç: 0=LITE, 1=PRO, 2=STUDIO)
    const centerCard = cards[centerCardIndex];

    if (centerCard) {
        // –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º PRO –∫–∞—Ä—Ç—É –ø–æ —Ü–µ–Ω—Ç—Ä—É —ç–∫—Ä–∞–Ω–∞
        setTimeout(() => {
            const containerWidth = carousel.offsetWidth;
            const cardWidth = centerCard.offsetWidth;
            const cardLeft = centerCard.offsetLeft;
            const containerLeft = carousel.offsetLeft;
            const scrollPosition = cardLeft - (containerWidth / 2) + (cardWidth / 2);
            carousel.scrollLeft = Math.max(0, scrollPosition);

            // –í—Ç–æ—Ä–æ–µ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ 100–º—Å –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏
            setTimeout(() => {
                centerCard.scrollIntoView({
                    behavior: 'instant',
                    block: 'nearest',
                    inline: 'center'
                });
            }, 100);
        }, 50);
    }

    highlight(cards[centerCardIndex], { scroll: false });
    updateIndicators(centerCardIndex);
    startAutoScroll();
    console.log('üî• üî• Plans carousel initialized - forced center on PRO card (index', centerCardIndex, ')');
}

// üéØ –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –î–õ–Ø –ö–ê–†–¢–û–ß–ï–ö –ü–õ–ê–ù–û–í
function initPlanCards() {
    const cards = document.querySelectorAll('.plan-card');

    cards.forEach(card => {
        card.addEventListener('click', () => {
            const planType = card.className.includes('lite') ? 'lite' :
                card.className.includes('pro') ? 'pro' : 'studio';

            // –ê–Ω–∏–º–∞—Ü–∏—è –≤—ã–±–æ—Ä–∞
            cards.forEach(c => c.classList.remove('selected'));
            card.classList.add('selected');

            card.style.animation = 'pulse 0.6s ease-out';
            setTimeout(() => {
                card.style.animation = '';
            }, 600);

            console.log('Selected plan:', planType);
        });

        // –≠—Ñ—Ñ–µ–∫—Ç—ã –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
        card.addEventListener('mouseenter', () => {
            card.style.transform = 'translateY(-12px) scale(1.03)';
        });

        card.addEventListener('mouseleave', () => {
            if (!card.classList.contains('selected')) {
                card.style.transform = '';
            }
        });
    });
}

// üé® –≠–§–§–ï–ö–¢–´ –°–¢–ï–ö–õ–ê
function initGlassmorphismEffects() {
    const cards = document.querySelectorAll('.plan-card');

    cards.forEach((card, index) => {
        card.style.animationDelay = `${index * 0.2}s`;
        card.style.opacity = '0';
        card.style.transform = 'translateY(30px)';

        setTimeout(() => {
            card.style.transition = 'all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 200);
    });
}

// –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ö–ê–†–£–°–ï–õ–ò –ü–†–ò –ü–û–ö–ê–ó–ï –ú–û–î–ê–õ–ê
document.addEventListener('DOMContentLoaded', function () {
    // –ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å –∑–∞ –ø–æ—è–≤–ª–µ–Ω–∏–µ–º –º–æ–¥–∞–ª–∞ –ª–∏–º–∏—Ç–∞
    const observer = new MutationObserver(function (mutations) {
        mutations.forEach(function (mutation) {
            if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                const modal = document.getElementById('limitModal');
                if (modal && modal.classList.contains('show')) {
                    // –ú–æ–¥–∞–ª –ø–æ—è–≤–∏–ª—Å—è - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞—Ä—É—Å–µ–ª—å
                    setTimeout(() => {
                        initPlansCarousel();
                        initPlanCards();
                        initGlassmorphismEffects();
                    }, 100);
                }
            }
        });
    });

    const modal = document.getElementById('limitModal');
    if (modal) {
        observer.observe(modal, {
            attributes: true,
            attributeFilter: ['class']
        });
    }
});

// –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
window.plansCarousel = {
    init: initPlansCarousel,
    stopAutoScroll: function () {
        if (planCarouselInterval) {
            clearInterval(planCarouselInterval);
            planCarouselInterval = null;
        }
    }
};
