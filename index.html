<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 16px;
            background: #f5f5f5;
            color: #333;
            margin: 0;
            min-height: 100vh;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 24px 20px;
            text-align: center;
        }
        .header h1 {
            margin: 0 0 8px 0;
            font-size: 24px;
            font-weight: 700;
        }
        .header p {
            margin: 0;
            opacity: 0.9;
            font-size: 14px;
        }
        .content {
            padding: 24px 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            box-sizing: border-box;
            transition: border-color 0.3s ease;
        }
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 16px;
            background: white;
            box-sizing: border-box;
        }
        .style-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 8px;
        }
        .style-btn {
            padding: 12px 8px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            background: white;
            color: #333;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        .style-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .style-btn.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }
        .generate-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            margin-top: 8px;
        }
        .generate-btn:hover {
            transform: translateY(-2px);
        }
        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .loading {
            text-align: center;
            padding: 40px 20px;
            display: none;
        }
        .loading.show {
            display: block;
        }
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .result {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
        }
        .back-btn {
            width: 100%;
            padding: 12px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            margin-top: 16px;
        }
        .status {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 12px;
            margin: 16px 0;
            font-size: 14px;
            color: #1976d2;
        }
        .error {
            background: #ffebee;
            border: 1px solid #f44336;
            color: #c62828;
        }
        .success {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            color: #2e7d32;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé® AI –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä</h1>
            <p>–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –ø–æ–º–æ—â—å—é –ò–ò</p>
        </div>

        <div class="content">
            <div id="mainForm">
                <div class="form-group">
                    <label for="prompt">–û–ø–∏—à–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:</label>
                    <textarea 
                        id="prompt" 
                        rows="3" 
                        placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –∫—Ä–∞—Å–∏–≤—ã–π –∑–∞–∫–∞—Ç –Ω–∞–¥ –º–æ—Ä–µ–º –≤ —Å—Ç–∏–ª–µ –∏–º–ø—Ä–µ—Å—Å–∏–æ–Ω–∏–∑–º–∞"
                    ></textarea>
                </div>

                <div class="form-group">
                    <label>–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∏–ª—å:</label>
                    <div class="style-grid">
                        <button class="style-btn active" data-style="realistic">üåü –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π</button>
                        <button class="style-btn" data-style="artistic">üé≠ –•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π</button>
                        <button class="style-btn" data-style="cartoon">üé™ –ú—É–ª—å—Ç—è—à–Ω—ã–π</button>
                        <button class="style-btn" data-style="fantasy">üßô‚Äç‚ôÇÔ∏è –§—ç–Ω—Ç–µ–∑–∏</button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="quality">–ö–∞—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</label>
                    <select id="quality">
                        <option value="standard">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ (–±—ã—Å—Ç—Ä–æ)</option>
                        <option value="hd" selected>HD (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)</option>
                        <option value="ultra">Ultra HD (–º–µ–¥–ª–µ–Ω–Ω–æ)</option>
                    </select>
                </div>

                <button class="generate-btn" onclick="generateImage()">
                    ‚ú® –°–æ–∑–¥–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                </button>

                <div id="status" class="status" style="display: none;"></div>
            </div>

            <div id="loading" class="loading">
                <div class="spinner"></div>
                <h3>–°–æ–∑–¥–∞–µ–º –≤–∞—à–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ...</h3>
                <p>üí° –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 30-60 —Å–µ–∫—É–Ω–¥</p>
                <p style="font-size: 14px; color: #666; margin-top: 16px;">
                    –†–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ —á–∞—Ç —Å –±–æ—Ç–æ–º
                </p>
                <button class="back-btn" onclick="backToForm()">‚Üê –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</button>
            </div>
        </div>
    </div>

    <script>
        let selectedStyle = 'realistic';
        let isGenerating = false;

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Telegram WebApp
        let tg = null;
        let isTelegramApp = false;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ');

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º Telegram WebApp
            checkTelegramWebApp();

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
            initEventListeners();

            showStatus('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ —Ä–∞–±–æ—Ç–µ', 'success');
        });

        function checkTelegramWebApp() {
            // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å Telegram WebApp –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
            if (window.Telegram && window.Telegram.WebApp) {
                tg = window.Telegram.WebApp;
                isTelegramApp = true;
                tg.expand();
                tg.ready();
                console.log('‚úÖ Telegram WebApp –ø–æ–¥–∫–ª—é—á–µ–Ω');
                showStatus('üì± –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Telegram', 'success');
            } else {
                // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
                loadTelegramScript();
            }
        }

        function loadTelegramScript() {
            const script = document.createElement('script');
            script.src = 'https://telegram.org/js/telegram-web-app.js';
            script.onload = function() {
                if (window.Telegram && window.Telegram.WebApp) {
                    tg = window.Telegram.WebApp;
                    isTelegramApp = true;
                    tg.expand();
                    tg.ready();
                    console.log('‚úÖ Telegram WebApp –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏');
                    showStatus('üì± –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Telegram', 'success');
                } else {
                    console.log('‚ö†Ô∏è Telegram WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                    showStatus('‚ö†Ô∏è –†–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ –¥–µ–º–æ (–±–µ–∑ Telegram)', 'status');
                }
            };
            script.onerror = function() {
                console.log('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å Telegram WebApp');
                showStatus('‚ö†Ô∏è –†–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ –¥–µ–º–æ (–±–µ–∑ Telegram)', 'status');
            };
            document.head.appendChild(script);
        }

        function initEventListeners() {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å—Ç–∏–ª–µ–π
            document.querySelectorAll('.style-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.style-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    selectedStyle = this.dataset.style;
                    console.log('–í—ã–±—Ä–∞–Ω —Å—Ç–∏–ª—å:', selectedStyle);
                });
            });

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤—ã—Å–æ—Ç—ã textarea
            document.getElementById('prompt').addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = this.scrollHeight + 'px';
            });
        }

        function generateImage() {
            if (isGenerating) return;

            const prompt = document.getElementById('prompt').value.trim();
            const quality = document.getElementById('quality').value;

            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!prompt) {
                showStatus('‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ', 'error');
                return;
            }

            if (prompt.length < 5) {
                showStatus('‚ùå –û–ø–∏—Å–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ (–º–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤)', 'error');
                return;
            }

            isGenerating = true;
            showLoading();

            // –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
            const data = {
                action: 'generate_image',
                prompt: prompt,
                style: selectedStyle,
                quality: quality,
                user_agent: navigator.userAgent,
                timestamp: new Date().toISOString(),
                app_version: '1.0'
            };

            console.log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ:', data);

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
            if (isTelegramApp && tg && tg.sendData) {
                try {
                    tg.sendData(JSON.stringify(data));
                    console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ Telegram WebApp');
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —á–µ—Ä–µ–∑ Telegram:', error);
                    showDemoResult(data);
                }
            } else {
                console.log('‚ö†Ô∏è Telegram WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ–º–æ');
                showDemoResult(data);
            }
        }

        function showDemoResult(data) {
            setTimeout(() => {
                const demoDiv = document.createElement('div');
                demoDiv.className = 'result';
                demoDiv.innerHTML = `
                    <h3>üìã –î–∞–Ω–Ω—ã–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã</h3>
                    <p><strong>–ü—Ä–æ–º–ø—Ç:</strong> ${data.prompt}</p>
                    <p><strong>–°—Ç–∏–ª—å:</strong> ${data.style}</p>
                    <p><strong>–ö–∞—á–µ—Å—Ç–≤–æ:</strong> ${data.quality}</p>
                    <div class="status success">
                        ‚úÖ –í —Ä–µ–∞–ª—å–Ω–æ–º –±–æ—Ç–µ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ Make –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                    </div>
                `;

                document.getElementById('loading').appendChild(demoDiv);
            }, 2000);
        }

        function showLoading() {
            document.getElementById('mainForm').style.display = 'none';
            document.getElementById('loading').classList.add('show');
        }

        function backToForm() {
            document.getElementById('loading').classList.remove('show');
            document.getElementById('mainForm').style.display = 'block';
            isGenerating = false;

            // –û—á–∏—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–µ–º–æ
            const results = document.querySelectorAll('.result');
            results.forEach(result => result.remove());
        }

        function showStatus(message, type = 'status') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
            statusDiv.style.display = 'block';

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        window.testGeneration = function() {
            document.getElementById('prompt').value = '–¢–µ—Å—Ç–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫—Ä–∞—Å–∏–≤–æ–≥–æ –∑–∞–∫–∞—Ç–∞';
            generateImage();
        };

        window.getAppInfo = function() {
            return {
                telegramAvailable: isTelegramApp,
                selectedStyle: selectedStyle,
                isGenerating: isGenerating,
                userAgent: navigator.userAgent
            };
        };

        console.log('üéØ –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: testGeneration() –∏–ª–∏ getAppInfo()');
    </script>
</body>
</html>