<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AI Image Generator</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            /* Light Theme */
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --text-primary: #000000;
            --text-secondary: #666666;
            --border-color: #e0e0e0;
            --accent-color: #667eea;
            --accent-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-bg: #e8f5e8;
            --success-border: #4caf50;
            --success-text: #2e7d32;
            --error-bg: #ffebee;
            --error-border: #f44336;
            --error-text: #c62828;
            --info-bg: #e3f2fd;
            --info-border: #2196f3;
            --info-text: #1976d2;
            --shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        [data-theme="dark"] {
            /* Dark Theme */
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --border-color: #404040;
            --accent-color: #8b9dc3;
            --accent-gradient: linear-gradient(135deg, #8b9dc3 0%, #9b7bb8 100%);
            --success-bg: #1b4332;
            --success-border: #52b788;
            --success-text: #95d5b2;
            --error-bg: #4a1a1a;
            --error-border: #ef5350;
            --error-text: #ffcdd2;
            --info-bg: #1a237e;
            --info-border: #3f51b5;
            --info-text: #c5cae9;
            --shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        [data-theme="colorful"] {
            /* Colorful Theme */
            --bg-primary: #fef7ff;
            --bg-secondary: #f3e5f5;
            --text-primary: #4a148c;
            --text-secondary: #7b1fa2;
            --border-color: #ce93d8;
            --accent-color: #e91e63;
            --accent-gradient: linear-gradient(135deg, #e91e63 0%, #ff5722 50%, #ff9800 100%);
            --success-bg: #e8f5e8;
            --success-border: #4caf50;
            --success-text: #2e7d32;
            --error-bg: #ffebee;
            --error-border: #f44336;
            --error-text: #c62828;
            --info-bg: #e1f5fe;
            --info-border: #00bcd4;
            --info-text: #006064;
            --shadow: 0 4px 15px rgba(233,30,99,0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--tg-theme-bg-color, var(--bg-primary));
            color: var(--tg-theme-text-color, var(--text-primary));
            padding: 0;
            margin: 0;
            overflow-x: hidden;
            transition: all 0.3s ease;
        }

        .container {
            padding: 16px;
            max-width: 100%;
        }

        .header {
            background: var(--accent-gradient);
            color: white;
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            position: relative;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .controls {
            position: absolute;
            top: 16px;
            right: 16px;
            display: flex;
            gap: 8px;
        }

        .control-btn {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            background: var(--bg-primary);
            min-width: 120px;
            box-shadow: var(--shadow);
            border-radius: 8px;
            z-index: 1000;
            border: 1px solid var(--border-color);
            margin-top: 4px;
        }

        .dropdown-content.show {
            display: block;
        }

        .dropdown-item {
            padding: 12px 16px;
            cursor: pointer;
            color: var(--text-primary);
            font-size: 14px;
            border-bottom: 1px solid var(--border-color);
            transition: background 0.2s ease;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: var(--bg-secondary);
        }

        .dropdown-item.active {
            background: var(--accent-color);
            color: white;
        }

        .form-section {
            background: var(--tg-theme-secondary-bg-color, var(--bg-secondary));
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: var(--shadow);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--tg-theme-text-color, var(--text-primary));
        }

        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--tg-theme-button-color, var(--border-color));
            border-radius: 12px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            background: var(--tg-theme-bg-color, var(--bg-primary));
            color: var(--tg-theme-text-color, var(--text-primary));
            min-height: 80px;
            transition: border-color 0.3s ease;
        }

        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 16px;
            background: var(--tg-theme-bg-color, var(--bg-primary));
            color: var(--tg-theme-text-color, var(--text-primary));
            cursor: pointer;
        }

        .style-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 8px;
        }

        .style-btn {
            padding: 12px 8px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            background: var(--tg-theme-bg-color, var(--bg-primary));
            color: var(--tg-theme-text-color, var(--text-primary));
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .style-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .style-btn.active {
            border-color: var(--tg-theme-button-color, var(--accent-color));
            background: var(--tg-theme-button-color, var(--accent-color));
            color: var(--tg-theme-button-text-color, white);
        }

        .generate-btn {
            width: 100%;
            padding: 16px;
            background: var(--accent-gradient);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 16px;
            transition: transform 0.2s ease;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
        }

        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .status {
            padding: 12px 16px;
            border-radius: 8px;
            margin: 16px 0;
            font-size: 14px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .status.success {
            background: var(--success-bg);
            border: 1px solid var(--success-border);
            color: var(--success-text);
        }

        .status.error {
            background: var(--error-bg);
            border: 1px solid var(--error-border);
            color: var(--error-text);
        }

        .status.info {
            background: var(--info-bg);
            border: 1px solid var(--info-border);
            color: var(--info-text);
        }

        .loading {
            text-align: center;
            padding: 40px 20px;
            display: none;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--tg-theme-button-color, var(--accent-color));
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .back-btn {
            width: 100%;
            padding: 12px;
            background: var(--text-secondary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            margin-top: 16px;
            transition: opacity 0.2s ease;
        }

        .back-btn:hover {
            opacity: 0.8;
        }

        @media (max-width: 480px) {
            .container {
                padding: 12px;
            }

            .header h1 {
                font-size: 20px;
            }

            .style-grid {
                grid-template-columns: 1fr;
            }

            .controls {
                position: static;
                justify-content: center;
                margin-top: 12px;
            }
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body data-theme="light">
    <div class="container">
        <div class="header">
            <div class="controls">
                <div class="dropdown">
                    <button class="control-btn" id="themeBtn" title="Theme">üé®</button>
                    <div class="dropdown-content" id="themeDropdown">
                        <div class="dropdown-item active" data-theme="light">‚òÄÔ∏è Light</div>
                        <div class="dropdown-item" data-theme="dark">üåô Dark</div>
                        <div class="dropdown-item" data-theme="colorful">üåà Colorful</div>
                    </div>
                </div>
                <div class="dropdown">
                    <button class="control-btn" id="langBtn" title="Language">üåç</button>
                    <div class="dropdown-content" id="langDropdown">
                        <div class="dropdown-item active" data-lang="en">üá∫üá∏ English</div>
                        <div class="dropdown-item" data-lang="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</div>
                        <div class="dropdown-item" data-lang="es">üá™üá∏ Espa√±ol</div>
                        <div class="dropdown-item" data-lang="fr">üá´üá∑ Fran√ßais</div>
                        <div class="dropdown-item" data-lang="de">üá©üá™ Deutsch</div>
                        <div class="dropdown-item" data-lang="zh">üá®üá≥ ‰∏≠Êñá</div>
                        <div class="dropdown-item" data-lang="ja">üáØüáµ Êó•Êú¨Ë™û</div>
                        <div class="dropdown-item" data-lang="ko">üá∞üá∑ ÌïúÍµ≠Ïñ¥</div>
                    </div>
                </div>
            </div>
            <h1 id="headerTitle">üé® AI Image Generator</h1>
            <p id="headerSubtitle">Create unique images using artificial intelligence</p>
        </div>

        <div id="connectionStatus" class="status info">
            <span id="statusText">üîÑ Connecting to Telegram...</span>
        </div>

        <div class="form-section fade-in">
            <div id="mainForm">
                <div class="form-group">
                    <label for="prompt" id="promptLabel">Describe the image:</label>
                    <textarea 
                        id="prompt" 
                        data-placeholder-en="For example: beautiful sunset over the sea in impressionist style"
                        data-placeholder-ru="–ù–∞–ø—Ä–∏–º–µ—Ä: –∫—Ä–∞—Å–∏–≤—ã–π –∑–∞–∫–∞—Ç –Ω–∞–¥ –º–æ—Ä–µ–º –≤ —Å—Ç–∏–ª–µ –∏–º–ø—Ä–µ—Å—Å–∏–æ–Ω–∏–∑–º–∞"
                        data-placeholder-es="Por ejemplo: hermoso atardecer sobre el mar en estilo impresionista"
                        data-placeholder-fr="Par exemple: beau coucher de soleil sur la mer dans le style impressionniste"
                        data-placeholder-de="Zum Beispiel: sch√∂ner Sonnenuntergang √ºber dem Meer im impressionistischen Stil"
                        data-placeholder-zh="‰æãÂ¶ÇÔºöÂç∞Ë±°Ê¥æÈ£éÊ†ºÁöÑÊµ∑‰∏äÁæé‰∏ΩÊó•ËêΩ"
                        data-placeholder-ja="‰æãÔºöÂç∞Ë±°Ê¥æ„Çπ„Çø„Ç§„É´„ÅÆÊµ∑„Å´Ê≤à„ÇÄÁæé„Åó„ÅÑÂ§ïÊó•"
                        data-placeholder-ko="Ïòà: Ïù∏ÏÉÅÌåå Ïä§ÌÉÄÏùºÏùò Î∞îÎã§ ÏúÑ ÏïÑÎ¶ÑÎã§Ïö¥ ÏùºÎ™∞"
                    ></textarea>
                </div>

                <div class="form-group">
                    <label id="styleLabel">Choose style:</label>
                    <div class="style-grid">
                        <button class="style-btn active" data-style="realistic">
                            <span id="style1">üåü Realistic</span>
                        </button>
                        <button class="style-btn" data-style="artistic">
                            <span id="style2">üé≠ Artistic</span>
                        </button>
                        <button class="style-btn" data-style="cartoon">
                            <span id="style3">üé™ Cartoon</span>
                        </button>
                        <button class="style-btn" data-style="fantasy">
                            <span id="style4">üßô‚Äç‚ôÇÔ∏è Fantasy</span>
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="quality" id="qualityLabel">Image quality:</label>
                    <select id="quality">
                        <option value="standard" id="qualityStandard">Standard (fast)</option>
                        <option value="hd" selected id="qualityHD">HD (recommended)</option>
                        <option value="ultra" id="qualityUltra">Ultra HD (slow)</option>
                    </select>
                </div>

                <button class="generate-btn" id="generateBtn" onclick="generateImage()">
                    <span id="generateText">‚ú® Create Image</span>
                </button>
            </div>

            <div id="loading" class="loading">
                <div class="spinner"></div>
                <h3 id="loadingTitle">Creating your image...</h3>
                <p id="loadingSubtitle">üí° This may take 30-60 seconds</p>
                <p id="loadingNote" style="font-size: 14px; color: var(--text-secondary); margin-top: 16px;">
                    Result will be sent to bot chat
                </p>
                <button class="back-btn" onclick="backToForm()">
                    <span id="backText">‚Üê Create new image</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Translations
        const translations = {
            en: {
                headerTitle: "üé® AI Image Generator",
                headerSubtitle: "Create unique images using artificial intelligence",
                statusConnecting: "üîÑ Connecting to Telegram...",
                statusConnected: "üì± Connected to Telegram",
                statusDemo: "‚ö†Ô∏è Demo mode (open via Telegram)",
                statusError: "‚ö†Ô∏è Connection error",
                promptLabel: "Describe the image:",
                styleLabel: "Choose style:",
                style1: "üåü Realistic",
                style2: "üé≠ Artistic", 
                style3: "üé™ Cartoon",
                style4: "üßô‚Äç‚ôÇÔ∏è Fantasy",
                qualityLabel: "Image quality:",
                qualityStandard: "Standard (fast)",
                qualityHD: "HD (recommended)",
                qualityUltra: "Ultra HD (slow)",
                generateText: "‚ú® Create Image",
                generateLoading: "‚è≥ Generating...",
                loadingTitle: "Creating your image...",
                loadingSubtitle: "üí° This may take 30-60 seconds",
                loadingNote: "Result will be sent to bot chat",
                backText: "‚Üê Create new image",
                errorEmpty: "‚ùå Please describe the image",
                errorShort: "‚ùå Description too short (minimum 5 characters)",
                errorSend: "‚ùå Error sending data",
                demoTitle: "üìã Data prepared for sending",
                demoPrompt: "Prompt:",
                demoStyle: "Style:",
                demoQuality: "Quality:",
                demoNote: "‚úÖ In real bot this data will be sent to Make for image generation"
            },
            ru: {
                headerTitle: "üé® AI –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π",
                headerSubtitle: "–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –ø–æ–º–æ—â—å—é –ò–ò",
                statusConnecting: "üîÑ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Telegram...",
                statusConnected: "üì± –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Telegram",
                statusDemo: "‚ö†Ô∏è –î–µ–º–æ —Ä–µ–∂–∏–º (–æ—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram)",
                statusError: "‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è",
                promptLabel: "–û–ø–∏—à–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ:",
                styleLabel: "–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∏–ª—å:",
                style1: "üåü –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π",
                style2: "üé≠ –•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π",
                style3: "üé™ –ú—É–ª—å—Ç—è—à–Ω—ã–π", 
                style4: "üßô‚Äç‚ôÇÔ∏è –§—ç–Ω—Ç–µ–∑–∏",
                qualityLabel: "–ö–∞—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:",
                qualityStandard: "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ (–±—ã—Å—Ç—Ä–æ)",
                qualityHD: "HD (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)",
                qualityUltra: "Ultra HD (–º–µ–¥–ª–µ–Ω–Ω–æ)",
                generateText: "‚ú® –°–æ–∑–¥–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ",
                generateLoading: "‚è≥ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º...",
                loadingTitle: "–°–æ–∑–¥–∞–µ–º –≤–∞—à–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ...",
                loadingSubtitle: "üí° –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 30-60 —Å–µ–∫—É–Ω–¥",
                loadingNote: "–†–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ —á–∞—Ç —Å –±–æ—Ç–æ–º",
                backText: "‚Üê –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ",
                errorEmpty: "‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ",
                errorShort: "‚ùå –û–ø–∏—Å–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ (–º–∏–Ω–∏–º—É–º 5 —Å–∏–º–≤–æ–ª–æ–≤)",
                errorSend: "‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö",
                demoTitle: "üìã –î–∞–Ω–Ω—ã–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏",
                demoPrompt: "–ü—Ä–æ–º–ø—Ç:",
                demoStyle: "–°—Ç–∏–ª—å:",
                demoQuality: "–ö–∞—á–µ—Å—Ç–≤–æ:",
                demoNote: "‚úÖ –í —Ä–µ–∞–ª—å–Ω–æ–º –±–æ—Ç–µ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ Make –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏"
            },
            es: {
                headerTitle: "üé® Generador de Im√°genes IA",
                headerSubtitle: "Crea im√°genes √∫nicas usando inteligencia artificial",
                statusConnecting: "üîÑ Conectando a Telegram...",
                statusConnected: "üì± Conectado a Telegram",
                statusDemo: "‚ö†Ô∏è Modo demo (abrir v√≠a Telegram)",
                statusError: "‚ö†Ô∏è Error de conexi√≥n",
                promptLabel: "Describe la imagen:",
                styleLabel: "Elige estilo:",
                style1: "üåü Realista",
                style2: "üé≠ Art√≠stico",
                style3: "üé™ Caricatura",
                style4: "üßô‚Äç‚ôÇÔ∏è Fantas√≠a",
                qualityLabel: "Calidad de imagen:",
                qualityStandard: "Est√°ndar (r√°pido)",
                qualityHD: "HD (recomendado)",
                qualityUltra: "Ultra HD (lento)",
                generateText: "‚ú® Crear Imagen",
                generateLoading: "‚è≥ Generando...",
                loadingTitle: "Creando tu imagen...",
                loadingSubtitle: "üí° Esto puede tomar 30-60 segundos",
                loadingNote: "El resultado se enviar√° al chat del bot",
                backText: "‚Üê Crear nueva imagen",
                errorEmpty: "‚ùå Por favor describe la imagen",
                errorShort: "‚ùå Descripci√≥n muy corta (m√≠nimo 5 caracteres)",
                errorSend: "‚ùå Error enviando datos",
                demoTitle: "üìã Datos preparados para env√≠o",
                demoPrompt: "Prompt:",
                demoStyle: "Estilo:",
                demoQuality: "Calidad:",
                demoNote: "‚úÖ En el bot real estos datos se enviar√°n a Make para generar"
            },
            fr: {
                headerTitle: "üé® G√©n√©rateur d'Images IA",
                headerSubtitle: "Cr√©ez des images uniques avec l'intelligence artificielle",
                statusConnecting: "üîÑ Connexion √† Telegram...",
                statusConnected: "üì± Connect√© √† Telegram",
                statusDemo: "‚ö†Ô∏è Mode d√©mo (ouvrir via Telegram)",
                statusError: "‚ö†Ô∏è Erreur de connexion",
                promptLabel: "D√©crivez l'image:",
                styleLabel: "Choisir le style:",
                style1: "üåü R√©aliste",
                style2: "üé≠ Artistique",
                style3: "üé™ Cartoon",
                style4: "üßô‚Äç‚ôÇÔ∏è Fantaisie",
                qualityLabel: "Qualit√© d'image:",
                qualityStandard: "Standard (rapide)",
                qualityHD: "HD (recommand√©)",
                qualityUltra: "Ultra HD (lent)",
                generateText: "‚ú® Cr√©er Image",
                generateLoading: "‚è≥ G√©n√©ration...",
                loadingTitle: "Cr√©ation de votre image...",
                loadingSubtitle: "üí° Cela peut prendre 30-60 secondes",
                loadingNote: "Le r√©sultat sera envoy√© au chat du bot",
                backText: "‚Üê Cr√©er nouvelle image",
                errorEmpty: "‚ùå Veuillez d√©crire l'image",
                errorShort: "‚ùå Description trop courte (minimum 5 caract√®res)",
                errorSend: "‚ùå Erreur d'envoi des donn√©es",
                demoTitle: "üìã Donn√©es pr√©par√©es pour l'envoi",
                demoPrompt: "Prompt:",
                demoStyle: "Style:",
                demoQuality: "Qualit√©:",
                demoNote: "‚úÖ Dans le vrai bot ces donn√©es seront envoy√©es √† Make pour g√©n√©rer"
            },
            de: {
                headerTitle: "üé® KI-Bildgenerator",
                headerSubtitle: "Erstellen Sie einzigartige Bilder mit k√ºnstlicher Intelligenz",
                statusConnecting: "üîÑ Verbindung zu Telegram...",
                statusConnected: "üì± Mit Telegram verbunden",
                statusDemo: "‚ö†Ô∏è Demo-Modus (√ºber Telegram √∂ffnen)",
                statusError: "‚ö†Ô∏è Verbindungsfehler",
                promptLabel: "Bild beschreiben:",
                styleLabel: "Stil w√§hlen:",
                style1: "üåü Realistisch",
                style2: "üé≠ K√ºnstlerisch",
                style3: "üé™ Cartoon",
                style4: "üßô‚Äç‚ôÇÔ∏è Fantasy",
                qualityLabel: "Bildqualit√§t:",
                qualityStandard: "Standard (schnell)",
                qualityHD: "HD (empfohlen)",
                qualityUltra: "Ultra HD (langsam)",
                generateText: "‚ú® Bild Erstellen",
                generateLoading: "‚è≥ Generiere...",
                loadingTitle: "Erstelle dein Bild...",
                loadingSubtitle: "üí° Dies kann 30-60 Sekunden dauern",
                loadingNote: "Ergebnis wird an Bot-Chat gesendet",
                backText: "‚Üê Neues Bild erstellen",
                errorEmpty: "‚ùå Bitte beschreiben Sie das Bild",
                errorShort: "‚ùå Beschreibung zu kurz (mindestens 5 Zeichen)",
                errorSend: "‚ùå Fehler beim Senden der Daten",
                demoTitle: "üìã Daten zum Senden vorbereitet",
                demoPrompt: "Prompt:",
                demoStyle: "Stil:",
                demoQuality: "Qualit√§t:",
                demoNote: "‚úÖ Im echten Bot werden diese Daten an Make zur Generierung gesendet"
            },
            zh: {
                headerTitle: "üé® AIÂõæÂÉèÁîüÊàêÂô®",
                headerSubtitle: "‰ΩøÁî®‰∫∫Â∑•Êô∫ËÉΩÂàõÂª∫Áã¨ÁâπÂõæÂÉè",
                statusConnecting: "üîÑ ËøûÊé•Âà∞Telegram...",
                statusConnected: "üì± Â∑≤ËøûÊé•Âà∞Telegram",
                statusDemo: "‚ö†Ô∏è ÊºîÁ§∫Ê®°ÂºèÔºàÈÄöËøáTelegramÊâìÂºÄÔºâ",
                statusError: "‚ö†Ô∏è ËøûÊé•ÈîôËØØ",
                promptLabel: "ÊèèËø∞ÂõæÂÉèÔºö",
                styleLabel: "ÈÄâÊã©È£éÊ†ºÔºö",
                style1: "üåü ÂÜôÂÆû",
                style2: "üé≠ Ëâ∫ÊúØ",
                style3: "üé™ Âç°ÈÄö",
                style4: "üßô‚Äç‚ôÇÔ∏è Â•áÂπª",
                qualityLabel: "ÂõæÂÉèË¥®ÈáèÔºö",
                qualityStandard: "Ê†áÂáÜÔºàÂø´ÈÄüÔºâ",
                qualityHD: "È´òÊ∏ÖÔºàÊé®ËçêÔºâ",
                qualityUltra: "Ë∂ÖÈ´òÊ∏ÖÔºàÊÖ¢ÈÄüÔºâ",
                generateText: "‚ú® ÂàõÂª∫ÂõæÂÉè",
                generateLoading: "‚è≥ ÁîüÊàê‰∏≠...",
                loadingTitle: "Ê≠£Âú®ÂàõÂª∫ÊÇ®ÁöÑÂõæÂÉè...",
                loadingSubtitle: "üí° ËøôÂèØËÉΩÈúÄË¶Å30-60Áßí",
                loadingNote: "ÁªìÊûúÂ∞ÜÂèëÈÄÅÂà∞Êú∫Âô®‰∫∫ËÅäÂ§©",
                backText: "‚Üê ÂàõÂª∫Êñ∞ÂõæÂÉè",
                errorEmpty: "‚ùå ËØ∑ÊèèËø∞ÂõæÂÉè",
                errorShort: "‚ùå ÊèèËø∞Â§™Áü≠ÔºàËá≥Â∞ë5‰∏™Â≠óÁ¨¶Ôºâ",
                errorSend: "‚ùå ÂèëÈÄÅÊï∞ÊçÆÈîôËØØ",
                demoTitle: "üìã Êï∞ÊçÆÂáÜÂ§áÂèëÈÄÅ",
                demoPrompt: "ÊèêÁ§∫Ôºö",
                demoStyle: "È£éÊ†ºÔºö",
                demoQuality: "Ë¥®ÈáèÔºö",
                demoNote: "‚úÖ Âú®ÁúüÂÆûÊú∫Âô®‰∫∫‰∏≠ÔºåËøô‰∫õÊï∞ÊçÆÂ∞ÜÂèëÈÄÅÂà∞MakeËøõË°åÁîüÊàê"
            },
            ja: {
                headerTitle: "üé® AIÁîªÂÉè„Ç∏„Çß„Éç„É¨„Éº„Çø„Éº",
                headerSubtitle: "‰∫∫Â∑•Áü•ËÉΩ„Çí‰Ωø„Å£„Å¶„É¶„Éã„Éº„ÇØ„Å™ÁîªÂÉè„Çí‰ΩúÊàê",
                statusConnecting: "üîÑ Telegram„Å´Êé•Á∂ö‰∏≠...",
                statusConnected: "üì± Telegram„Å´Êé•Á∂öÊ∏à„Åø",
                statusDemo: "‚ö†Ô∏è „Éá„É¢„É¢„Éº„ÉâÔºàTelegramÁµåÁî±„ÅßÈñã„ÅèÔºâ",
                statusError: "‚ö†Ô∏è Êé•Á∂ö„Ç®„É©„Éº",
                promptLabel: "ÁîªÂÉè„ÇíË™¨ÊòéÔºö",
                styleLabel: "„Çπ„Çø„Ç§„É´„ÇíÈÅ∏ÊäûÔºö",
                style1: "üåü „É™„Ç¢„É´",
                style2: "üé≠ „Ç¢„Éº„Éà",
                style3: "üé™ „Ç´„Éº„Éà„Ç•„Éº„É≥",
                style4: "üßô‚Äç‚ôÇÔ∏è „Éï„Ç°„É≥„Çø„Ç∏„Éº",
                qualityLabel: "ÁîªÂÉèÂìÅË≥™Ôºö",
                qualityStandard: "Ê®ôÊ∫ñÔºàÈ´òÈÄüÔºâ",
                qualityHD: "HDÔºàÊé®Â•®Ôºâ",
                qualityUltra: "„Ç¶„É´„Éà„É©HDÔºà‰ΩéÈÄüÔºâ",
                generateText: "‚ú® ÁîªÂÉè‰ΩúÊàê",
                generateLoading: "‚è≥ ÁîüÊàê‰∏≠...",
                loadingTitle: "ÁîªÂÉè„Çí‰ΩúÊàê‰∏≠...",
                loadingSubtitle: "üí° 30-60Áßí„Åã„Åã„ÇãÂ†¥Âêà„Åå„ÅÇ„Çä„Åæ„Åô",
                loadingNote: "ÁµêÊûú„ÅØ„Éú„ÉÉ„Éà„ÉÅ„É£„ÉÉ„Éà„Å´ÈÄÅ‰ø°„Åï„Çå„Åæ„Åô",
                backText: "‚Üê Êñ∞„Åó„ÅÑÁîªÂÉè„Çí‰ΩúÊàê",
                errorEmpty: "‚ùå ÁîªÂÉè„ÇíË™¨Êòé„Åó„Å¶„Åè„Å†„Åï„ÅÑ",
                errorShort: "‚ùå Ë™¨Êòé„ÅåÁü≠„Åô„Åé„Åæ„ÅôÔºàÊúÄ‰Ωé5ÊñáÂ≠óÔºâ",
                errorSend: "‚ùå „Éá„Éº„ÇøÈÄÅ‰ø°„Ç®„É©„Éº",
                demoTitle: "üìã ÈÄÅ‰ø°Áî®„Éá„Éº„ÇøÊ∫ñÂÇôÂÆå‰∫Ü",
                demoPrompt: "„Éó„É≠„É≥„Éó„ÉàÔºö",
                demoStyle: "„Çπ„Çø„Ç§„É´Ôºö",
                demoQuality: "ÂìÅË≥™Ôºö",
                demoNote: "‚úÖ ÂÆüÈöõ„ÅÆ„Éú„ÉÉ„Éà„Åß„ÅØ„ÄÅ„Åì„ÅÆ„Éá„Éº„Çø„ÅåMake„Å´ÈÄÅ‰ø°„Åï„Çå„Å¶ÁîüÊàê„Åï„Çå„Åæ„Åô"
            },
            ko: {
                headerTitle: "üé® AI Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ±Í∏∞",
                headerSubtitle: "Ïù∏Í≥µÏßÄÎä•ÏúºÎ°ú ÎèÖÌäπÌïú Ïù¥ÎØ∏ÏßÄ ÎßåÎì§Í∏∞",
                statusConnecting: "üîÑ ÌÖîÎ†àÍ∑∏Îû® Ïó∞Í≤∞ Ï§ë...",
                statusConnected: "üì± ÌÖîÎ†àÍ∑∏Îû® Ïó∞Í≤∞Îê®",
                statusDemo: "‚ö†Ô∏è Îç∞Î™® Î™®Îìú (ÌÖîÎ†àÍ∑∏Îû®ÏúºÎ°ú Ïó¥Í∏∞)",
                statusError: "‚ö†Ô∏è Ïó∞Í≤∞ Ïò§Î•ò",
                promptLabel: "Ïù¥ÎØ∏ÏßÄ ÏÑ§Î™Ö:",
                styleLabel: "Ïä§ÌÉÄÏùº ÏÑ†ÌÉù:",
                style1: "üåü ÏÇ¨Ïã§Ï†Å",
                style2: "üé≠ ÏòàÏà†Ï†Å",
                style3: "üé™ ÎßåÌôî",
                style4: "üßô‚Äç‚ôÇÔ∏è ÌåêÌÉÄÏßÄ",
                qualityLabel: "Ïù¥ÎØ∏ÏßÄ ÌíàÏßà:",
                qualityStandard: "ÌëúÏ§Ä (Îπ†Î¶Ñ)",
                qualityHD: "HD (Í∂åÏû•)",
                qualityUltra: "Ïö∏Ìä∏Îùº HD (ÎäêÎ¶º)",
                generateText: "‚ú® Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ±",
                generateLoading: "‚è≥ ÏÉùÏÑ± Ï§ë...",
                loadingTitle: "Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ± Ï§ë...",
                loadingSubtitle: "üí° 30-60Ï¥à ÏÜåÏöîÎê† Ïàò ÏûàÏäµÎãàÎã§",
                loadingNote: "Í≤∞Í≥ºÎäî Î¥á Ï±ÑÌåÖÏúºÎ°ú Ï†ÑÏÜ°Îê©ÎãàÎã§",
                backText: "‚Üê ÏÉà Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ±",
                errorEmpty: "‚ùå Ïù¥ÎØ∏ÏßÄÎ•º ÏÑ§Î™ÖÌï¥Ï£ºÏÑ∏Ïöî",
                errorShort: "‚ùå ÏÑ§Î™ÖÏù¥ ÎÑàÎ¨¥ ÏßßÏäµÎãàÎã§ (ÏµúÏÜå 5Ïûê)",
                errorSend: "‚ùå Îç∞Ïù¥ÌÑ∞ Ï†ÑÏÜ° Ïò§Î•ò",
                demoTitle: "üìã Ï†ÑÏÜ°Ïö© Îç∞Ïù¥ÌÑ∞ Ï§ÄÎπÑÎê®",
                demoPrompt: "ÌîÑÎ°¨ÌîÑÌä∏:",
                demoStyle: "Ïä§ÌÉÄÏùº:",
                demoQuality: "ÌíàÏßà:",
                demoNote: "‚úÖ Ïã§Ï†ú Î¥áÏóêÏÑúÎäî Ïù¥ Îç∞Ïù¥ÌÑ∞Í∞Ä MakeÎ°ú Ï†ÑÏÜ°ÎêòÏñ¥ ÏÉùÏÑ±Îê©ÎãàÎã§"
            }
        };

        // App state
        let tg = window.Telegram?.WebApp;
        let selectedStyle = 'realistic';
        let isGenerating = false;
        let isTelegramApp = false;
        let currentLang = 'en';
        let currentTheme = 'light';

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ App loaded');
            detectLanguage();
            initTelegramApp();
            initEventListeners();
            loadSettings();
        });

        function detectLanguage() {
            // Try to get language from Telegram
            if (tg?.initDataUnsafe?.user?.language_code) {
                const tgLang = tg.initDataUnsafe.user.language_code;
                if (translations[tgLang]) {
                    currentLang = tgLang;
                }
            } else {
                // Fallback to browser language
                const browserLang = navigator.language.split('-')[0];
                if (translations[browserLang]) {
                    currentLang = browserLang;
                }
            }

            updateLanguage(currentLang);
        }

        function initTelegramApp() {
            if (tg) {
                try {
                    tg.ready();
                    tg.expand();
                    isTelegramApp = true;

                    // Setup main button
                    tg.MainButton.setText(translations[currentLang].generateText);
                    tg.MainButton.onClick(generateImage);
                    tg.MainButton.show();

                    showStatus(translations[currentLang].statusConnected, 'success');
                    console.log('‚úÖ Telegram WebApp initialized');

                    // Get user data
                    if (tg.initDataUnsafe?.user) {
                        console.log('üë§ User:', tg.initDataUnsafe.user.first_name);
                    }

                } catch (error) {
                    console.error('‚ùå Telegram WebApp initialization error:', error);
                    showStatus(translations[currentLang].statusError, 'error');
                }
            } else {
                console.log('‚ö†Ô∏è Telegram WebApp not available');
                showStatus(translations[currentLang].statusDemo, 'info');
            }
        }

        function initEventListeners() {
            // Style buttons
            document.querySelectorAll('.style-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.style-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    selectedStyle = this.dataset.style;

                    if (tg?.HapticFeedback) {
                        tg.HapticFeedback.impactOccurred('light');
                    }

                    console.log('Selected style:', selectedStyle);
                });
            });

            // Auto-resize textarea
            document.getElementById('prompt').addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = this.scrollHeight + 'px';
            });

            // Theme dropdown
            document.getElementById('themeBtn').addEventListener('click', function(e) {
                e.stopPropagation();
                toggleDropdown('themeDropdown');
            });

            // Language dropdown
            document.getElementById('langBtn').addEventListener('click', function(e) {
                e.stopPropagation();
                toggleDropdown('langDropdown');
            });

            // Theme selection
            document.querySelectorAll('#themeDropdown .dropdown-item').forEach(item => {
                item.addEventListener('click', function() {
                    const theme = this.dataset.theme;
                    changeTheme(theme);
                    closeDropdowns();
                });
            });

            // Language selection
            document.querySelectorAll('#langDropdown .dropdown-item').forEach(item => {
                item.addEventListener('click', function() {
                    const lang = this.dataset.lang;
                    updateLanguage(lang);
                    closeDropdowns();
                });
            });

            // Close dropdowns when clicking outside
            document.addEventListener('click', closeDropdowns);
        }

        function toggleDropdown(dropdownId) {
            closeDropdowns();
            document.getElementById(dropdownId).classList.toggle('show');
        }

        function closeDropdowns() {
            document.querySelectorAll('.dropdown-content').forEach(dropdown => {
                dropdown.classList.remove('show');
            });
        }

        function changeTheme(theme) {
            currentTheme = theme;
            document.body.setAttribute('data-theme', theme);

            // Update active theme
            document.querySelectorAll('#themeDropdown .dropdown-item').forEach(item => {
                item.classList.toggle('active', item.dataset.theme === theme);
            });

            saveSettings();

            if (tg?.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('light');
            }
        }

        function updateLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];

            // Update all text elements
            Object.keys(t).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.textContent = t[key];
                }
            });

            // Update placeholder
            const promptTextarea = document.getElementById('prompt');
            promptTextarea.placeholder = promptTextarea.getAttribute(`data-placeholder-${lang}`) || t.promptLabel;

            // Update active language
            document.querySelectorAll('#langDropdown .dropdown-item').forEach(item => {
                item.classList.toggle('active', item.dataset.lang === lang);
            });

            // Update Telegram main button
            if (isTelegramApp && tg) {
                tg.MainButton.setText(t.generateText);
            }

            saveSettings();

            if (tg?.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('light');
            }
        }

        function generateImage() {
            if (isGenerating) return;

            const t = translations[currentLang];
            const prompt = document.getElementById('prompt').value.trim();
            const quality = document.getElementById('quality').value;

            // Validation
            if (!prompt) {
                showStatus(t.errorEmpty, 'error');
                if (tg?.HapticFeedback) {
                    tg.HapticFeedback.notificationOccurred('error');
                }
                return;
            }

            if (prompt.length < 5) {
                showStatus(t.errorShort, 'error');
                return;
            }

            isGenerating = true;
            showLoading();

            // Data to send
            const data = {
                action: 'generate_image',
                prompt: prompt,
                style: selectedStyle,
                quality: quality,
                language: currentLang,
                theme: currentTheme,
                user_id: tg?.initDataUnsafe?.user?.id || null,
                user_name: tg?.initDataUnsafe?.user?.first_name || 'Guest',
                timestamp: new Date().toISOString(),
                app_version: '3.0'
            };

            console.log('üì§ Sending data:', data);

            // Send data
            if (isTelegramApp && tg?.sendData) {
                try {
                    tg.sendData(JSON.stringify(data));
                    console.log('‚úÖ Data sent via Telegram WebApp');

                    // Update main button
                    tg.MainButton.setText(t.generateLoading);
                    tg.MainButton.hide();

                    if (tg.HapticFeedback) {
                        tg.HapticFeedback.impactOccurred('medium');
                    }

                } catch (error) {
                    console.error('‚ùå Error sending via Telegram:', error);
                    showError(t.errorSend);
                }
            } else {
                console.log('‚ö†Ô∏è Telegram WebApp not available, showing demo');
                showDemoResult(data);
            }
        }

        function showDemoResult(data) {
            const t = translations[currentLang];

            setTimeout(() => {
                const demoDiv = document.createElement('div');
                demoDiv.innerHTML = `
                    <div class="status success">
                        <h3>${t.demoTitle}</h3>
                        <p><strong>${t.demoPrompt}</strong> ${data.prompt}</p>
                        <p><strong>${t.demoStyle}</strong> ${data.style}</p>
                        <p><strong>${t.demoQuality}</strong> ${data.quality}</p>
                        <br>
                        <small>${t.demoNote}</small>
                    </div>
                `;

                document.getElementById('loading').appendChild(demoDiv);
            }, 2000);
        }

        function showLoading() {
            const t = translations[currentLang];

            document.getElementById('mainForm').style.display = 'none';
            document.getElementById('loading').classList.add('show');

            const generateBtn = document.getElementById('generateBtn');
            generateBtn.disabled = true;
            generateBtn.querySelector('span').textContent = t.generateLoading;
        }

        function backToForm() {
            const t = translations[currentLang];

            document.getElementById('loading').classList.remove('show');
            document.getElementById('mainForm').style.display = 'block';
            isGenerating = false;

            const generateBtn = document.getElementById('generateBtn');
            generateBtn.disabled = false;
            generateBtn.querySelector('span').textContent = t.generateText;

            // Restore main button
            if (isTelegramApp && tg) {
                tg.MainButton.setText(t.generateText);
                tg.MainButton.show();
            }

            // Clear demo results
            const demoResults = document.querySelectorAll('#loading > div:not(.spinner):not(h3):not(p):not(.back-btn)');
            demoResults.forEach(result => result.remove());
        }

        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('connectionStatus');
            statusDiv.querySelector('span').textContent = message;
            statusDiv.className = `status ${type}`;

            // Auto-hide success status
            if (type === 'success') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 5000);
            }
        }

        function showError(message) {
            showStatus(message, 'error');
            backToForm();

            if (tg?.HapticFeedback) {
                tg.HapticFeedback.notificationOccurred('error');
            }
        }

        function saveSettings() {
            try {
                const settings = {
                    language: currentLang,
                    theme: currentTheme
                };
                localStorage.setItem('app_settings', JSON.stringify(settings));
            } catch (error) {
                console.warn('Could not save settings:', error);
            }
        }

        function loadSettings() {
            try {
                const saved = localStorage.getItem('app_settings');
                if (saved) {
                    const settings = JSON.parse(saved);
                    if (settings.theme) {
                        changeTheme(settings.theme);
                    }
                    if (settings.language && translations[settings.language]) {
                        updateLanguage(settings.language);
                    }
                }
            } catch (error) {
                console.warn('Could not load settings:', error);
            }
        }

        // Global functions for debugging
        window.testGeneration = function() {
            document.getElementById('prompt').value = 'Test image of beautiful sunset';
            generateImage();
        };

        window.getAppInfo = function() {
            return {
                telegramAvailable: isTelegramApp,
                selectedStyle: selectedStyle,
                isGenerating: isGenerating,
                currentLang: currentLang,
                currentTheme: currentTheme,
                tgData: tg?.initDataUnsafe || null
            };
        };

        // Handle app closing
        window.addEventListener('beforeunload', function() {
            if (isTelegramApp && tg?.sendData) {
                try {
                    const closeData = {
                        action: 'app_closed',
                        user_id: tg?.initDataUnsafe?.user?.id || null,
                        language: currentLang,
                        theme: currentTheme,
                        timestamp: new Date().toISOString()
                    };
                    tg.sendData(JSON.stringify(closeData));
                } catch (error) {
                    console.warn('Could not send close data:', error);
                }
            }
        });

        console.log('üéØ For testing: testGeneration() or getAppInfo()');
    </script>
</body>
</html>