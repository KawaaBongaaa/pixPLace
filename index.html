<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AI Image Generator</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            /* Light Theme */
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --text-primary: #000000;
            --text-secondary: #666666;
            --border-color: #e0e0e0;
            --accent-color: #667eea;
            --accent-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-bg: #e8f5e8;
            --success-border: #4caf50;
            --success-text: #2e7d32;
            --error-bg: #ffebee;
            --error-border: #f44336;
            --error-text: #c62828;
            --info-bg: #e3f2fd;
            --info-border: #2196f3;
            --info-text: #1976d2;
            --shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        [data-theme="dark"] {
            /* Dark Theme */
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --border-color: #404040;
            --accent-color: #8b9dc3;
            --accent-gradient: linear-gradient(135deg, #8b9dc3 0%, #9b7bb8 100%);
            --success-bg: #1b4332;
            --success-border: #52b788;
            --success-text: #95d5b2;
            --error-bg: #4a1a1a;
            --error-border: #ef5350;
            --error-text: #ffcdd2;
            --info-bg: #1a237e;
            --info-border: #3f51b5;
            --info-text: #c5cae9;
            --shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        [data-theme="colorful"] {
            /* Colorful Theme */
            --bg-primary: #fef7ff;
            --bg-secondary: #f3e5f5;
            --text-primary: #4a148c;
            --text-secondary: #7b1fa2;
            --border-color: #ce93d8;
            --accent-color: #e91e63;
            --accent-gradient: linear-gradient(135deg, #e91e63 0%, #ff5722 50%, #ff9800 100%);
            --success-bg: #e8f5e8;
            --success-border: #4caf50;
            --success-text: #2e7d32;
            --error-bg: #ffebee;
            --error-border: #f44336;
            --error-text: #c62828;
            --info-bg: #e1f5fe;
            --info-border: #00bcd4;
            --info-text: #006064;
            --shadow: 0 4px 15px rgba(233,30,99,0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--tg-theme-bg-color, var(--bg-primary));
            color: var(--tg-theme-text-color, var(--text-primary));
            padding: 0;
            margin: 0;
            overflow-x: hidden;
            transition: all 0.3s ease;
        }

        .container {
            padding: 16px;
            max-width: 100%;
        }

        .header {
            background: var(--accent-gradient);
            color: white;
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            position: relative;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .controls {
            position: absolute;
            top: 16px;
            right: 16px;
            display: flex;
            gap: 8px;
        }

        .control-btn {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            background: var(--bg-primary);
            min-width: 120px;
            box-shadow: var(--shadow);
            border-radius: 8px;
            z-index: 1000;
            border: 1px solid var(--border-color);
            margin-top: 4px;
        }

        .dropdown-content.show {
            display: block;
        }

        .dropdown-item {
            padding: 12px 16px;
            cursor: pointer;
            color: var(--text-primary);
            font-size: 14px;
            border-bottom: 1px solid var(--border-color);
            transition: background 0.2s ease;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: var(--bg-secondary);
        }

        .dropdown-item.active {
            background: var(--accent-color);
            color: white;
        }

        .form-section {
            background: var(--tg-theme-secondary-bg-color, var(--bg-secondary));
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: var(--shadow);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--tg-theme-text-color, var(--text-primary));
        }

        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--tg-theme-button-color, var(--border-color));
            border-radius: 12px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            background: var(--tg-theme-bg-color, var(--bg-primary));
            color: var(--tg-theme-text-color, var(--text-primary));
            min-height: 80px;
            transition: border-color 0.3s ease;
        }

        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 16px;
            background: var(--tg-theme-bg-color, var(--bg-primary));
            color: var(--tg-theme-text-color, var(--text-primary));
            cursor: pointer;
        }

        .style-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 8px;
        }

        .style-btn {
            padding: 12px 8px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            background: var(--tg-theme-bg-color, var(--bg-primary));
            color: var(--tg-theme-text-color, var(--text-primary));
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .style-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .style-btn.active {
            border-color: var(--tg-theme-button-color, var(--accent-color));
            background: var(--tg-theme-button-color, var(--accent-color));
            color: var(--tg-theme-button-text-color, white);
        }

        .generate-btn {
            width: 100%;
            padding: 16px;
            background: var(--accent-gradient);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 16px;
            transition: transform 0.2s ease;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
        }

        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .status {
            padding: 12px 16px;
            border-radius: 8px;
            margin: 16px 0;
            font-size: 14px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .status.success {
            background: var(--success-bg);
            border: 1px solid var(--success-border);
            color: var(--success-text);
        }

        .status.error {
            background: var(--error-bg);
            border: 1px solid var(--error-border);
            color: var(--error-text);
        }

        .status.info {
            background: var(--info-bg);
            border: 1px solid var(--info-border);
            color: var(--info-text);
        }

        .loading {
            text-align: center;
            padding: 40px 20px;
            display: none;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--tg-theme-button-color, var(--accent-color));
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .back-btn {
            width: 100%;
            padding: 12px;
            background: var(--text-secondary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            margin-top: 16px;
            transition: opacity 0.2s ease;
        }

        .back-btn:hover {
            opacity: 0.8;
        }

        @media (max-width: 480px) {
            .container {
                padding: 12px;
            }

            .header h1 {
                font-size: 20px;
            }

            .style-grid {
                grid-template-columns: 1fr;
            }

            .controls {
                position: static;
                justify-content: center;
                margin-top: 12px;
            }
        }

        /* Анимации */
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body data-theme="light">
    <div class="container">
        <div class="header">
            <div class="controls">
                <div class="dropdown">
                    <button class="control-btn" id="themeBtn" title="Theme">🎨</button>
                    <div class="dropdown-content" id="themeDropdown">
                        <div class="dropdown-item active" data-theme="light">☀️ Light</div>
                        <div class="dropdown-item" data-theme="dark">🌙 Dark</div>
                        <div class="dropdown-item" data-theme="colorful">🌈 Colorful</div>
                    </div>
                </div>
                <div class="dropdown">
                    <button class="control-btn" id="langBtn" title="Language">🌍</button>
                    <div class="dropdown-content" id="langDropdown">
                        <div class="dropdown-item active" data-lang="en">🇺🇸 English</div>
                        <div class="dropdown-item" data-lang="ru">🇷🇺 Русский</div>
                        <div class="dropdown-item" data-lang="es">🇪🇸 Español</div>
                        <div class="dropdown-item" data-lang="fr">🇫🇷 Français</div>
                        <div class="dropdown-item" data-lang="de">🇩🇪 Deutsch</div>
                        <div class="dropdown-item" data-lang="zh">🇨🇳 中文</div>
                        <div class="dropdown-item" data-lang="ja">🇯🇵 日本語</div>
                        <div class="dropdown-item" data-lang="ko">🇰🇷 한국어</div>
                    </div>
                </div>
            </div>
            <h1 id="headerTitle">🎨 AI Image Generator</h1>
            <p id="headerSubtitle">Create unique images using artificial intelligence</p>
        </div>

        <div id="connectionStatus" class="status info">
            <span id="statusText">🔄 Connecting to Telegram...</span>
        </div>

        <div class="form-section fade-in">
            <div id="mainForm">
                <div class="form-group">
                    <label for="prompt" id="promptLabel">Describe the image:</label>
                    <textarea 
                        id="prompt" 
                        data-placeholder-en="For example: beautiful sunset over the sea in impressionist style"
                        data-placeholder-ru="Например: красивый закат над морем в стиле импрессионизма"
                        data-placeholder-es="Por ejemplo: hermoso atardecer sobre el mar en estilo impresionista"
                        data-placeholder-fr="Par exemple: beau coucher de soleil sur la mer dans le style impressionniste"
                        data-placeholder-de="Zum Beispiel: schöner Sonnenuntergang über dem Meer im impressionistischen Stil"
                        data-placeholder-zh="例如：印象派风格的海上美丽日落"
                        data-placeholder-ja="例：印象派スタイルの海に沈む美しい夕日"
                        data-placeholder-ko="예: 인상파 스타일의 바다 위 아름다운 일몰"
                    ></textarea>
                </div>

                <div class="form-group">
                    <label id="styleLabel">Choose style:</label>
                    <div class="style-grid">
                        <button class="style-btn active" data-style="realistic">
                            <span id="style1">🌟 Realistic</span>
                        </button>
                        <button class="style-btn" data-style="artistic">
                            <span id="style2">🎭 Artistic</span>
                        </button>
                        <button class="style-btn" data-style="cartoon">
                            <span id="style3">🎪 Cartoon</span>
                        </button>
                        <button class="style-btn" data-style="fantasy">
                            <span id="style4">🧙‍♂️ Fantasy</span>
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="quality" id="qualityLabel">Image quality:</label>
                    <select id="quality">
                        <option value="standard" id="qualityStandard">Standard (fast)</option>
                        <option value="hd" selected id="qualityHD">HD (recommended)</option>
                        <option value="ultra" id="qualityUltra">Ultra HD (slow)</option>
                    </select>
                </div>

                <button class="generate-btn" id="generateBtn" onclick="generateImage()">
                    <span id="generateText">✨ Create Image</span>
                </button>
            </div>

            <div id="loading" class="loading">
                <div class="spinner"></div>
                <h3 id="loadingTitle">Creating your image...</h3>
                <p id="loadingSubtitle">💡 This may take 30-60 seconds</p>
                <p id="loadingNote" style="font-size: 14px; color: var(--text-secondary); margin-top: 16px;">
                    Result will be sent to bot chat
                </p>
                <button class="back-btn" onclick="backToForm()">
                    <span id="backText">← Create new image</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Translations
        const translations = {
            en: {
                headerTitle: "🎨 AI Image Generator",
                headerSubtitle: "Create unique images using artificial intelligence",
                statusConnecting: "🔄 Connecting to Telegram...",
                statusConnected: "📱 Connected to Telegram",
                statusDemo: "⚠️ Demo mode (open via Telegram)",
                statusError: "⚠️ Connection error",
                promptLabel: "Describe the image:",
                styleLabel: "Choose style:",
                style1: "🌟 Realistic",
                style2: "🎭 Artistic", 
                style3: "🎪 Cartoon",
                style4: "🧙‍♂️ Fantasy",
                qualityLabel: "Image quality:",
                qualityStandard: "Standard (fast)",
                qualityHD: "HD (recommended)",
                qualityUltra: "Ultra HD (slow)",
                generateText: "✨ Create Image",
                generateLoading: "⏳ Generating...",
                loadingTitle: "Creating your image...",
                loadingSubtitle: "💡 This may take 30-60 seconds",
                loadingNote: "Result will be sent to bot chat",
                backText: "← Create new image",
                errorEmpty: "❌ Please describe the image",
                errorShort: "❌ Description too short (minimum 5 characters)",
                errorSend: "❌ Error sending data",
                demoTitle: "📋 Data prepared for sending",
                demoPrompt: "Prompt:",
                demoStyle: "Style:",
                demoQuality: "Quality:",
                demoNote: "✅ In real bot this data will be sent to Make for image generation"
            },
            ru: {
                headerTitle: "🎨 AI Генератор Изображений",
                headerSubtitle: "Создавайте уникальные изображения с помощью ИИ",
                statusConnecting: "🔄 Подключение к Telegram...",
                statusConnected: "📱 Подключено к Telegram",
                statusDemo: "⚠️ Демо режим (откройте через Telegram)",
                statusError: "⚠️ Ошибка подключения",
                promptLabel: "Опишите изображение:",
                styleLabel: "Выберите стиль:",
                style1: "🌟 Реалистичный",
                style2: "🎭 Художественный",
                style3: "🎪 Мультяшный", 
                style4: "🧙‍♂️ Фэнтези",
                qualityLabel: "Качество изображения:",
                qualityStandard: "Стандартное (быстро)",
                qualityHD: "HD (рекомендуется)",
                qualityUltra: "Ultra HD (медленно)",
                generateText: "✨ Создать изображение",
                generateLoading: "⏳ Генерируем...",
                loadingTitle: "Создаем ваше изображение...",
                loadingSubtitle: "💡 Это может занять 30-60 секунд",
                loadingNote: "Результат будет отправлен в чат с ботом",
                backText: "← Создать новое изображение",
                errorEmpty: "❌ Пожалуйста, опишите изображение",
                errorShort: "❌ Описание слишком короткое (минимум 5 символов)",
                errorSend: "❌ Ошибка отправки данных",
                demoTitle: "📋 Данные подготовлены для отправки",
                demoPrompt: "Промпт:",
                demoStyle: "Стиль:",
                demoQuality: "Качество:",
                demoNote: "✅ В реальном боте эти данные будут отправлены в Make для генерации"
            },
            es: {
                headerTitle: "🎨 Generador de Imágenes IA",
                headerSubtitle: "Crea imágenes únicas usando inteligencia artificial",
                statusConnecting: "🔄 Conectando a Telegram...",
                statusConnected: "📱 Conectado a Telegram",
                statusDemo: "⚠️ Modo demo (abrir vía Telegram)",
                statusError: "⚠️ Error de conexión",
                promptLabel: "Describe la imagen:",
                styleLabel: "Elige estilo:",
                style1: "🌟 Realista",
                style2: "🎭 Artístico",
                style3: "🎪 Caricatura",
                style4: "🧙‍♂️ Fantasía",
                qualityLabel: "Calidad de imagen:",
                qualityStandard: "Estándar (rápido)",
                qualityHD: "HD (recomendado)",
                qualityUltra: "Ultra HD (lento)",
                generateText: "✨ Crear Imagen",
                generateLoading: "⏳ Generando...",
                loadingTitle: "Creando tu imagen...",
                loadingSubtitle: "💡 Esto puede tomar 30-60 segundos",
                loadingNote: "El resultado se enviará al chat del bot",
                backText: "← Crear nueva imagen",
                errorEmpty: "❌ Por favor describe la imagen",
                errorShort: "❌ Descripción muy corta (mínimo 5 caracteres)",
                errorSend: "❌ Error enviando datos",
                demoTitle: "📋 Datos preparados para envío",
                demoPrompt: "Prompt:",
                demoStyle: "Estilo:",
                demoQuality: "Calidad:",
                demoNote: "✅ En el bot real estos datos se enviarán a Make para generar"
            },
            fr: {
                headerTitle: "🎨 Générateur d'Images IA",
                headerSubtitle: "Créez des images uniques avec l'intelligence artificielle",
                statusConnecting: "🔄 Connexion à Telegram...",
                statusConnected: "📱 Connecté à Telegram",
                statusDemo: "⚠️ Mode démo (ouvrir via Telegram)",
                statusError: "⚠️ Erreur de connexion",
                promptLabel: "Décrivez l'image:",
                styleLabel: "Choisir le style:",
                style1: "🌟 Réaliste",
                style2: "🎭 Artistique",
                style3: "🎪 Cartoon",
                style4: "🧙‍♂️ Fantaisie",
                qualityLabel: "Qualité d'image:",
                qualityStandard: "Standard (rapide)",
                qualityHD: "HD (recommandé)",
                qualityUltra: "Ultra HD (lent)",
                generateText: "✨ Créer Image",
                generateLoading: "⏳ Génération...",
                loadingTitle: "Création de votre image...",
                loadingSubtitle: "💡 Cela peut prendre 30-60 secondes",
                loadingNote: "Le résultat sera envoyé au chat du bot",
                backText: "← Créer nouvelle image",
                errorEmpty: "❌ Veuillez décrire l'image",
                errorShort: "❌ Description trop courte (minimum 5 caractères)",
                errorSend: "❌ Erreur d'envoi des données",
                demoTitle: "📋 Données préparées pour l'envoi",
                demoPrompt: "Prompt:",
                demoStyle: "Style:",
                demoQuality: "Qualité:",
                demoNote: "✅ Dans le vrai bot ces données seront envoyées à Make pour générer"
            },
            de: {
                headerTitle: "🎨 KI-Bildgenerator",
                headerSubtitle: "Erstellen Sie einzigartige Bilder mit künstlicher Intelligenz",
                statusConnecting: "🔄 Verbindung zu Telegram...",
                statusConnected: "📱 Mit Telegram verbunden",
                statusDemo: "⚠️ Demo-Modus (über Telegram öffnen)",
                statusError: "⚠️ Verbindungsfehler",
                promptLabel: "Bild beschreiben:",
                styleLabel: "Stil wählen:",
                style1: "🌟 Realistisch",
                style2: "🎭 Künstlerisch",
                style3: "🎪 Cartoon",
                style4: "🧙‍♂️ Fantasy",
                qualityLabel: "Bildqualität:",
                qualityStandard: "Standard (schnell)",
                qualityHD: "HD (empfohlen)",
                qualityUltra: "Ultra HD (langsam)",
                generateText: "✨ Bild Erstellen",
                generateLoading: "⏳ Generiere...",
                loadingTitle: "Erstelle dein Bild...",
                loadingSubtitle: "💡 Dies kann 30-60 Sekunden dauern",
                loadingNote: "Ergebnis wird an Bot-Chat gesendet",
                backText: "← Neues Bild erstellen",
                errorEmpty: "❌ Bitte beschreiben Sie das Bild",
                errorShort: "❌ Beschreibung zu kurz (mindestens 5 Zeichen)",
                errorSend: "❌ Fehler beim Senden der Daten",
                demoTitle: "📋 Daten zum Senden vorbereitet",
                demoPrompt: "Prompt:",
                demoStyle: "Stil:",
                demoQuality: "Qualität:",
                demoNote: "✅ Im echten Bot werden diese Daten an Make zur Generierung gesendet"
            },
            zh: {
                headerTitle: "🎨 AI图像生成器",
                headerSubtitle: "使用人工智能创建独特图像",
                statusConnecting: "🔄 连接到Telegram...",
                statusConnected: "📱 已连接到Telegram",
                statusDemo: "⚠️ 演示模式（通过Telegram打开）",
                statusError: "⚠️ 连接错误",
                promptLabel: "描述图像：",
                styleLabel: "选择风格：",
                style1: "🌟 写实",
                style2: "🎭 艺术",
                style3: "🎪 卡通",
                style4: "🧙‍♂️ 奇幻",
                qualityLabel: "图像质量：",
                qualityStandard: "标准（快速）",
                qualityHD: "高清（推荐）",
                qualityUltra: "超高清（慢速）",
                generateText: "✨ 创建图像",
                generateLoading: "⏳ 生成中...",
                loadingTitle: "正在创建您的图像...",
                loadingSubtitle: "💡 这可能需要30-60秒",
                loadingNote: "结果将发送到机器人聊天",
                backText: "← 创建新图像",
                errorEmpty: "❌ 请描述图像",
                errorShort: "❌ 描述太短（至少5个字符）",
                errorSend: "❌ 发送数据错误",
                demoTitle: "📋 数据准备发送",
                demoPrompt: "提示：",
                demoStyle: "风格：",
                demoQuality: "质量：",
                demoNote: "✅ 在真实机器人中，这些数据将发送到Make进行生成"
            },
            ja: {
                headerTitle: "🎨 AI画像ジェネレーター",
                headerSubtitle: "人工知能を使ってユニークな画像を作成",
                statusConnecting: "🔄 Telegramに接続中...",
                statusConnected: "📱 Telegramに接続済み",
                statusDemo: "⚠️ デモモード（Telegram経由で開く）",
                statusError: "⚠️ 接続エラー",
                promptLabel: "画像を説明：",
                styleLabel: "スタイルを選択：",
                style1: "🌟 リアル",
                style2: "🎭 アート",
                style3: "🎪 カートゥーン",
                style4: "🧙‍♂️ ファンタジー",
                qualityLabel: "画像品質：",
                qualityStandard: "標準（高速）",
                qualityHD: "HD（推奨）",
                qualityUltra: "ウルトラHD（低速）",
                generateText: "✨ 画像作成",
                generateLoading: "⏳ 生成中...",
                loadingTitle: "画像を作成中...",
                loadingSubtitle: "💡 30-60秒かかる場合があります",
                loadingNote: "結果はボットチャットに送信されます",
                backText: "← 新しい画像を作成",
                errorEmpty: "❌ 画像を説明してください",
                errorShort: "❌ 説明が短すぎます（最低5文字）",
                errorSend: "❌ データ送信エラー",
                demoTitle: "📋 送信用データ準備完了",
                demoPrompt: "プロンプト：",
                demoStyle: "スタイル：",
                demoQuality: "品質：",
                demoNote: "✅ 実際のボットでは、このデータがMakeに送信されて生成されます"
            },
            ko: {
                headerTitle: "🎨 AI 이미지 생성기",
                headerSubtitle: "인공지능으로 독특한 이미지 만들기",
                statusConnecting: "🔄 텔레그램 연결 중...",
                statusConnected: "📱 텔레그램 연결됨",
                statusDemo: "⚠️ 데모 모드 (텔레그램으로 열기)",
                statusError: "⚠️ 연결 오류",
                promptLabel: "이미지 설명:",
                styleLabel: "스타일 선택:",
                style1: "🌟 사실적",
                style2: "🎭 예술적",
                style3: "🎪 만화",
                style4: "🧙‍♂️ 판타지",
                qualityLabel: "이미지 품질:",
                qualityStandard: "표준 (빠름)",
                qualityHD: "HD (권장)",
                qualityUltra: "울트라 HD (느림)",
                generateText: "✨ 이미지 생성",
                generateLoading: "⏳ 생성 중...",
                loadingTitle: "이미지 생성 중...",
                loadingSubtitle: "💡 30-60초 소요될 수 있습니다",
                loadingNote: "결과는 봇 채팅으로 전송됩니다",
                backText: "← 새 이미지 생성",
                errorEmpty: "❌ 이미지를 설명해주세요",
                errorShort: "❌ 설명이 너무 짧습니다 (최소 5자)",
                errorSend: "❌ 데이터 전송 오류",
                demoTitle: "📋 전송용 데이터 준비됨",
                demoPrompt: "프롬프트:",
                demoStyle: "스타일:",
                demoQuality: "품질:",
                demoNote: "✅ 실제 봇에서는 이 데이터가 Make로 전송되어 생성됩니다"
            }
        };

        // App state
        let tg = window.Telegram?.WebApp;
        let selectedStyle = 'realistic';
        let isGenerating = false;
        let isTelegramApp = false;
        let currentLang = 'en';
        let currentTheme = 'light';

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 App loaded');
            detectLanguage();
            initTelegramApp();
            initEventListeners();
            loadSettings();
        });

        function detectLanguage() {
            // Try to get language from Telegram
            if (tg?.initDataUnsafe?.user?.language_code) {
                const tgLang = tg.initDataUnsafe.user.language_code;
                if (translations[tgLang]) {
                    currentLang = tgLang;
                }
            } else {
                // Fallback to browser language
                const browserLang = navigator.language.split('-')[0];
                if (translations[browserLang]) {
                    currentLang = browserLang;
                }
            }

            updateLanguage(currentLang);
        }

        function initTelegramApp() {
            if (tg) {
                try {
                    tg.ready();
                    tg.expand();
                    isTelegramApp = true;

                    // Setup main button
                    tg.MainButton.setText(translations[currentLang].generateText);
                    tg.MainButton.onClick(generateImage);
                    tg.MainButton.show();

                    showStatus(translations[currentLang].statusConnected, 'success');
                    console.log('✅ Telegram WebApp initialized');

                    // Get user data
                    if (tg.initDataUnsafe?.user) {
                        console.log('👤 User:', tg.initDataUnsafe.user.first_name);
                    }

                } catch (error) {
                    console.error('❌ Telegram WebApp initialization error:', error);
                    showStatus(translations[currentLang].statusError, 'error');
                }
            } else {
                console.log('⚠️ Telegram WebApp not available');
                showStatus(translations[currentLang].statusDemo, 'info');
            }
        }

        function initEventListeners() {
            // Style buttons
            document.querySelectorAll('.style-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.style-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    selectedStyle = this.dataset.style;

                    if (tg?.HapticFeedback) {
                        tg.HapticFeedback.impactOccurred('light');
                    }

                    console.log('Selected style:', selectedStyle);
                });
            });

            // Auto-resize textarea
            document.getElementById('prompt').addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = this.scrollHeight + 'px';
            });

            // Theme dropdown
            document.getElementById('themeBtn').addEventListener('click', function(e) {
                e.stopPropagation();
                toggleDropdown('themeDropdown');
            });

            // Language dropdown
            document.getElementById('langBtn').addEventListener('click', function(e) {
                e.stopPropagation();
                toggleDropdown('langDropdown');
            });

            // Theme selection
            document.querySelectorAll('#themeDropdown .dropdown-item').forEach(item => {
                item.addEventListener('click', function() {
                    const theme = this.dataset.theme;
                    changeTheme(theme);
                    closeDropdowns();
                });
            });

            // Language selection
            document.querySelectorAll('#langDropdown .dropdown-item').forEach(item => {
                item.addEventListener('click', function() {
                    const lang = this.dataset.lang;
                    updateLanguage(lang);
                    closeDropdowns();
                });
            });

            // Close dropdowns when clicking outside
            document.addEventListener('click', closeDropdowns);
        }

        function toggleDropdown(dropdownId) {
            closeDropdowns();
            document.getElementById(dropdownId).classList.toggle('show');
        }

        function closeDropdowns() {
            document.querySelectorAll('.dropdown-content').forEach(dropdown => {
                dropdown.classList.remove('show');
            });
        }

        function changeTheme(theme) {
            currentTheme = theme;
            document.body.setAttribute('data-theme', theme);

            // Update active theme
            document.querySelectorAll('#themeDropdown .dropdown-item').forEach(item => {
                item.classList.toggle('active', item.dataset.theme === theme);
            });

            saveSettings();

            if (tg?.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('light');
            }
        }

        function updateLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];

            // Update all text elements
            Object.keys(t).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.textContent = t[key];
                }
            });

            // Update placeholder
            const promptTextarea = document.getElementById('prompt');
            promptTextarea.placeholder = promptTextarea.getAttribute(`data-placeholder-${lang}`) || t.promptLabel;

            // Update active language
            document.querySelectorAll('#langDropdown .dropdown-item').forEach(item => {
                item.classList.toggle('active', item.dataset.lang === lang);
            });

            // Update Telegram main button
            if (isTelegramApp && tg) {
                tg.MainButton.setText(t.generateText);
            }

            saveSettings();

            if (tg?.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('light');
            }
        }

        function generateImage() {
            if (isGenerating) return;

            const t = translations[currentLang];
            const prompt = document.getElementById('prompt').value.trim();
            const quality = document.getElementById('quality').value;

            // Validation
            if (!prompt) {
                showStatus(t.errorEmpty, 'error');
                if (tg?.HapticFeedback) {
                    tg.HapticFeedback.notificationOccurred('error');
                }
                return;
            }

            if (prompt.length < 5) {
                showStatus(t.errorShort, 'error');
                return;
            }

            isGenerating = true;
            showLoading();

            // Data to send
            const data = {
                action: 'generate_image',
                prompt: prompt,
                style: selectedStyle,
                quality: quality,
                language: currentLang,
                theme: currentTheme,
                user_id: tg?.initDataUnsafe?.user?.id || null,
                user_name: tg?.initDataUnsafe?.user?.first_name || 'Guest',
                timestamp: new Date().toISOString(),
                app_version: '3.0'
            };

            console.log('📤 Sending data:', data);

            // Send data
            if (isTelegramApp && tg?.sendData) {
                try {
                    tg.sendData(JSON.stringify(data));
                    console.log('✅ Data sent via Telegram WebApp');

                    // Update main button
                    tg.MainButton.setText(t.generateLoading);
                    tg.MainButton.hide();

                    if (tg.HapticFeedback) {
                        tg.HapticFeedback.impactOccurred('medium');
                    }

                } catch (error) {
                    console.error('❌ Error sending via Telegram:', error);
                    showError(t.errorSend);
                }
            } else {
                console.log('⚠️ Telegram WebApp not available, showing demo');
                showDemoResult(data);
            }
        }

        function showDemoResult(data) {
            const t = translations[currentLang];

            setTimeout(() => {
                const demoDiv = document.createElement('div');
                demoDiv.innerHTML = `
                    <div class="status success">
                        <h3>${t.demoTitle}</h3>
                        <p><strong>${t.demoPrompt}</strong> ${data.prompt}</p>
                        <p><strong>${t.demoStyle}</strong> ${data.style}</p>
                        <p><strong>${t.demoQuality}</strong> ${data.quality}</p>
                        <br>
                        <small>${t.demoNote}</small>
                    </div>
                `;

                document.getElementById('loading').appendChild(demoDiv);
            }, 2000);
        }

        function showLoading() {
            const t = translations[currentLang];

            document.getElementById('mainForm').style.display = 'none';
            document.getElementById('loading').classList.add('show');

            const generateBtn = document.getElementById('generateBtn');
            generateBtn.disabled = true;
            generateBtn.querySelector('span').textContent = t.generateLoading;
        }

        function backToForm() {
            const t = translations[currentLang];

            document.getElementById('loading').classList.remove('show');
            document.getElementById('mainForm').style.display = 'block';
            isGenerating = false;

            const generateBtn = document.getElementById('generateBtn');
            generateBtn.disabled = false;
            generateBtn.querySelector('span').textContent = t.generateText;

            // Restore main button
            if (isTelegramApp && tg) {
                tg.MainButton.setText(t.generateText);
                tg.MainButton.show();
            }

            // Clear demo results
            const demoResults = document.querySelectorAll('#loading > div:not(.spinner):not(h3):not(p):not(.back-btn)');
            demoResults.forEach(result => result.remove());
        }

        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('connectionStatus');
            statusDiv.querySelector('span').textContent = message;
            statusDiv.className = `status ${type}`;

            // Auto-hide success status
            if (type === 'success') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 5000);
            }
        }

        function showError(message) {
            showStatus(message, 'error');
            backToForm();

            if (tg?.HapticFeedback) {
                tg.HapticFeedback.notificationOccurred('error');
            }
        }

        function saveSettings() {
            try {
                const settings = {
                    language: currentLang,
                    theme: currentTheme
                };
                localStorage.setItem('app_settings', JSON.stringify(settings));
            } catch (error) {
                console.warn('Could not save settings:', error);
            }
        }

        function loadSettings() {
            try {
                const saved = localStorage.getItem('app_settings');
                if (saved) {
                    const settings = JSON.parse(saved);
                    if (settings.theme) {
                        changeTheme(settings.theme);
                    }
                    if (settings.language && translations[settings.language]) {
                        updateLanguage(settings.language);
                    }
                }
            } catch (error) {
                console.warn('Could not load settings:', error);
            }
        }

        // Global functions for debugging
        window.testGeneration = function() {
            document.getElementById('prompt').value = 'Test image of beautiful sunset';
            generateImage();
        };

        window.getAppInfo = function() {
            return {
                telegramAvailable: isTelegramApp,
                selectedStyle: selectedStyle,
                isGenerating: isGenerating,
                currentLang: currentLang,
                currentTheme: currentTheme,
                tgData: tg?.initDataUnsafe || null
            };
        };

        // Handle app closing
        window.addEventListener('beforeunload', function() {
            if (isTelegramApp && tg?.sendData) {
                try {
                    const closeData = {
                        action: 'app_closed',
                        user_id: tg?.initDataUnsafe?.user?.id || null,
                        language: currentLang,
                        theme: currentTheme,
                        timestamp: new Date().toISOString()
                    };
                    tg.sendData(JSON.stringify(closeData));
                } catch (error) {
                    console.warn('Could not send close data:', error);
                }
            }
        });

        console.log('🎯 For testing: testGeneration() or getAppInfo()');
    </script>
</body>
</html>